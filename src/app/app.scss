.spacer {
  flex: 1 1 auto;
}

nav {
  display: flex;
  gap: 8px;
}

.active {
  background-color: rgba(255, 255, 255, 0.1);
}

.content {
  padding: 16px;
}

.app-container {
  display: flex;
  flex-direction: column;
  margin-top: 0;
  height: 100dvh;
  overflow: hidden;
  width: 100%;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;

  // CSS variable for toolbar height
  --toolbar-height: 64px;
}

// Glass toolbar styles - positioned beside sidenav (not fixed)
.app-toolbar {
  position: relative !important;
  z-index: 10;
  height: var(--toolbar-height);
  padding: 8px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  flex-shrink: 0;

  // Glass effect background - clean, neutral white
  background-color: rgba(250, 250, 250, 0.85);
  -webkit-backdrop-filter: blur(20px) saturate(1.8);
  backdrop-filter: blur(20px) saturate(1.8);
  border-bottom: 1px solid rgba(0, 0, 0, 0.08);

  // Enable pointer events on toolbar
  pointer-events: auto;

  // Reduce padding on smaller screens
  @media (max-width: 1023px) {
    padding: 8px 8px;
    gap: 8px;
  }
}

// Dark mode toolbar
:host-context(.dark) .app-toolbar {
  background-color: rgba(18, 18, 18, 0.9);
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

// Glass section mixin for toolbar sections
@mixin glass-section {
  display: flex;
  align-items: center;
  height: 48px;
  padding: 0 8px;
  border-radius: 24px;

  // Re-enable pointer events on glass sections
  pointer-events: auto;

  // Subtle background for sections within the glass toolbar
  background-color: rgba(0, 0, 0, 0.04);
}

@mixin glass-section-dark {
  background-color: rgba(255, 255, 255, 0.08);
}

// Toolbar sections
.toolbar-section {
  @include glass-section;
}

// Dark mode for toolbar sections
:host-context(.dark) .toolbar-section {
  @include glass-section-dark;
}

// Left section - hamburger/avatar and app icon
.toolbar-left {
  flex-shrink: 0;
  gap: 4px;
  transition: opacity 0.2s ease, visibility 0.2s ease, width 0.2s ease;

  // Hidden state when sidenav is open (desktop only - side mode)
  &.toolbar-left-hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    width: 0;
    overflow: hidden;
    padding: 0;
    margin: 0;
  }

  // Hidden state when search is focused on mobile
  &.mobile-search-focused {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    width: 0;
    overflow: hidden;
    padding: 0;
    margin: 0;
  }
}

// Center section - always-visible search
.toolbar-center {
  flex: 1;
  display: flex;
  justify-content: center;
  max-width: 600px;
  min-width: 0;
  margin: 0 auto;
  transition: max-width 0.2s ease, flex 0.2s ease;

  // On mobile, allow search to take more space
  @media (max-width: 599px) {
    max-width: none;
  }

  // When search is focused on mobile, take full width
  &.mobile-search-expanded {
    flex: 1;
    max-width: none;
    width: 100%;
  }

  .search-container {
    flex: 1;
    max-width: 100%;
    height: 48px;
    padding: 0 12px;
    gap: 8px;
    position: relative;

    // Smooth transition for collapse animation
    transition:
      height var(--toolbar-transition-duration) cubic-bezier(0.4, 0, 0.2, 1),
      padding var(--toolbar-transition-duration) cubic-bezier(0.4, 0, 0.2, 1);

    .search-icon {
      color: var(--mat-sys-on-surface-variant);
      font-size: 20px;
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      transition: font-size var(--toolbar-transition-duration) cubic-bezier(0.4, 0, 0.2, 1);
    }

    .search-input {
      flex: 1;
      border: none;
      background: transparent;
      font-size: 16px; // Minimum 16px to prevent iOS Safari auto-zoom on focus
      color: var(--mat-sys-on-surface);
      outline: none;
      min-width: 0;

      &::placeholder {
        color: var(--mat-sys-on-surface-variant);
        opacity: 0.7;
      }

      // Hide default search clear button
      &::-webkit-search-cancel-button {
        display: none;
      }
    }

    // Search action buttons (voice, qr, close) - shown when search is active
    .search-action-button {
      width: 36px;
      height: 36px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;

      .mat-icon {
        display: flex;
        align-items: center;
        justify-content: center;
      }
    }

    // When search is active, show additional action buttons
    &.search-active {
      background-color: rgba(0, 0, 0, 0.08);
    }

    // When search results are visible, remove bottom border radius to connect with results
    &.has-results {
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
    }
  }
}

:host-context(.dark) .toolbar-center .search-container {
  &.search-active {
    background-color: rgba(255, 255, 255, 0.12);
  }
}

// Right section - action buttons and notifications
.toolbar-right {
  flex-shrink: 0;
  gap: 4px;
  transition: opacity 0.2s ease, visibility 0.2s ease, width 0.2s ease;

  // Create button - clean and simple
  .create-button {
    mat-icon {
      font-size: 24px;
    }
  }

  // Hidden state when search is focused on mobile
  &.mobile-search-focused {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    width: 0;
    overflow: hidden;
    padding: 0;
    margin: 0;
  }
}

// Hide create button on mobile (there's one in the mobile nav)
.hide-on-mobile {
  @media (max-width: 599px) {
    display: none !important;
  }
}

// Breadcrumb navigation styles
.breadcrumb-nav {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-left: 8px;
  overflow: hidden;
  white-space: nowrap;

  // Hide on very small screens (360px and below)
  @media (max-width: 360px) {
    display: none;
  }
}

.breadcrumb-link {
  background: none;
  border: none;
  padding: 4px 8px;
  margin: 0;
  font-size: 1.2rem;
  color: var(--mat-sys-on-surface);
  cursor: pointer;
  outline: none;
  opacity: 0.7;
  transition: opacity 0.2s ease;
  border-radius: 4px;

  &:hover {
    opacity: 1;
    background-color: rgba(0, 0, 0, 0.05);
  }

  &:focus-visible {
    outline: 2px solid currentColor;
    outline-offset: 2px;
  }
}

:host-context(.dark) .breadcrumb-link {
  &:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }
}

.breadcrumb-separator {
  color: var(--mat-sys-on-surface);
  opacity: 0.5;
  font-size: 1rem;
  user-select: none;
}

.breadcrumb-current {
  font-size: 1.2rem;
  color: var(--mat-sys-on-surface);
  padding: 4px 0;
}

// Left panel actions - responsive collapse behavior
.expanded-actions {
  display: flex;
  align-items: center;

  // Hide on small screens (show collapsed menu instead)
  @media (max-width: 599px) {
    display: none;
  }
}

.collapsed-actions-button {
  // Only show on small screens
  display: none;

  @media (max-width: 599px) {
    display: inline-flex;
  }
}

// Right sidebar - mini apps panel (shoutout, favorites, future mini apps)
// This is a static sidebar that sits to the right of the main content panels
// Content scrolls in front of it (panels have their own scroll containers)
.right-sidebar {
  width: 64px;
  min-width: 64px;
  flex-shrink: 0;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding-top: 16px;
  gap: 8px;
  background-color: transparent;
  border-left: 1px solid rgba(0, 0, 0, 0.06);
  overflow-y: auto;
  overflow-x: hidden;
  position: relative;
  z-index: 10;

  // Hide scrollbar but allow scrolling
  scrollbar-width: none;

  &::-webkit-scrollbar {
    display: none;
  }
}

:host-context(.dark) .right-sidebar {
  border-left: 1px solid rgba(255, 255, 255, 0.06);
}

// Right section (already defined in toolbar-right above)

// Dark mode - glass toolbar background maintained
:host-context(.dark) .app-toolbar {
  background-color: rgba(18, 18, 18, 0.9);
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

.premium-label {
  opacity: 0.9;
}

.premium-expires {
  margin-top: 0.4rem;
  opacity: 0.7;
  font-size: 0.8rem;
}

.sidenav-container {
  flex: 1;
  overflow: hidden;
  /* Prevent scrolling on the container itself - only content-wrapper should scroll */

  // Sidenav container now takes full height
  margin-top: 0;
  height: 100%;
  box-sizing: border-box;

  // Make space for mobile nav when on mobile
  @media (max-width: 599px) {}
}

// Configure mat-sidenav-content to be a flex container
mat-sidenav-content {
  display: flex;
  flex-direction: column;
  height: 100%;
  transition: margin-right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  // Content no longer needs padding-top since toolbar is inside
  box-sizing: border-box;

  // Add margin when following sidebar is docked (this is a real sidebar, not centering compensation)
  &.following-sidebar-docked {
    margin-right: 220px; // Width of docked sidebar (reduced from 320px)

    @media (max-width: 599px) {
      margin-right: 0; // No margin on mobile, keep as overlay
    }
  }
}

// Main content area - flex row container for panels and right sidebar
.main-content-area {
  display: flex;
  flex-direction: row;
  flex: 1;
  min-height: 0;
  overflow: hidden;
}

.sidenav {
  width: 250px;
  // Sidenav now spans full height from top to bottom
  margin-top: 0 !important;
  height: 100% !important;
  box-sizing: border-box;

  // Glass effect - clean neutral
  background-color: rgba(250, 250, 250, 0.85) !important;
  -webkit-backdrop-filter: blur(20px) saturate(1.8);
  backdrop-filter: blur(20px) saturate(1.8);

  // Override Angular Material's internal container - use block layout to prevent compression
  .mat-drawer-inner-container {
    display: block !important;
    height: 100% !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
  }

  // On mobile (over mode), ensure proper z-index
  @media (max-width: 599px) {
    z-index: 100 !important;
  }

  @media (min-width: 599px) {
    z-index: 0 !important;
  }

  // Ensure nav list items maintain their size
  mat-nav-list {
    .mat-mdc-list-item {
      min-height: 48px !important;
    }

    @media (max-width: 599px) {
      padding-bottom: calc(100px + env(safe-area-inset-bottom, 0px));
    }
  }
}

:host-context(.dark) .sidenav {
  background-color: rgba(18, 18, 18, 0.85) !important;
}

// Close button row at top of sidenav
.sidenav-close-row {
  display: flex;
  align-items: center;
  padding: 8px;
  gap: 8px;

  .sidenav-close-button {
    color: var(--mat-sys-on-surface-variant);

    &:hover {
      color: var(--mat-sys-on-surface);
    }
  }

  .sidenav-title {
    font-size: 1rem;
    color: var(--mat-sys-on-surface);
  }
}

// In small mode, center the close button
.sidenav-small .sidenav-close-row {
  justify-content: center;
}

// Menu profile button in toolbar (replaces hamburger)
.menu-profile-button {
  padding: 0 !important;
  overflow: hidden;
  display: flex !important;
  align-items: center;
  justify-content: center;

  &.profile-button-picture {
    .menu-profile-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
      display: block;
    }
  }

  mat-icon {
    font-size: 28px;
    width: 28px;
    height: 28px;
  }
}

// Sidenav Profile Section styles
.sidenav-profile-section {
  padding: 0 8px 8px;
}

.sidenav-profile-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px;
  border-radius: 8px;
}

:host-context(.dark) .sidenav-profile-header {
  // No hover state needed - individual elements handle their own interactions
}

.sidenav-profile-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  flex-shrink: 0;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--mat-sys-surface-container);
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;

  &:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }

  &:active {
    transform: scale(0.95);
  }

  .avatar-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .avatar-icon {
    font-size: 40px;
    width: 40px;
    height: 40px;
    color: var(--mat-sys-on-surface-variant);
  }
}

:host-context(.dark) .sidenav-profile-avatar {
  &:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
  }
}

.sidenav-profile-info {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.sidenav-profile-name {
  font-size: 14px;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--mat-sys-on-surface);
}

.sidenav-premium-badge {
  font-size: 10px;
  padding: 2px 6px;
  background-color: var(--mat-sys-primary);
  color: var(--mat-sys-on-primary);
  border-radius: 4px;
  width: fit-content;
}

.expand-accounts-button {
  color: var(--mat-sys-on-surface-variant);
  transition: transform 0.2s ease, color 0.2s ease;
  flex-shrink: 0;

  &:hover {
    color: var(--mat-sys-on-surface);
  }
}

// Expandable accounts list in sidenav
.sidenav-accounts-list {
  padding-left: 8px;
  border-left: 2px solid var(--mat-sys-outline-variant);
  margin-left: 28px;
}

.sidenav-account-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  background: transparent;
  border: none;
  width: 100%;
  text-align: left;
  transition: background-color 0.2s ease;
  color: var(--mat-sys-on-surface);

  &:hover {
    background-color: rgba(0, 0, 0, 0.05);
  }

  &.sidenav-add-account {
    color: var(--mat-sys-primary);

    mat-icon {
      font-size: 20px;
      width: 20px;
      height: 20px;
    }
  }
}

:host-context(.dark) .sidenav-account-item {
  &:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }
}

.sidenav-account-avatar {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  flex-shrink: 0;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--mat-sys-surface-container);

  .avatar-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  mat-icon {
    font-size: 28px;
    width: 28px;
    height: 28px;
    color: var(--mat-sys-on-surface-variant);
  }
}

.sidenav-account-name {
  font-size: 13px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

// Profile quick actions row
.sidenav-profile-actions {
  display: flex;
  justify-content: center;
  gap: 4px;
  margin-top: 8px;
  padding: 4px 0;

  button {
    color: var(--mat-sys-on-surface-variant);

    &:hover {
      color: var(--mat-sys-primary);
    }
  }
}

// Sidenav Wallet Section
.sidenav-wallet-section {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  margin: 8px 12px;
  border-radius: 12px;
  cursor: pointer;
  background: var(--mat-sys-surface-container);
  transition: background-color 0.2s ease, transform 0.15s ease;

  &:hover {
    background: var(--mat-sys-surface-container-high);
    transform: translateX(2px);
  }

  &:active {
    transform: translateX(0);
  }

  .wallet-icon {
    color: var(--mat-sys-primary);
    font-size: 24px;
    width: 24px;
    height: 24px;
  }

  .wallet-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
    min-width: 0;
    flex: 1;
  }

  .wallet-label {
    font-size: 11px;
    color: var(--mat-sys-on-surface-variant);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .wallet-balance {
    font-size: 14px;
    color: var(--mat-sys-on-surface);
  }
}

:host-context(.dark) .sidenav-wallet-section {
  &:hover {
    background: var(--mat-sys-surface-container-highest);
  }
}

// Override Angular Material's hover state to use lighter colors
.sidenav mat-nav-list {

  a[mat-list-item],
  .mat-mdc-list-item {
    // Use Material's CSS variables for proper hover effect
    --mat-list-list-item-hover-state-layer-color: rgb(0, 0, 0);
    --mat-list-list-item-hover-state-layer-opacity: 0.04;
  }
}

:host-context(.dark) .sidenav mat-nav-list {

  a[mat-list-item],
  .mat-mdc-list-item {
    // Use white for much lighter/brighter hover in dark mode
    --mat-list-list-item-hover-state-layer-color: rgb(255, 255, 255);
    --mat-list-list-item-hover-state-layer-opacity: 0.15;

    &:hover:not(.active-link) {
      background-color: rgba(255, 255, 255, 0.15) !important;

      // Ensure text and icon have the same color on hover
      color: var(--mat-sys-on-surface) !important;

      .mat-icon,
      mat-icon {
        color: var(--mat-sys-on-surface) !important;
      }
    }
  }
}

.active-link {
  background-color: rgba(0, 0, 0, 0.04);

  &.mat-mdc-list-item {
    color: var(--mat-primary-500);
  }
}

:host-context(.dark) .active-link {
  background-color: rgba(255, 255, 255, 0.05);
}

.toolbar-spacer {
  flex: 1 1 auto;
  display: flex;
  justify-content: center;
  align-items: center;
}



// ============================================
// Dual-Panel Layout System
// ============================================
// Layout rules:
// - Each panel is its own SCROLL CONTAINER with scrollbar at panel edge
// - Left panel takes 50% or 100% width (scrollbar at panel edge)
// - Right panel takes 50% width when visible (scrollbar at panel edge)
// - Content inside panels is constrained to max 700px/1400px (visual constraint)
// - Feeds centered when both panels empty
// - Each panel has independent Back/Close navigation
// - On mobile, panels overlay each other

.dual-panel-layout {
  display: flex;
  flex-direction: row;
  flex: 1;
  min-height: 0;
  width: 100%;
  // Parent is NOT the scroll container - each panel scrolls independently
  overflow: hidden;
  justify-content: center;
  position: relative;
  // Enable 3D perspective for collapse animation
  perspective: 1500px;
  perspective-origin: center center;

  // When feeds should be centered (both panels empty)
  &.feeds-centered {
    justify-content: center;

    .left-panel {
      // Take 100% width for scrollbar positioning, content will be centered inside
      width: 100%;
      min-width: 0;
      max-width: 100%;

      .panel-content-wrapper {
        // Constrain content to configured width
        max-width: var(--left-column-width, 700px);
      }
    }

    .right-panel {
      display: none;
    }
  }

  // Wide left mode (e.g., Music without detail open)
  &.wide-left:not(.has-right-content) {
    .left-panel {
      width: 100%;
      min-width: 0;
      max-width: 100%;

      .panel-content-wrapper {
        // Constrain content to configured wide width
        max-width: var(--left-column-width, 1400px);
      }
    }
  }

  // When feeds visible but right has content
  &.feeds-visible:not(.feeds-centered) {
    justify-content: center;
  }

  // When left panel has routed content (without right panel)
  &.has-left-content:not(.has-right-content) {
    justify-content: center;

    .left-panel {
      // Take 100% width for scrollbar at edge, content centered inside
      width: 100%;
      min-width: 0;
      max-width: 100%;
      display: flex;
      flex-direction: column;

      .panel-content-wrapper {
        // Default to 700px, can be overridden by wide-left
        max-width: var(--left-column-width, 700px);
      }
    }
  }

  // When left panel has routed content (with right panel)
  &.has-left-content.has-right-content {
    .left-panel {
      display: flex;
      flex-direction: column;
    }
  }

  // When right panel has content - two panes side by side
  &.has-right-content {
    justify-content: flex-start;

    .right-panel {
      display: flex;
      flex-direction: column;
    }

    // Both panels take 50% width for proper scrollbar positioning
    .left-panel {
      width: 50%;
      min-width: 0;
      max-width: 50%;
      display: flex;
      flex-direction: column;

      .panel-content-wrapper {
        // Constrain content to 700px, aligned to the right (towards center)
        max-width: 700px;
        margin-left: auto;
        margin-right: 0;
      }
    }

    .right-panel {
      width: 50%;
      min-width: 0;
      max-width: 50%;

      .panel-content-wrapper {
        // Constrain content to 700px, aligned to the left (towards center)
        max-width: 700px;
        margin-left: 0;
        margin-right: auto;
      }
    }

    // At tablet breakpoint (below 1024px), switch to overlay mode
    @media (max-width: 1023px) {
      .left-panel {
        width: 100%;
        min-width: 100%;
        max-width: 100%;

        .panel-content-wrapper {
          max-width: 700px;
          margin-left: auto;
          margin-right: auto;
        }
      }

      .left-panel.hidden-mobile {
        display: none;
      }

      .right-panel {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        max-width: 100%;
        z-index: 500;
        background-color: var(--mat-app-background-color);
        overflow-y: auto;

        .panel-content-wrapper {
          max-width: 700px;
          margin-left: auto;
          margin-right: auto;
        }
      }
    }
  }

  // When left panel is collapsed
  &.left-collapsed {
    .left-panel {
      width: 0;
      min-width: 0;
      max-width: 0;
      transform: scale(0.88) translateY(30px);
      opacity: 0;
      pointer-events: none;
      z-index: 0;
      filter: blur(2px);
      overflow: hidden;
    }

    .right-panel {
      width: 100%;
      min-width: 0;
      max-width: 100%;
      z-index: 10;
      position: relative;
      box-shadow: -12px 0 40px rgba(0, 0, 0, 0.25);

      .panel-content-wrapper {
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
      }
    }
  }

  // Full-width mode for right panel (Streams, Meetings, etc.)
  &.right-full-width {
    justify-content: flex-start;

    .left-panel {
      flex-shrink: 0;
    }

    .right-panel {
      flex: 1;
      max-width: none;

      .panel-content-wrapper {
        max-width: none;
      }
    }
  }

  // Mobile layout - panels overlay
  &.mobile-layout {
    .left-panel {
      width: 100%;
      min-width: 100%;
      max-width: 100%;

      .panel-content-wrapper {
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
      }
    }

    &.has-right-content {
      .left-panel.hidden-mobile {
        display: none;
      }

      .right-panel {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        max-width: 100%;
        z-index: 500;
        background-color: var(--mat-app-background-color);
        overflow-y: auto;
      }
    }
  }
}

// Panel content wrapper - constrains content width while panel takes full space
.panel-content-wrapper {
  width: 100%;
  min-height: 0;
  display: flex;
  flex-direction: column;
  flex: 1;
  position: relative;
  // Center the content wrapper within the panel when max-width is set
  margin-left: auto;
  margin-right: auto;

  // In right panel, remove all flex properties and height constraints
  // This allows child components with sticky headers to work properly
  .right-panel & {
    display: block;
    min-height: unset;
    flex: unset;
  }
}

// Left Panel - takes 50% or 100% of viewport, content constrained inside
// Each panel is its own scroll container with scrollbar at panel edge
.left-panel {
  // Default width - will be overridden by dual-panel-layout context
  width: 100%;
  min-width: 0;
  max-width: 100%;
  min-height: 0;
  flex: 1; // Fill available height in dual-panel-layout
  display: flex;
  flex-direction: column;
  position: relative;
  z-index: 1;
  // This panel is its own scroll container
  overflow-y: auto;
  overflow-x: hidden;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
  // Base transform for expanded state
  transform: scale(1) translateY(0);
  filter: blur(0);
  // Smooth transitions for collapse animation
  transition:
    width 0.4s cubic-bezier(0.4, 0, 0.2, 1),
    min-width 0.4s cubic-bezier(0.4, 0, 0.2, 1),
    max-width 0.4s cubic-bezier(0.4, 0, 0.2, 1),
    transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
    opacity 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
    filter 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
    z-index 0s linear 0.2s;

  // Disable panel scrolling when virtual-scroll components are present
  // These components manage their own scrolling
  &:has(app-notifications) {
    overflow-y: hidden;
  }

  // Disable panel scrolling when feeds are visible
  // Feeds has its own scroll container to preserve scroll position when navigating away and back
  .dual-panel-layout.feeds-visible & {
    overflow-y: hidden;
  }

  // When left panel has content, ensure proper layout for header + content
  &.has-content {

    // Ensure router-outlet content fills available space
    .panel-content {
      flex: 1;
      min-height: 0; // Required for flex children to shrink properly
      display: flex;
      flex-direction: column;

      // Router outlet needs to be a flex item
      router-outlet {
        display: none; // router-outlet itself is just a placeholder
      }

      // Content rendered after router-outlet fills remaining space
      router-outlet+* {
        flex: 1;
        min-height: 0;
      }
    }
  }

  // Feeds container - persistent, uses visibility for state preservation
  // Positioned directly in left-panel for scrollbar at panel edge
  // Content constraint is handled by feeds component's .column-unit with max-width
  .feeds-container {
    display: flex;
    flex-direction: column;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    min-height: 0; // Required for flex children to shrink properly
    overflow: hidden; // Feeds manages its own scroll via columns-container
    transition: opacity 0.2s ease;

    // Active state - visible
    &.feeds-active {
      visibility: visible;
      opacity: 1;
      z-index: 1; // Above panel-content when active
    }

    // Hidden state - preserve scroll position with visibility
    &.feeds-hidden {
      visibility: hidden;
      opacity: 0;
      z-index: 0;
      pointer-events: none;
    }
  }

  // Ensure feeds component fills container
  app-feeds {
    display: flex;
    flex-direction: column;
    flex: 1; // Fill available space in flex parent
    width: 100%;
    min-height: 0; // Required for flex children to shrink properly
  }

  // When animating, ensure smooth transition
  &.animating {
    will-change: transform, opacity;
  }
}

// Left Panel Toggle Button - positioned between left and right panels
.left-panel-toggle {
  position: absolute;
  // Position at the edge between left and right panels
  // The panels are centered with justify-content: center, so calculate from center
  // When panels are 700+700, center is between them at 50%
  // When panels shrink to 50%+50%, center is still at 50%
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 100;
  background-color: var(--mat-sys-surface-container);
  border: 1px solid var(--mat-sys-outline-variant);
  border-radius: 8px;
  width: 24px;
  height: 48px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  opacity: 1;
  // Opacity fades out quickly, then back in with a delay after position settles
  transition:
    background-color 0.2s ease,
    transform 0.2s ease,
    left 0.4s cubic-bezier(0.4, 0, 0.2, 1),
    margin-left 0.4s cubic-bezier(0.4, 0, 0.2, 1),
    opacity 0.3s ease-out;

  // Hide on tablet (below 1023px) - mobile mode takes over
  @media (max-width: 1023px) {
    display: none;
  }

  &:hover {
    background-color: var(--mat-sys-surface-container-high);
    transform: translate(-50%, -50%) scale(1.05);
  }

  // When animating, fade out the button
  &.animating {
    opacity: 0;
    pointer-events: none;
    // Quick fade out, no delay
    transition:
      background-color 0.2s ease,
      transform 0.2s ease,
      left 0.4s cubic-bezier(0.4, 0, 0.2, 1),
      margin-left 0.4s cubic-bezier(0.4, 0, 0.2, 1),
      opacity 0.2s ease-out;
  }

  mat-icon {
    font-size: 18px;
    width: 18px;
    height: 18px;
    transition: transform 0.2s ease;
  }
}

// When left panel is collapsed, move toggle to left edge of centered right panel
.dual-panel-layout.left-collapsed .left-panel-toggle {
  // Right panel takes 100% but content is centered at max 700px
  // Position toggle at the left edge of the content
  left: calc(50% - 350px);
  margin-left: -12px; // Offset for toggle width
  transform: translateY(-50%);

  mat-icon {
    transform: rotate(180deg);
  }
}

// Right Panel - takes 50% of viewport, content constrained inside
// Each panel is its own scroll container with scrollbar at panel edge
.right-panel {
  // Default width - will be overridden by dual-panel-layout context
  width: 50%;
  min-width: 0;
  max-width: 50%;
  min-height: 0;
  display: none;
  position: relative;
  z-index: 5;
  // Transparent background - content renders behind main toolbar
  background-color: transparent;
  // This panel is its own scroll container
  overflow-y: auto;
  overflow-x: hidden;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
  // Smooth transitions for layout changes
  transition:
    width 0.4s cubic-bezier(0.4, 0, 0.2, 1),
    min-width 0.4s cubic-bezier(0.4, 0, 0.2, 1),
    max-width 0.4s cubic-bezier(0.4, 0, 0.2, 1),
    margin-left 0.4s cubic-bezier(0.4, 0, 0.2, 1),
    box-shadow 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
    z-index 0s linear;

  &.active {
    // Use block layout instead of flex to allow sticky positioning to work properly
    // Flex containers can interfere with sticky positioning in child elements
    display: block;
  }

  &.full-width {
    flex: 1;
    min-width: 0;
    max-width: none;
  }

  // Ensure the container component lets content flow naturally
  // Do NOT use flex-direction: column or set height constraints
  // as these break position: sticky on child elements
  app-right-panel-container {
    display: block;
    // Do NOT set overflow, height, or flex properties
    // Scrolling happens at .right-panel level
  }

  // Ensure routed components fill the panel
  .right-panel-content {

    // Routed components in right panel - just let them flow naturally
    router-outlet+* {
      display: block;
    }
  }

  // Components with sticky headers need their host element to extend full content height
  // The .panel-with-sticky-header class is added by components that have a sticky .panel-header
  .panel-with-sticky-header {
    display: block;
    // No height constraints - let content determine height
  }

  // Override any viewport-height constraints on profile-outlet when in right panel
  // This ensures sticky headers work properly by letting content flow naturally
  .profile-outlet {
    height: auto !important;
    min-height: 0 !important;
  }
}

// Panel Content Area (used by both panels)
// Content flows naturally - scrolling happens at panel level (.left-panel, .right-panel)
.panel-content {
  flex: 1;
  min-height: 0;
  // NO overflow here - scrolling happens at panel level
  overflow: visible;
  padding-top: 0;

  // Left panel content needs flex for feeds layout
  &.left-panel-content {
    display: flex;
    flex-direction: column;
  }

  // Right panel content - block layout for proper sticky behavior
  // Since .right-panel is now display: block, we don't need flex properties
  &.right-panel-content {
    display: block;
    min-height: unset;
    flex: unset;
    // Do NOT set overflow or height constraints that could break sticky
  }
}

// ============================================
// Panel Header Wrapper (for sticky headers rendered at panel level)
// ============================================
// NEW APPROACH: Headers are rendered at the panel level via services
// (RightPanelHeaderService, LeftPanelHeaderService) and wrapped in .panel-header-wrapper.
// This ensures proper sticky behavior regardless of nested DOM structure.
//
// Components register their header templates via the service, and app.html renders them
// inside .panel-header-wrapper before .panel-content-wrapper.
//
// The wrapper provides:
// - Sticky positioning at the panel level
// - Full-width glass effect background
// - Width constraints on inner .panel-header to match content width
//
// OLD APPROACH (still used by most components):
// Components render .panel-header directly in their template with position: sticky.
// See .panel-header styles below for that approach.

.panel-header-wrapper {
  position: sticky;
  top: 0;
  z-index: 50;
  width: 100%;
  
  // Glass effect background on the wrapper for full-width backdrop blur
  background-color: rgba(250, 250, 250, 0.92);
  -webkit-backdrop-filter: blur(20px) saturate(1.8);
  backdrop-filter: blur(20px) saturate(1.8);
  border-bottom: 1px solid rgba(0, 0, 0, 0.06);
  
  // Inner .panel-header should not have its own sticky/background
  // Also set default max-width and centering (can be overridden by layout contexts)
  // Use ::ng-deep because the .panel-header comes from other components via ngTemplateOutlet
  // and has their view encapsulation attributes, not app's
  ::ng-deep .panel-header {
    position: relative;
    top: auto;
    background-color: transparent;
    -webkit-backdrop-filter: none;
    backdrop-filter: none;
    border-bottom: none;
    // Default width constraint - ensures max-width works
    width: 100%;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
  }
}

// Dark mode for wrapper
.dark .panel-header-wrapper {
  background-color: rgba(18, 18, 18, 0.92);
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

// ============================================
// Panel Header Wrapper - Layout Context Rules
// ============================================
// These rules mirror the .panel-content-wrapper max-width/margin rules
// Use ::ng-deep because .panel-header comes from other components via ngTemplateOutlet

.dual-panel-layout {
  // Feeds visible (left panel only, no right content)
  &.feeds-visible:not(.has-right-content) {
    .left-panel .panel-header-wrapper ::ng-deep .panel-header {
      max-width: var(--left-column-width, 700px);
      margin: 0 auto;
    }
  }

  // Wide left mode (e.g., Music without detail open)
  &.wide-left:not(.has-right-content) {
    .left-panel .panel-header-wrapper ::ng-deep .panel-header {
      max-width: var(--left-column-width, 1400px);
      margin: 0 auto;
    }
  }

  // Left panel has routed content (without right panel)
  &.has-left-content:not(.has-right-content) {
    .left-panel .panel-header-wrapper ::ng-deep .panel-header {
      max-width: var(--left-column-width, 700px);
      margin: 0 auto;
    }
  }

  // Both panels have content - side by side
  &.has-right-content {
    // Left panel: align to right (towards center)
    .left-panel .panel-header-wrapper ::ng-deep .panel-header {
      max-width: 700px;
      margin-left: auto;
      margin-right: 0;
    }

    // Right panel: align to left (towards center)
    .right-panel .panel-header-wrapper ::ng-deep .panel-header {
      max-width: 700px;
      margin-left: 0;
      margin-right: auto;
    }

    // Tablet breakpoint - center both
    @media (max-width: 1023px) {
      .left-panel .panel-header-wrapper ::ng-deep .panel-header {
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
      }

      .right-panel .panel-header-wrapper ::ng-deep .panel-header {
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
      }
    }
  }

  // Left panel collapsed - right takes full width
  &.left-collapsed {
    .right-panel .panel-header-wrapper ::ng-deep .panel-header {
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
  }

  // Full-width mode for right panel (Streams, Meetings, etc.)
  &.right-full-width {
    .right-panel .panel-header-wrapper ::ng-deep .panel-header {
      max-width: none;
    }
  }

  // Mobile layout
  &.mobile-layout {
    .left-panel .panel-header-wrapper ::ng-deep .panel-header {
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }

    .right-panel .panel-header-wrapper ::ng-deep .panel-header {
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
  }
}

// ============================================
// Panel Header Styles (OLD APPROACH - direct rendering)
// ============================================
// These styles apply to .panel-header elements rendered directly in component templates.
// Most components still use this approach. The sticky positioning works when the
// component's host has proper height (use .panel-with-sticky-header class).
//
// For components using the NEW APPROACH (via header services), the sticky/background
// properties are overridden by .panel-header-wrapper ::ng-deep .panel-header rules above.

.panel-header {
  position: sticky;
  top: 0;
  z-index: 50;
  display: flex;
  align-items: center;
  gap: 8px;
  min-height: 56px;
  padding: 0 16px;
  flex-shrink: 0;

  // Glass effect - clean neutral
  background-color: rgba(250, 250, 250, 0.92);
  -webkit-backdrop-filter: blur(20px) saturate(1.8);
  backdrop-filter: blur(20px) saturate(1.8);

  // Subtle bottom border
  border-bottom: 1px solid rgba(0, 0, 0, 0.06);

  &.transparent {
    background-color: transparent;
    backdrop-filter: none;
    border-bottom: none;
  }

  .panel-title {
    margin: 0;
    font-size: 1.25rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .panel-subtitle {
    font-size: 0.875rem;
    opacity: 0.7;
    white-space: nowrap;
  }

  .panel-header-spacer {
    flex: 1;
  }

  .panel-actions {
    display: flex;
    align-items: center;
    gap: 4px;
    flex-shrink: 0;
  }
}

:host-context(.dark) .panel-header {
  background-color: rgba(18, 18, 18, 0.92);
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);

  &.transparent {
    background-color: transparent;
    border-bottom: none;
  }
}

// Left panel content
.left-panel .panel-content {
  // Content now starts below toolbar (mat-sidenav-content has padding-top)
  // No additional padding needed here

  // Special case for notifications - uses virtual scroll that manages its own scrolling
  &:has(app-notifications) {
    overflow: hidden; // Virtual scroll handles scrolling
  }
}

// Right panel content
.right-panel-content {
  // No top padding - components handle their own positioning via sticky panel headers
  // The panel headers stick below the main toolbar using top: var(--toolbar-height)
  padding-top: 0;

  // Routed components - they manage their own padding
  >router-outlet+*:not(app-profile):not(app-right-panel-container) {

    // Only add padding if the component doesn't have its own panel header
    &:not(:has(app-panel-header)):not(:has(.panel-header)) {
      // padding-top handled by component itself or parent
    }
  }

  // Right panel container also needs padding
  app-right-panel-container {
    display: block;

    >* {
      // Removed default padding - components handle their own via panel-header
    }

    // Profile handles its own spacing
    >app-profile {
      padding-top: 0;
    }
  }
}

// Legacy class names for backwards compatibility
.two-column-layout {
  @extend .dual-panel-layout;
}

// Legacy support - keep old class names working during transition
// Note: These extend the new two-column layout classes for backwards compatibility

// When media player is shown, add extra padding to content-wrapper
// mat-sidenav-content.media-player-shown .content-wrapper {
//   // We handle padding in individual components now to support glass effect
// }

// Mobile navigation footer
.mobile-nav {
  position: fixed;
  // Position near bottom - use fixed value, safe-area-inset causes issues on various platforms
  bottom: 8px;
  left: 50%;
  transform: translateX(-50%);
  right: auto;

  width: auto;
  min-width: 280px;
  max-width: calc(100% - 32px);

  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0;
  z-index: 1000;
  height: 56px;
  padding: 0;

  border-radius: 28px;

  // Glass effect - clean neutral
  background-color: rgba(255, 255, 255, 0.85);
  -webkit-backdrop-filter: blur(20px) saturate(1.8);
  backdrop-filter: blur(20px) saturate(1.8);

  border: none;

  box-shadow:
    0px 4px 16px rgba(0, 0, 0, 0.08),
    0px 8px 24px rgba(0, 0, 0, 0.08);

  /* Smooth transition for hide/show on scroll */
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);

  // Hidden state when scrolling down
  &.scroll-hidden {
    transform: translateX(-50%) translateY(calc(100% + 16px));
    opacity: 0;
    pointer-events: none;
  }
}

// Hide mobile nav completely when fullscreen is active
.app-container[data-fullscreen="true"] .mobile-nav {
  display: none !important;
  /* Completely hide instead of z-index manipulation */
}

.mobile-nav a,
.mobile-nav button {
  color: #666;
}

:host-context(.dark) .mobile-nav {
  background-color: rgba(26, 26, 26, 0.9);

  box-shadow:
    0px 4px 16px rgba(0, 0, 0, 0.3),
    0px 8px 24px rgba(0, 0, 0, 0.3);

  a,
  button {
    color: rgba(255, 255, 255, 0.7);
  }
}

.mobile-nav-button {
  flex: 0 0 auto;
  width: 64px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-width: 0;
  height: 100%;
  border-radius: 0;
  text-align: center;
  margin: 0;
  padding: 4px 8px;
  transition: background-color 0.2s ease;

  &:first-child {
    border-top-left-radius: 28px;
    border-bottom-left-radius: 28px;
  }

  &:last-child {
    border-top-right-radius: 28px;
    border-bottom-right-radius: 28px;
  }

  &:hover {
    background-color: rgba(0, 0, 0, 0.05);
  }

  &.active-link {
    background-color: rgba(0, 0, 0, 0.08);

    .mat-icon {
      color: var(--mat-sys-primary);
    }

    .mobile-nav-label {
      color: var(--mat-sys-primary);
      opacity: 1;
    }
  }
}

:host-context(.dark) .mobile-nav-button {
  &:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }

  &.active-link {
    background-color: rgba(255, 255, 255, 0.15);
  }
}

.mobile-nav-button .mat-icon {
  font-size: 22px;
  height: 22px;
  width: 22px;
  margin-bottom: 2px;
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.mobile-nav-label {
  font-size: 10px;
  line-height: 1;
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
  display: block;
  width: 100%;
  padding: 0;
  margin-top: 0;
  opacity: 0.7;
}

.fab-container {
  position: relative;
  width: 56px;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 0 4px;
}

.create-fab {
  z-index: 11;
  box-shadow: var(--mat-sys-level4);
  scale: 1.1;
}



.sidenav-labels {
  width: 220px;
}

.sidenav-small {
  width: 56px;

  // Override Angular Material's internal container - use block layout to prevent compression
  .mat-drawer-inner-container {
    display: block !important;
    height: 100% !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
  }

  // Ensure nav list items are properly sized and centered
  mat-nav-list {
    .mat-mdc-list-item {
      min-height: 48px !important;
      height: 48px !important;
      padding: 0 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;

      // Center the content wrapper
      .mdc-list-item__content {
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
      }

      // Reset icon start/avatar padding that Material adds
      .mdc-list-item__start {
        margin: 0 !important;
        padding: 0 !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 100% !important;
      }

      // Center the icon within the item
      mat-icon {
        margin: 0 !important;
        padding: 0 !important;
      }

      // Prevent avatar images from stretching and center them
      .sidenav-minimized-avatar {
        width: 24px !important;
        height: 24px !important;
        min-width: 24px !important;
        max-width: 24px !important;
        min-height: 24px !important;
        max-height: 24px !important;
        border-radius: 50%;
        object-fit: cover;
        flex-shrink: 0 !important;
        margin: 0 auto !important;
      }
    }
  }
}

.sidenav-small .mat-icon {
  margin: 0 !important;
}

// Expandable navigation styles
.nav-item {
  position: relative;
}

.expandable-nav-item {
  .nav-label {
    padding-right: 40px; // Make room for expand button
  }
}

.nav-label {
  flex: 1;
  display: block;
}

.expand-button {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  width: 32px;
  height: 32px;
  padding: 0;
  min-width: 32px;
  opacity: 0.7;
  transition: opacity 0.2s ease;

  &:hover {
    opacity: 1;
  }

  .expand-icon {
    font-size: 18px;
    width: 18px;
    height: 18px;
    transition: transform 0.2s ease;
  }
}

.child-nav-item {
  padding-left: 32px !important; // Indent child items
  background: transparent !important;
  border: none !important;
  width: 100%;
  text-align: left;
  // margin-left: 16px;
}

.child-label {
  font-size: 0.9rem;
  opacity: 0.8;
}

.child-nav-item:hover {
  background-color: rgba(var(--mat-sys-primary-rgb), 0.08) !important;
}

.child-nav-item:focus {
  background-color: rgba(var(--mat-sys-primary-rgb), 0.12) !important;
  outline: none;
}

.child-nav-item-container {
  display: flex;
  align-items: center;
  position: relative;

  .child-nav-item {
    flex: 1;
  }

  .feed-edit-button {
    position: absolute;
    right: 8px;
    opacity: 0;
    transition: opacity 0.2s ease;
    z-index: 1;

    mat-icon {
      font-size: 18px;
      width: 18px;
      height: 18px;
    }
  }

  &:hover .feed-edit-button {
    opacity: 0.7;
  }

  .feed-edit-button:hover {
    opacity: 1 !important;
  }
}

.profile-nav-item-container {
  display: flex;
  align-items: center;
  position: relative;

  a[mat-list-item] {
    flex: 1;
  }

  .profile-edit-button {
    position: absolute;
    right: 8px;
    opacity: 0.7;
    transition: opacity 0.2s ease;
    z-index: 1;

    mat-icon {
      font-size: 18px;
      width: 18px;
      height: 18px;
    }
  }

  .profile-edit-button:hover {
    opacity: 1 !important;
  }
}

.current-account {
  display: flex;
  align-items: center;
  padding: 8px;
  border-radius: 4px;
  cursor: pointer;
  background-color: rgba(0, 0, 0, 0.04);
}

:host-context(.dark) .current-account {
  background-color: rgba(255, 255, 255, 0.05);
}

.account-icon {
  color: var(--mat-sys-primary);
}

.account-name {
  font-size: 14px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.accounts-list {
  margin-top: 8px;
  margin-bottom: 8px;
}

.account-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: var(--mat-primary-300);
  position: relative;

  .avatar-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
    overflow: hidden;
  }

  .mat-icon {
    font-size: 32px;
    height: 32px;
    width: 32px;
  }

  &::before {
    content: '';
    position: absolute;
    top: -4px;
    left: -4px;
    right: -4px;
    bottom: -4px;
    border: 4px solid var(--mat-sys-primary);
    border-radius: 50%;
    opacity: 0;
    transform: scale(0.8);
    transition: opacity 0.2s ease;
  }
}

.account-item {
  margin-bottom: 4px;
  transition: background-color 0.2s ease;

  &:hover {
    .account-avatar::before {
      animation: circleGlow 0.8s ease-out forwards;
    }
  }
}

@keyframes circleGlow {
  0% {
    opacity: 0;
    transform: scale(0.8) rotate(0deg);
    border-color: transparent var(--mat-sys-primary) transparent transparent;
  }

  25% {
    opacity: 1;
    transform: scale(1) rotate(90deg);
    border-color: transparent transparent var(--mat-sys-primary) transparent;
  }

  50% {
    transform: scale(1) rotate(180deg);
    border-color: transparent transparent transparent var(--mat-sys-primary);
  }

  75% {
    transform: scale(1) rotate(270deg);
    border-color: var(--mat-sys-primary) transparent transparent transparent;
  }

  90% {
    opacity: 1;
    transform: scale(1) rotate(360deg);
    border-color: var(--mat-sys-primary) var(--mat-sys-primary) var(--mat-sys-primary) var(--mat-sys-primary);
  }

  100% {
    opacity: 0;
    transform: scale(1) rotate(360deg);
    border-color: transparent transparent transparent transparent;
  }
}

.account-source {
  font-size: 12px;
  color: var(--mat-subtitle-text-color);
}

.profile-button-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  object-fit: cover;
}

// Legacy search styles removed - search is now in .toolbar-center
// See lines ~164-236 for new toolbar search styles

/* Floating offline indicator styles */
.floating-offline-indicator {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1100; // Above mobile-nav (z-index: 1000)
  width: auto;
  min-width: 300px;
  max-width: 90%;
  border-radius: 8px;
  background-color: #d32f2f;
  color: white;
  box-shadow: var(--mat-sys-level3);
  animation: slideUp 0.3s ease-out;

  // Position above mobile navigation on small screens
  @media (max-width: 599px) {
    bottom: calc(100px + env(safe-area-inset-bottom, 0px));
  }
}

.offline-content {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  gap: 12px;
}

.offline-icon {
  font-size: 24px;
  height: 24px;
  width: 24px;
}

.dismiss-button {
  margin-left: auto;
  color: white;
}

@keyframes slideUp {
  from {
    transform: translate(-50%, 100%);
    opacity: 0;
  }

  to {
    transform: translate(-50%, 0);
    opacity: 1;
  }
}

/* Dark theme adjustments */
:host-context(.dark) .floating-offline-indicator {
  background-color: #ef5350;
}

// Pulsing animation for active notifications
@keyframes pulse {
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.5;
  }

  100% {
    opacity: 1;
  }
}

.desktop-create-fab {
  position: fixed;
  bottom: 0.4rem;
  left: 0.4rem;
  z-index: 11;
  box-shadow: var(--mat-sys-level4);
}

// Profile cache button styles
.profile-cache-button {
  position: relative;

  .spinning-icon {
    animation: spin 2s linear infinite;
  }

  .progress-badge {
    position: absolute;
    top: -2px;
    right: -2px;
    background: var(--mat-sys-primary);
    color: var(--mat-sys-on-primary);
    font-size: 10px;
    font-weight: 500;
    padding: 1px 4px;
    border-radius: 8px;
    min-width: 16px;
    text-align: center;
    line-height: 1.2;
    box-shadow: var(--mat-sys-level2);
  }
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
}

// Ensure backdrop appears above toolbar and mobile nav but below sidenav
.sidenav-container .mat-drawer-backdrop {
  z-index: 1000 !important;

  // On mobile, ensure backdrop is above mobile nav
  @media (max-width: 599px) {
    z-index: 1000 !important;
  }
}

// Fullscreen media player overlay
.fullscreen-media-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 2000;
  background: var(--mat-sys-background);
  display: flex;
  flex-direction: column;

  app-media-player {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
  }
}

// App initialization loading state
.app-initializing {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  width: 100%;
  background-color: var(--mat-sys-background);
  color: var(--mat-sys-on-background);

  .initializing-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
  }

  .initializing-spinner {
    width: 48px;
    height: 48px;
    border: 4px solid var(--mat-sys-surface-container);
    border-top-color: var(--mat-sys-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  .initializing-text {
    font-size: 16px;
    opacity: 0.8;
  }
}

// Voice search button styles
.voice-search-button {
  .pulse-icon {
    animation: pulse 1s ease-in-out infinite;
    color: var(--mat-sys-error);
  }

  .spinning-icon {
    animation: spin 2s linear infinite;
    color: var(--mat-sys-primary);
  }
}