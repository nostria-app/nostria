<div class="audio-player" (click)="$event.stopPropagation()">
  <button mat-icon-button (click)="togglePlay(); $event.stopPropagation()" class="play-button" [disabled]="isLoading()">
    @if (isLoading()) {
    <mat-spinner diameter="24"></mat-spinner>
    } @else {
    <mat-icon>{{ isPlaying() ? 'pause' : 'play_arrow' }}</mat-icon>
    }
  </button>

  <div class="waveform-container" (click)="onWaveformClick($event); $event.stopPropagation()">
    @if (waveform().length > 0) {
    <div class="waveform">
      @for (bar of waveform(); track $index) {
      <div class="bar" [style.height.%]="getWaveformBarHeight(bar)"
        [class.active]="$index / waveform().length <= currentTime() / (totalDuration() || 1)">
      </div>
      }
    </div>
    } @else {
    <mat-slider min="0" [max]="totalDuration()" step="0.1" class="fallback-slider">
      <input matSliderThumb [value]="currentTime()" (input)="seek($event)">
    </mat-slider>
    }
  </div>

  <div class="time">
    {{ formatTime(currentTime()) }}
  </div>

  <audio #audioElement [src]="currentSrc()" hidden playsinline></audio>
</div>