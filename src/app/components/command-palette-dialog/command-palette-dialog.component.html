<div dialog-content class="command-palette-container">
  <div class="search-header">
    <mat-icon class="search-icon">search</mat-icon>
    <input #searchInput type="text" [ngModel]="searchQuery()"
      (ngModelChange)="searchQuery.set($event); selectedIndex.set(0)" (keydown)="onKeyDown($event)"
      placeholder="Type a command or search..." class="search-input" [disabled]="isListening() || isTranscribing()">

    @if (isListening()) {
    <div class="listening-indicator">
      <span class="pulse"></span>
      Listening...
    </div>
    } @else if (isTranscribing()) {
    <div class="processing-indicator">
      <mat-icon class="spinning">sync</mat-icon>
    </div>
    } @else {
    <div class="shortcuts">
      <span class="shortcut">↑↓</span> to navigate
      <span class="shortcut">↵</span> to select
    </div>
    }

    <button mat-icon-button class="close-button" (click)="dialogRef.close()" aria-label="Close">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div class="results-list">
    @if (filteredCommands().length > 0) {
    <mat-list>
      @for (cmd of filteredCommands(); track cmd.id; let i = $index) {
      <mat-list-item #listItem [class.selected]="i === selectedIndex()" (click)="executeCommand(cmd)"
        (mouseenter)="selectedIndex.set(i)">
        <mat-icon matListItemIcon>{{ cmd.icon }}</mat-icon>
        <span matListItemTitle>{{ cmd.label }}</span>
        @if (cmd.description) {
        <span matListItemLine>{{ cmd.description }}</span>
        }
      </mat-list-item>
      }
    </mat-list>
    } @else {
    <div class="no-results">
      <p>No commands found.</p>
    </div>
    }
  </div>

  <div class="footer">
    <button mat-button class="voice-button" (click)="toggleRecording()" [disabled]="isTranscribing()">
      <mat-icon>{{ isListening() ? 'mic_off' : 'keyboard_voice' }}</mat-icon>
      <span>{{ isListening() ? 'Stop' : 'Voice command' }}</span>
    </button>
  </div>
</div>