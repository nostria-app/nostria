<mat-card class="relay-status-card">
  <mat-card-header>
    <mat-card-title>
      <div class="status-header">
        <mat-icon [class.spinning]="pendingCount > 0">{{ pendingCount > 0 ? 'sync' : 'cloud_done' }}</mat-icon>
        <span>{{ pendingCount > 0 ? 'Publishing Event' : 'Event Published' }}</span>
        <div class="status-indicators">
          <span class="status-chip success" matTooltip="Successful relays">
            <mat-icon>check_circle</mat-icon> {{ successCount }}
          </span>
          @if (pendingCount > 0) {
          <span class="status-chip pending" matTooltip="Pending relays">
            <mat-icon>pending</mat-icon> {{ pendingCount }}
          </span>
          }
          @if (failedCount > 0) {
          <span class="status-chip failed" matTooltip="Failed relays">
            <mat-icon>error</mat-icon> {{ failedCount }}
          </span>
          }
        </div>
      </div>
    </mat-card-title>
    <mat-card-subtitle>
      <div class="subtitle-row">
        <span>Event ID: <a (click)="layout.openGenericEvent(notification().event.id)" tabindex="0">{{
            notification().event.id.substring(0, 8)
            }}</a>...</span>
        <span class="progress-text">{{ progress | number:'1.0-0' }}% complete</span>
      </div>
    </mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <mat-progress-bar mode="determinate" [value]="progress"
      [color]="hasFailures && pendingCount === 0 ? 'warn' : 'primary'"></mat-progress-bar>

    <div class="relays-container">
      @for (relay of notification().relayPromises; track trackByRelayUrl($index, relay)) {
      <div class="relay-item" [class.success]="relay.status === 'success'" [class.failed]="relay.status === 'failed'"
        [class.pending]="relay.status === 'pending'">
        <div class="relay-info">
          <span class="relay-name">{{ getRelayName(relay.relayUrl) }}</span>
          @if (relay.status === 'failed' && relay.error) {
          <span class="relay-error">{{ getErrorMessage(relay.error) }}</span>
          }
        </div>
        <span class="relay-status">
          @if (relay.status === 'success') {
          <mat-icon class="status-icon success" matTooltip="Published successfully">check_circle</mat-icon>
          } @else if (relay.status === 'failed') {
          <mat-icon class="status-icon failed" [matTooltip]="getErrorMessage(relay.error)">error</mat-icon>
          } @else {
          <mat-icon class="status-icon pending spinning" matTooltip="Publishing...">sync</mat-icon>
          }
        </span>
      </div>
      }
    </div>
  </mat-card-content>

  <mat-card-actions align="end">
    <button mat-button (click)="viewEventJson()" matTooltip="View the raw event JSON structure">
      <mat-icon>code</mat-icon> VIEW EVENT JSON
    </button>
    @if (hasFailures) {
    <button mat-raised-button color="warn" (click)="onRepublish()">
      <mat-icon>refresh</mat-icon> RETRY {{ failedCount }} FAILED
    </button>
    }
    <button mat-button color="primary" (click)="onRepublish()">
      <mat-icon>refresh</mat-icon> REPUBLISH TO ALL RELAYS
    </button>
  </mat-card-actions>
</mat-card>