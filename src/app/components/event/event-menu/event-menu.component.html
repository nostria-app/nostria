@if (view() === 'full') {
<button mat-icon-button [matMenuTriggerFor]="menu" aria-label="More options" (click)="$event.stopPropagation()">
  <mat-icon>more_vert</mat-icon>
</button>
} @else {
<button mat-icon-button [matMenuTriggerFor]="menu" aria-label="More options" (click)="$event.stopPropagation()">
  <mat-icon>more_vert</mat-icon>
</button>
}

<mat-menu #menu="matMenu">
  <button mat-menu-item [matMenuTriggerFor]="copyMenu">
    <mat-icon>content_copy</mat-icon>
    Copy
  </button>
  @if (canShowProfileMenu()) {
  <button mat-menu-item [matMenuTriggerFor]="profileMenu">
    <mat-icon>account_circle</mat-icon>
    Profile
  </button>
  }
  <mat-divider></mat-divider>
  @if (showPinOptions()) {
  <button mat-menu-item (click)="onPinClick($event)">
    <mat-icon [matTooltip]="pinned.getPinTooltip(event().id)" matTooltipPosition="below">
      {{ pinned.getPinIcon(event().id) }}
    </mat-icon>
    @if (pinned.isPinned(event().id)) {
    Unpin
    } @else {
    Pin
    }
  </button>
  }
  <button mat-menu-item (click)="shareEventDialog()">
    <mat-icon>share</mat-icon>
    Share
  </button>
  <button mat-menu-item (click)="onBookmarkClick($event)">
    <mat-icon
      [matTooltip]="bookmark.getBookmarkTooltip(isArticle() ? articleId() : event().id, isArticle() ? 'a' : 'e')"
      matTooltipPosition="below">
      {{ bookmark.getBookmarkIcon(isArticle() ? articleId() : event().id, isArticle() ? 'a' : 'e') }}
    </mat-icon>
    @if (bookmark.isBookmarkedInAnyList(isArticle() ? articleId() : event().id, isArticle() ? 'a' : 'e')) {
    Bookmark
    } @else {
    Bookmark
    }
  </button>
  <button mat-menu-item [matMenuTriggerFor]="advancedMenu">
    <mat-icon>tune</mat-icon>
    Advanced
  </button>
  @if (hasMedia()) {
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="addMediaToQueue()">
    <mat-icon>playlist_add</mat-icon>
    Add to Queue
  </button>
  <button mat-menu-item [matMenuTriggerFor]="playlistMenu">
    <mat-icon>video_library</mat-icon>
    Add to Playlist
  </button>
  <button mat-menu-item (click)="playMediaInPlayer()">
    <mat-icon>play_circle</mat-icon>
    Play in Media Player
  </button>
  }
  @if (showAiOptions()) {
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="translate()">
    <mat-icon>translate</mat-icon>
    Translate
  </button>
  <button mat-menu-item (click)="readAloud()">
    <mat-icon>record_voice_over</mat-icon>
    Read Aloud
  </button>
  <mat-divider></mat-divider>
  @if (isOurEvent() && isTextNote()) {
  <button mat-menu-item (click)="editEvent()">
    <mat-icon>edit</mat-icon>
    Edit
  </button>
  }
  @if (isOurEvent()) {
  <button mat-menu-item (click)="deleteEvent()">
    <mat-icon>delete</mat-icon>
    Delete
  </button>
  }
  }
  <button mat-menu-item (click)="reportContent()">
    <mat-icon>warning</mat-icon>
    Report Content
  </button>
  @if (event().pubkey !== accountState.pubkey()) {
  <button mat-menu-item (click)="accountState.mutePubkey(event().pubkey)">
    <mat-icon>block</mat-icon>
    <span>Block User</span>
  </button>
  }

</mat-menu>

<mat-menu #profileMenu="matMenu">
  <button mat-menu-item (click)="toggleAuthorFollow()">
    <mat-icon>{{ isAuthorFollowed() ? 'person_remove' : 'person_add' }}</mat-icon>
    {{ isAuthorFollowed() ? 'Unfollow' : 'Follow' }}
  </button>
  <button mat-menu-item (click)="toggleAuthorFavorite()">
    <mat-icon>{{ isAuthorFavorite() ? 'heart_minus' : 'heart_plus' }}</mat-icon>
    {{ isAuthorFavorite() ? 'Unfavorite' : 'Favorite' }}
  </button>
  <button mat-menu-item [matMenuTriggerFor]="profileListsMenu">
    <mat-icon>group_add</mat-icon>
    Add to list
  </button>
</mat-menu>

<mat-menu #profileListsMenu="matMenu">
  @for (set of availableFollowSets(); track set.id) {
  <button mat-menu-item (click)="addAuthorToFollowSet(set.dTag)">
    <mat-icon>{{ isAuthorInFollowSet(set.dTag) ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
    <span>{{ set.title }}</span>
  </button>
  }
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="createNewFollowSetForAuthor()">
    <mat-icon>add_circle</mat-icon>
    Create new list
  </button>
</mat-menu>

<mat-menu #copyMenu="matMenu">
  <button mat-menu-item (click)="layout.copyToClipboard(eventLink(), 'text')">
    <mat-icon>link</mat-icon>
    Link
  </button>
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="layout.copyToClipboard(eventEncodedId(), 'text')">
    <mat-icon>content_copy</mat-icon>
    ID
  </button>
  @if (isArticle()) {
  <button mat-menu-item (click)="layout.copyToClipboard(articleId(), 'text')">
    <mat-icon>article</mat-icon>
    Article ID
  </button>
  }
  <button mat-menu-item (click)="layout.copyToClipboard(event().id, 'hex')">
    <mat-icon>content_copy</mat-icon>
    ID (hex)
  </button>
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="layout.copyToClipboard(record()?.data, 'text')">
    <mat-icon>content_copy</mat-icon>
    Text
  </button>
  <button mat-menu-item (click)="layout.copyToClipboard(event(), 'json')">
    <mat-icon>content_copy</mat-icon>
    Data
  </button>
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="copyAsImage()">
    <mat-icon>image</mat-icon>
    Screenshot
  </button>
</mat-menu>

<mat-menu #playlistMenu="matMenu">
  <button mat-menu-item (click)="addMediaToPlaylist('watch-later')">
    <mat-icon>watch_later</mat-icon>
    Watch Later
  </button>
  @if (playlistService.userPlaylists().length > 0) {
  <mat-divider></mat-divider>
  @for (playlist of playlistService.userPlaylists(); track playlist.id) {
  @if (playlist.id !== 'watch-later') {
  <button mat-menu-item (click)="addMediaToPlaylist(playlist.id)">
    <mat-icon>playlist_play</mat-icon>
    {{ playlist.title }}
  </button>
  }
  }
  }
</mat-menu>

<mat-menu #advancedMenu="matMenu">
  <button mat-menu-item (click)="openEventDetails()">
    <mat-icon>info</mat-icon>
    Details
  </button>
  <button mat-menu-item (click)="layout.publishEvent(event())">
    <mat-icon>cell_tower</mat-icon>
    Republish
  </button>
  @if (isOurEvent() && isPremium()) {
  <button mat-menu-item (click)="goToNewsletter()">
    <mat-icon>mail</mat-icon>
    Newsletter
  </button>
  <button mat-menu-item (click)="goToEventAnalytics()">
    <mat-icon>analytics</mat-icon>
    Analytics
  </button>
  }
</mat-menu>