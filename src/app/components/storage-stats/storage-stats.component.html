<div>
  <h2>Local Database</h2>
  <!-- <p>Statistics and management of cached data</p> -->

  <div class="stats-container">
    <div class="stat-item">
      <div class="stat-value">{{ stats().relaysCount }}</div>
      <div class="stat-label">Relays</div>
    </div>
    <!-- <div class="stat-item">
            <div class="stat-value">{{ stats().userMetadataCount }}</div>
            <div class="stat-label">User Profiles</div>
        </div> -->
    <!-- <div class="stat-item">
            <div class="stat-value">{{ stats().userRelaysCount }}</div>
            <div class="stat-label">User Relay Lists</div>
        </div> -->
    <div class="stat-item">
      <div class="stat-value">{{ formattedSize() }}</div>
      <div class="stat-label">Total Size</div>
    </div>
  </div>

  <p class="mb-2">
    The local database stores relay information, user metadata, and user relay lists to improve
    performance and reduce network requests. The storage estimate includes both IndexedDB and Cache API data.
  </p>

  <p class="mb-3">
    Clearing the cache will remove all cached data from the local database. Your account credentials
    will be preserved, but you'll need to re-fetch data from relays. This can help if you're experiencing
    issues or want to free up space.
  </p>

  @if (isClearing()) {
  <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  }
  <div class="storage-actions">
    <button mat-button [disabled]="isClearing()" (click)="refreshStats()">
      <mat-icon>refresh</mat-icon>
      REFRESH
    </button>
    &nbsp;
    <button mat-flat-button [disabled]="isClearing()" (click)="clearCache('all')">
      <mat-icon>delete_sweep</mat-icon>
      CLEAR ALL CACHE
    </button>
    &nbsp;
    <button mat-stroked-button [matMenuTriggerFor]="cacheMenu" [disabled]="isClearing()">
      <mat-icon>arrow_drop_down</mat-icon>
      CLEAR SPECIFIC CACHE
    </button>
    <mat-menu #cacheMenu="matMenu">
      <button mat-menu-item (click)="clearCache('events')">
        <mat-icon>event</mat-icon>
        <span>Clear Events Cache</span>
      </button>
      <button mat-menu-item (click)="clearCache('notifications')">
        <mat-icon>notifications</mat-icon>
        <span>Clear Notifications Cache</span>
      </button>
      <button mat-menu-item (click)="clearCache('messages')">
        <mat-icon>message</mat-icon>
        <span>Clear Messages Cache</span>
      </button>
      <button mat-menu-item (click)="clearCache('relays')">
        <mat-icon>dns</mat-icon>
        <span>Clear Relays Cache</span>
      </button>
      <button mat-menu-item (click)="clearCache('images')">
        <mat-icon>image</mat-icon>
        <span>Clear Image Cache</span>
      </button>
      <button mat-menu-item (click)="clearCache('ai-models')">
        <mat-icon>psychology</mat-icon>
        <span>Delete AI Models</span>
      </button>
    </mat-menu>
  </div>
</div>