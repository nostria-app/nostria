:host {
  display: block;
  width: 100%;
  height: 100%;
}

// WinAmp color palette
$winamp-bg: #232323;
$winamp-dark: #1a1a1a;
$winamp-border: #4a4a4a;
$winamp-text: #00ff00;
$winamp-text-dim: #008800;
$winamp-highlight: #ffcc00;
$winamp-button: #3a3a3a;
$winamp-button-pressed: #2a2a2a;

.winamp-player {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: linear-gradient(180deg, #2a2a3a 0%, #1a1a2a 100%);
  padding: 16px;
  gap: 4px;
  font-family: 'Courier New', monospace;
  overflow: auto;
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;

  img {
    -webkit-user-drag: none;
    user-drag: none;
    pointer-events: none;
  }
}

// Content wrapper for scaling
.winamp-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  transition: transform 0.2s ease;

  // 2x scale mode
  &.double-size {
    transform: scale(2);
    transform-origin: center center;
  }
}

// Main player window
.winamp-main {
  width: 275px;
  background: linear-gradient(180deg, $winamp-bg 0%, $winamp-dark 100%);
  border: 2px solid $winamp-border;
  border-radius: 4px;
  box-shadow:
    inset 1px 1px 0 rgba(255, 255, 255, 0.1),
    inset -1px -1px 0 rgba(0, 0, 0, 0.3),
    0 4px 16px rgba(0, 0, 0, 0.5);
}

// Title bar
.title-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 2px 4px;
  background: linear-gradient(90deg, #4a4a6a, #2a2a4a);
  border-bottom: 1px solid $winamp-border;

  .winamp-logo {
    font-size: 10px;
    color: white;
    text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5);
    letter-spacing: 1px;
  }

  .title-bar-buttons {
    display: flex;
    gap: 2px;

    .title-btn {
      width: 14px;
      height: 12px;
      font-size: 10px;
      line-height: 1;
      border: 1px solid #666;
      background: linear-gradient(180deg, #5a5a5a, #3a3a3a);
      color: white;
      cursor: pointer;
      padding: 0;

      &:active {
        background: linear-gradient(180deg, #3a3a3a, #5a5a5a);
      }

      &.active {
        background: linear-gradient(180deg, #3a6a3a, #2a4a2a);
        color: $winamp-text;
        border-color: $winamp-text-dim;
      }

      &.close {
        background: linear-gradient(180deg, #8a4a4a, #6a2a2a);
      }
    }
  }
}

// Display section
.display-section {
  display: flex;
  margin: 4px;
  background: #000;
  border: 2px inset #333;
  padding: 4px;
}

.display-left {
  width: 100px;
  display: flex;
  flex-direction: column;
  gap: 4px;

  .time-display {
    background: #000;
    padding: 4px 8px;
    text-align: right;

    .time-value {
      font-size: 24px;
      color: $winamp-text;
      font-family: 'Digital-7', 'Courier New', monospace;
      text-shadow: 0 0 8px rgba($winamp-text, 0.5);
    }
  }
}

// Visualizer
.visualizer {
  display: flex;
  gap: 1px;
  height: 40px;
  background: #000;
  padding: 2px;
  align-items: flex-end;

  .visualizer-bar {
    flex: 1;
    min-width: 3px;
    transition: height 0.05s ease-out;

    .bar-segments {
      height: 100%;
      display: flex;
      flex-direction: column-reverse;
      gap: 1px;

      .segment {
        flex: 1;
        background: #002200;
        min-height: 2px;

        &.active {
          background: $winamp-text;
          box-shadow: 0 0 2px $winamp-text;
        }

        &.active.high {
          background: $winamp-highlight;
          box-shadow: 0 0 2px $winamp-highlight;
        }

        &.active.peak {
          background: #ff4444;
          box-shadow: 0 0 2px #ff4444;
        }
      }
    }
  }
}

.display-right {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
  padding-left: 4px;
  min-width: 0; // Allow flex child to shrink

  .scrolling-text {
    background: #000;
    padding: 2px 4px;
    overflow: hidden;
    width: 100%; // Fixed width container

    .marquee-text {
      font-size: 10px;
      color: $winamp-text;
      white-space: nowrap;
      text-shadow: 0 0 4px rgba($winamp-text, 0.5);
      display: block;
      width: 150px; // Fixed width to prevent jumping
      overflow: hidden;
    }
  }

  .info-row {
    display: flex;
    gap: 8px;
    font-size: 8px;
    color: $winamp-text-dim;

    .bitrate,
    .sample-rate {
      .label {
        color: $winamp-text;
      }

      .unit {
        color: $winamp-text-dim;
      }
    }

    .channels {
      .stereo {
        color: $winamp-text-dim;

        &.active {
          color: $winamp-text;
        }
      }
    }
  }

  .position-bar {
    margin-top: auto;
  }
}

// WinAmp style sliders
.winamp-slider {
  -webkit-appearance: none;
  appearance: none;
  background: transparent;
  cursor: pointer;

  &::-webkit-slider-track {
    height: 6px;
    background: linear-gradient(180deg, #1a1a1a, #333);
    border: 1px solid #444;
    border-radius: 0;
  }

  &::-moz-range-track {
    height: 6px;
    background: linear-gradient(180deg, #1a1a1a, #333);
    border: 1px solid #444;
    border-radius: 0;
  }

  &::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px;
    height: 10px;
    background: linear-gradient(180deg, #888, #444);
    border: 1px solid #666;
    border-radius: 2px;
    cursor: grab;

    &:active {
      cursor: grabbing;
      background: linear-gradient(180deg, #666, #333);
    }
  }

  &::-moz-range-thumb {
    width: 14px;
    height: 10px;
    background: linear-gradient(180deg, #888, #444);
    border: 1px solid #666;
    border-radius: 2px;
    cursor: grab;
  }
}

.position-slider {
  width: 100%;
}

// Volume section
.volume-section {
  display: flex;
  gap: 8px;
  padding: 4px 8px;

  .volume-control,
  .balance-control {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 2px;

    span {
      font-size: 7px;
      color: $winamp-text-dim;
      text-transform: uppercase;
    }
  }

  .volume-slider,
  .balance-slider {
    width: 100%;
  }
}

// Transport controls
.transport-controls {
  display: flex;
  justify-content: center;
  gap: 2px;
  padding: 4px 8px;

  .transport-btn {
    width: 36px;
    height: 24px;
    background: linear-gradient(180deg, #5a5a5a, #3a3a3a);
    border: 1px solid #666;
    border-radius: 2px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #ccc;

    mat-icon {
      font-size: 16px;
      width: 16px;
      height: 16px;
    }

    &:active {
      background: linear-gradient(180deg, #3a3a3a, #5a5a5a);
    }

    &:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    &.play mat-icon {
      color: $winamp-text;
    }

    &.pause mat-icon {
      color: $winamp-highlight;
    }
  }
}

// Toggle buttons
.toggle-buttons {
  display: flex;
  justify-content: center;
  gap: 4px;
  padding: 4px 8px 8px;

  .toggle-btn {
    padding: 2px 8px;
    font-size: 8px;
    background: linear-gradient(180deg, #4a4a4a, #2a2a2a);
    border: 1px solid #555;
    color: #888;
    cursor: pointer;
    text-transform: uppercase;

    &.active {
      color: $winamp-text;
      background: linear-gradient(180deg, #2a2a2a, #4a4a4a);
      box-shadow: inset 0 0 4px rgba($winamp-text, 0.3);
    }

    &.small {
      padding: 1px 4px;
      font-size: 7px;
    }
  }
}

// Equalizer window
.winamp-eq {
  width: 275px;
  background: linear-gradient(180deg, $winamp-bg 0%, $winamp-dark 100%);
  border: 2px solid $winamp-border;
  border-radius: 4px;
  box-shadow:
    inset 1px 1px 0 rgba(255, 255, 255, 0.1),
    inset -1px -1px 0 rgba(0, 0, 0, 0.3),
    0 4px 16px rgba(0, 0, 0, 0.5);

  .eq-title-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 2px 4px;
    background: linear-gradient(90deg, #4a4a6a, #2a2a4a);
    border-bottom: 1px solid $winamp-border;
    font-size: 9px;
    color: white;
    gap: 4px;

    .eq-toggle {
      display: flex;
      gap: 2px;
    }

    .eq-presets-inline {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-left: auto;

      .presets-label {
        font-size: 7px;
        color: $winamp-text-dim;
      }

      .preset-dropdown-btn {
        background: linear-gradient(180deg, #3a3a3a, #2a2a2a);
        border: 1px solid #555;
        color: $winamp-text;
        font-size: 7px;
        padding: 1px 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 4px;
        min-width: 60px;

        &:hover {
          background: linear-gradient(180deg, #4a4a4a, #3a3a3a);
        }

        .dropdown-arrow {
          font-size: 6px;
          margin-left: auto;
        }
      }
    }
  }

  // EQ activation/status banners
  .eq-activate-banner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 6px;
    padding: 4px 6px;
    margin: 2px 4px;
    background: linear-gradient(180deg, #2a2a1a, #1a1a10);
    border: 1px solid #554400;
    border-radius: 2px;

    .eq-activate-info {
      display: flex;
      flex-direction: column;
      gap: 1px;

      .eq-activate-text {
        font-size: 7px;
        color: $winamp-text;
      }

      .eq-activate-note {
        font-size: 6px;
        color: $winamp-text-dim;
      }
    }

    .eq-activate-btn {
      display: flex;
      align-items: center;
      gap: 2px;
      padding: 2px 6px;
      font-size: 7px;
      background: linear-gradient(180deg, #5a5a2a, #3a3a1a);
      border: 1px solid #887700;
      color: $winamp-text;
      cursor: pointer;
      white-space: nowrap;

      mat-icon {
        font-size: 10px;
        width: 10px;
        height: 10px;
      }

      &:hover {
        background: linear-gradient(180deg, #6a6a3a, #4a4a2a);
      }

      &:disabled {
        opacity: 0.4;
        cursor: default;
      }
    }
  }

  .eq-active-banner {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 3px 6px;
    margin: 2px 4px;
    background: linear-gradient(180deg, #1a2a1a, #102a10);
    border: 1px solid #005500;
    border-radius: 2px;
    font-size: 7px;
    color: $winamp-text;

    .eq-active-icon {
      font-size: 10px;
      width: 10px;
      height: 10px;
      color: #00cc00;
    }
  }

  // EQ Graph showing current curve
  .eq-graph {
    background: #000;
    margin: 4px 4px 0;
    border: 2px inset #333;
    height: 32px;
    position: relative;
    overflow: hidden;

    .eq-graph-grid {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 2px 4px;
      pointer-events: none;

      .grid-line {
        font-size: 5px;
        color: #333;
        border-bottom: 1px dotted #222;

        &.top {
          color: #444;
        }

        &.middle {
          color: $winamp-text-dim;
        }

        &.bottom {
          border-bottom: none;
        }
      }
    }

    .eq-curve {
      position: absolute;
      inset: 4px;
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      gap: 2px;

      .curve-point {
        width: 6px;
        height: 6px;
        background: $winamp-text;
        border-radius: 50%;
        box-shadow: 0 0 4px $winamp-text;
        position: relative;
        transition: bottom 0.1s ease;

        &.disabled {
          background: #444;
          box-shadow: none;
        }

        &::before {
          content: '';
          position: absolute;
          bottom: 3px;
          left: 50%;
          transform: translateX(-50%);
          width: 1px;
          height: 100px;
          background: linear-gradient(to top, transparent, rgba($winamp-text, 0.3));
        }
      }
    }
  }

  .eq-sliders {
    display: flex;
    padding: 8px;
    gap: 4px;
    background: #000;
    margin: 4px;
    border: 2px inset #333;

    .preamp {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .eq-divider {
      width: 2px;
      background: linear-gradient(180deg, #444, #222, #444);
      margin: 0 4px;
    }

    .frequency-bands {
      display: flex;
      flex: 1;
      justify-content: space-between;
    }

    .eq-band {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .slider-track {
      position: relative;
      width: 16px;
      height: 50px;
      display: flex;
      justify-content: center;

      .slider-fill {
        position: absolute;
        bottom: 0;
        left: 2px;
        right: 2px;
        background: linear-gradient(to top, #003300, $winamp-text);
        border-radius: 1px;
        pointer-events: none;
        opacity: 0.5;
        transition: height 0.1s ease;

        &.disabled {
          background: linear-gradient(to top, #222, #444);
        }
      }
    }

    .eq-slider {
      -webkit-appearance: slider-vertical;
      appearance: slider-vertical;
      writing-mode: vertical-lr;
      direction: rtl;
      width: 16px;
      height: 50px;
      background: transparent;
      position: relative;
      z-index: 1;

      &::-webkit-slider-runnable-track {
        width: 6px;
        height: 100%;
        background: linear-gradient(180deg,
            #ff4444 0%, #ff4444 10%,
            $winamp-highlight 10%, $winamp-highlight 30%,
            $winamp-text 30%, $winamp-text 100%);
        border: 1px solid #333;
        border-radius: 2px;
      }

      &::-moz-range-track {
        width: 6px;
        height: 100%;
        background: linear-gradient(180deg,
            #ff4444 0%, #ff4444 10%,
            $winamp-highlight 10%, $winamp-highlight 30%,
            $winamp-text 30%, $winamp-text 100%);
        border: 1px solid #333;
        border-radius: 2px;
      }

      &::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 16px;
        height: 6px;
        background: linear-gradient(180deg, #ccc, #888, #666);
        border: 1px solid #444;
        border-radius: 1px;
        cursor: grab;
        box-shadow:
          inset 0 1px 0 rgba(255, 255, 255, 0.3),
          0 1px 2px rgba(0, 0, 0, 0.5);

        &:active {
          cursor: grabbing;
          background: linear-gradient(180deg, #888, #666, #444);
        }
      }

      &::-moz-range-thumb {
        width: 16px;
        height: 6px;
        background: linear-gradient(180deg, #ccc, #888, #666);
        border: 1px solid #444;
        border-radius: 1px;
        cursor: grab;
        box-shadow:
          inset 0 1px 0 rgba(255, 255, 255, 0.3),
          0 1px 2px rgba(0, 0, 0, 0.5);
      }

      &.disabled {
        opacity: 0.5;
        pointer-events: none;

        &::-webkit-slider-runnable-track {
          background: linear-gradient(180deg, #333, #222);
        }

        &::-moz-range-track {
          background: linear-gradient(180deg, #333, #222);
        }
      }
    }

    .eq-label {
      font-size: 6px;
      color: $winamp-text-dim;
    }
  }
}

// Custom styling for the preset menu
::ng-deep .winamp-preset-menu {
  .mat-mdc-menu-content {
    background: linear-gradient(180deg, $winamp-bg, $winamp-dark) !important;
    padding: 0 !important;
  }

  .mat-mdc-menu-item {
    font-size: 10px !important;
    font-family: 'Courier New', monospace !important;
    color: $winamp-text-dim !important;
    min-height: 24px !important;
    padding: 4px 8px !important;

    &:hover {
      background: rgba($winamp-text, 0.1) !important;
      color: $winamp-text !important;
    }

    &.active {
      color: $winamp-text !important;
      background: rgba($winamp-text, 0.2) !important;
    }
  }
}

// Lyrics window (styled like WinAmp window)
.winamp-lyrics {
  width: 275px;
  min-height: 200px;
  max-height: 300px;
  background: linear-gradient(180deg, $winamp-bg 0%, $winamp-dark 100%);
  border: 2px solid $winamp-border;
  border-radius: 4px;
  box-shadow:
    inset 1px 1px 0 rgba(255, 255, 255, 0.1),
    inset -1px -1px 0 rgba(0, 0, 0, 0.3),
    0 4px 16px rgba(0, 0, 0, 0.5);
  display: flex;
  flex-direction: column;
  overflow: hidden;

  .lyrics-title-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 2px 4px;
    background: linear-gradient(90deg, #4a4a6a, #2a2a4a);
    border-bottom: 1px solid $winamp-border;
    flex-shrink: 0;

    span {
      font-size: 10px;
      color: white;
      text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5);
      letter-spacing: 1px;
    }

    .title-btn {
      width: 14px;
      height: 12px;
      font-size: 10px;
      line-height: 1;
      border: 1px solid #666;
      background: linear-gradient(180deg, #5a5a5a, #3a3a3a);
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;

      &:hover {
        background: linear-gradient(180deg, #6a6a6a, #4a4a4a);
      }
    }
  }

  .lyrics-content-wrapper {
    flex: 1;
    min-height: 0;
    overflow: hidden;

    app-lyrics-view {
      display: block;
      height: 100%;

      ::ng-deep {
        .lyrics-container {
          background: transparent;
          border-radius: 0;
        }

        .lyrics-header {
          display: none;
        }

        .lyrics-content {
          padding: 8px;
        }

        .synced-lyrics .lyric-line {
          font-size: 0.75rem;
          font-family: 'Courier New', monospace;
          color: $winamp-text-dim;

          &.active {
            color: $winamp-text;
            font-size: 0.85rem;
            background: rgba(0, 255, 0, 0.1);
          }
        }

        .plain-lyrics p {
          font-size: 0.75rem;
          font-family: 'Courier New', monospace;
          color: $winamp-text;
        }

        .lyrics-empty,
        .lyrics-loading,
        .lyrics-error {
          color: $winamp-text-dim;

          mat-icon {
            color: $winamp-text-dim;
          }
        }
      }
    }
  }
}