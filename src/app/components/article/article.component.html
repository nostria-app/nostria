@let item = record();

@if (loading()) {
<div class="article-loading">
  <p>Loading...</p>
</div>
} @else if (item) {
<div class="article-container" [class]="'mode-' + mode()">
  @if (mode() === 'compact') {
  <div class="article-compact" [class.clickable]="clickable()" [attr.tabindex]="clickable() ? '0' : null"
    [attr.role]="clickable() ? 'button' : null" (click)="openArticle()" (keydown.enter)="openArticle()"
    (keydown.space)="openArticle()">
    @if (image()) {
    <div class="article-image-container">
      <img [src]="image()" alt="Article image" title="Article image" loading="lazy" class="article-image" />
    </div>
    }
    <div class="article-content">
      <h3 class="article-title">{{ title() || 'Untitled Article' }}</h3>
      @if (summary()) {
      <p class="article-summary">{{ summary() }}</p>
      }
      @if (showMetadata()) {
      <div class="article-meta-row">
        @if (showAuthor()) {
        <app-user-profile [pubkey]="authorPubkey()" [view]="'compact'" [showRank]="false"
          [hostWidthAuto]="true"></app-user-profile>
        }

        <div class="article-meta">
          <span class="read-time">{{ readTime() }} min read</span>
          <span class="meta-separator">•</span>
          <app-date-toggle [date]="publishedAtTimestamp()"></app-date-toggle>
        </div>

        @if (hashtags().length > 0) {
        <mat-chip-set>
          @for (hashtag of hashtags().slice(0, 3); track hashtag) {
          <mat-chip (click)="openHashtagFeed(hashtag, $event)">{{ hashtag }}</mat-chip>
          }
        </mat-chip-set>
        }
      </div>
      }
    </div>
  </div>
  } @else if (mode() === 'card') {
  <mat-card class="article-card" [class.clickable]="clickable()" (click)="openArticle()">
    <div class="card-layout">
      @if (image()) {
      <div class="card-image">
        <img [src]="image()" alt="Article image" title="Article image" loading="lazy" />
      </div>
      }
      <div class="card-content">
        <h3 class="card-title">{{ title() || 'Untitled Article' }}</h3>
        @if (summary()) {
        <p class="card-summary">{{ summary() }}</p>
        }
        <div class="card-footer" [class.without-author]="!showAuthor()">
          @if (showAuthor()) {
          <app-user-profile [pubkey]="authorPubkey()" [view]="'compact'" [showRank]="false"
            [hostWidthAuto]="true"></app-user-profile>
          }
          @if (showMetadata()) {
          <div class="card-meta">
            <span class="read-time">{{ readTime() }} min read</span>
            <span class="meta-separator">•</span>
            <app-date-toggle [date]="publishedAtTimestamp()"></app-date-toggle>
          </div>
          }
        </div>
        @if (showMetadata() && hashtags().length > 0) {
        <mat-chip-set class="card-tags">
          @for (hashtag of hashtags().slice(0, 4); track hashtag) {
          <mat-chip (click)="openHashtagFeed(hashtag, $event)">{{ hashtag }}</mat-chip>
          }
        </mat-chip-set>
        }
      </div>
    </div>
  </mat-card>
  } @else {
  <div class="article-content" [class.clickable]="clickable()" [attr.tabindex]="clickable() ? '0' : null"
    [attr.role]="clickable() ? 'button' : null" (click)="openArticle()" (keydown.enter)="openArticle()"
    (keydown.space)="openArticle()">
    @if (showAuthor()) {
    <app-user-profile [pubkey]="authorPubkey()"></app-user-profile>
    }
    {{ item.data }}
  </div>
  }
</div>
} @else {
<div class="article-error">
  <p>Article not found</p>
</div>
}