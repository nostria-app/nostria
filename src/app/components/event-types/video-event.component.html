@if (hasContentWarning()) {
<div class="content-warning">
  <mat-icon>warning</mat-icon>
  <span>{{ contentWarning() }}</span>
</div>
}

@if (title() && !showOverlay()) {
<h3 class="media-title">{{ title() }}</h3>
}

@let videoInfo = videoData();
@let blurhashUrl = blurhashDataUrl();
@if (videoInfo) {
<div class="video-container" [class.clickable]="showOverlay()">
  @if (!isExpanded()) {
  <!-- Video Thumbnail (Initial State) -->
  <div class="video-thumbnail-container" tabindex="0" role="button" (click)="expandVideo($any($event))"
    (keyup.enter)="expandVideo($any($event))" (keyup.space)="expandVideo($any($event))">
    @if (videoInfo.thumbnail) {
    <!-- Use provided thumbnail image -->
    <img [src]="videoInfo.thumbnail" class="video-thumbnail" [alt]="videoInfo.alt || 'Video thumbnail'"
      [title]="videoInfo.title || 'Video thumbnail'" loading="lazy" />
    } @else if (videoInfo.blurhash && blurhashUrl) {
    <!-- Use blurhash as fallback -->
    <img [src]="blurhashUrl" class="video-thumbnail" [alt]="videoInfo.alt || 'Video thumbnail'"
      [title]="videoInfo.title || 'Video thumbnail'" />
    } @else {
    <!-- Use video element with preload="metadata" to show first frame -->
    <video [src]="videoInfo.url" preload="metadata" class="video-thumbnail"></video>
    }

    @if (videoInfo.duration) {
    <div class="video-duration">
      {{ formatDuration(videoInfo.duration) }}
    </div>
    }
  </div>
  } @else {
  <!-- Video Player (Expanded State) -->
  <div class="video-player-container">
    <video controls class="video-player" autoplay [poster]="videoInfo.thumbnail || blurhashUrl || undefined">
      <source [src]="videoInfo.url" [type]="videoMimeType()" />
      Your browser does not support the video tag.
    </video>
    <button mat-icon-button class="collapse-video-btn" (click)="collapseVideo()" matTooltip="Show thumbnail">
      <mat-icon>picture_in_picture_alt</mat-icon>
    </button>
  </div>
  }
</div>
}

@if (description() && !showOverlay()) {
<p class="video-description">
  {{ description() }}
</p>
}

@if (!hideComments()) {
<!-- NIP-22 Comments Section -->
<app-comments-list [event]="event()"></app-comments-list>
}