@if (hasContentWarning()) {
<div class="content-warning">
  <mat-icon>warning</mat-icon>
  <span>{{ contentWarning() }}</span>
</div>
}

@if (title() && !showOverlay()) {
<h3 class="media-title">{{ title() }}</h3>
}

<div class="photo-carousel-container" (touchstart)="onTouchStart($event)" (touchend)="onTouchEnd($event)"
  [class.clickable]="showOverlay()"
  (click)="showOverlay() ? openImageDialog(currentImageUrl(), currentAltText(), $event) : null">
  <div class="photo-carousel">
    <div class="photo-container" [class.blurred]="shouldBlurMedia()"
      [class.revealing]="!shouldBlurMedia() && isRevealed()" [class.image-loaded]="isCurrentImageLoaded()"
      [style.aspect-ratio]="currentAspectRatio()">
      @if (currentBlurhashDataUrl()) {
      <img [src]="currentBlurhashDataUrl()!" class="photo-item blurhash-placeholder" [alt]="currentAltText()"
        [title]="currentAltText()" aria-hidden="true" />
      }
      <img [src]="currentImageUrl()" [alt]="currentAltText()" [title]="currentAltText()" title="{{ currentAltText() }}"
        class="photo-item main-image" [class.hidden]="shouldBlurMedia()" [class.loaded]="isCurrentImageLoaded()"
        loading="lazy" (load)="onImageLoad($event)"
        (click)="!showOverlay() ? openImageDialog(currentImageUrl(), currentAltText(), $any($event)) : null"
        tabindex="0" role="button" (keyup.enter)="openImageDialog(currentImageUrl(), currentAltText(), $any($event))"
        (keyup.space)="openImageDialog(currentImageUrl(), currentAltText(), $any($event))" />

      <!-- Click to reveal overlay for blurred images -->
      @if (shouldBlurMedia()) {
      <div class="reveal-overlay">
        <div class="reveal-actions">
          <button class="reveal-btn" (click)="revealMedia(); $event.stopPropagation()">
            <mat-icon>visibility</mat-icon>
            <span>Reveal once</span>
          </button>
          <button class="reveal-btn trust-btn" (click)="trustAuthor(); $event.stopPropagation()">
            <mat-icon>verified_user</mat-icon>
            <span>Always reveal this user</span>
          </button>
        </div>
      </div>
      }
    </div>

    @if (hasMultipleImages()) {
    <!-- Navigation buttons -->
    @if (canGoToPrevious()) {
    <button mat-icon-button class="carousel-nav-button carousel-nav-left" (click)="goToPrevious()"
      aria-label="Previous photo">
      <mat-icon>chevron_left</mat-icon>
    </button>
    }

    @if (canGoToNext()) {
    <button mat-icon-button class="carousel-nav-button carousel-nav-right" (click)="goToNext()" aria-label="Next photo">
      <mat-icon>chevron_right</mat-icon>
    </button>
    }

    <!-- Indicator dots -->
    <div class="carousel-indicators">
      @for (imageUrl of imageUrls(); track imageUrl) {
      <button class="indicator-dot" [class.active]="currentCarouselIndex() === $index" (click)="goToIndex($index)"
        [attr.aria-label]="'Go to photo ' + ($index + 1)" title="Go to photo {{ $index + 1 }}">
        <span class="sr-only">Go to photo {{ $index + 1 }}</span>
      </button>
      }
    </div>
    }
  </div>
</div>

@if (description() && !showOverlay()) {
<p class="photo-description">
  {{ description() }}
</p>
}

<!-- Comments are handled by the parent EventComponent to avoid circular dependency -->
<!-- hideComments input is kept for API compatibility but comments are not rendered here -->