<!-- <div [ngClass]="['user-profile', view()]" (click)="layout.navigateToProfile(pubkey())"> -->
<!-- <div [ngClass]="['user-profile', view()]" (touchstart)="handleTouchEvent($event)" (touchmove)="handleTouchEvent($event)"
  (touchend)="handleTouchEvent($event)"> -->

<!--
  Set [hostWidthAuto] to true to make the host width 'auto' instead of '100%'.
  Example: <app-user-profile [hostWidthAuto]="true" ...></app-user-profile>
-->
<div [ngClass]="['user-profile', view()]">
  @if (info()) {
    <div
      class="user-info-status"
      [matTooltip]="getInfoTooltip()"
      [matTooltipClass]="'user-profile-tooltip'"
    >
      @if (this.info()!['hasRelayList']) {
        <mat-icon class="user-info-icon" [class]="getInfoClass()">info</mat-icon>
      } @else {
        <mat-icon class="user-info-icon" [class]="getInfoClass()">warning</mat-icon>
      }
    </div>
  }

  <div class="user-profile-container">
    <!-- Banner section for grid view -->
    @if (view() === 'grid' && profile()?.data?.banner) {
      <div class="user-profile-banner">
        <img
          [src]="profile().data.banner"
          onerror="this.onerror=null; this.src='images/banner-failure.png';"
          alt="User Banner"
          class="user-banner"
        />
      </div>
    }

    <!-- Avatar section - single image element -->
    @if (view() !== 'name' && view() !== 'tiny') {
      <a
        [routerLink]="['/p', npubValue()]"
        class="user-profile-avatar"
        [class.has-custom-tooltip]="view() === 'large' || view() === 'medium' || view() === 'small'"
        [attr.data-tooltip]="getTooltipContent()"
        (touchstart)="showTooltipOnTouch($event)"
      >
        @if (isLoading()) {
          <mat-spinner [diameter]="getSpinnerSize()" color="primary"></mat-spinner>
        } @else if (profile()?.data?.picture && !imageLoadError()) {
          @if (settingsService.settings().imageCacheEnabled) {
            <img
              [src]="
                'https://proxy.eu.nostria.app/api/ImageOptimizeProxy?w=250&h=250&url=' +
                profile().data.picture
              "
              (error)="onImageLoadError()"
              alt="User Avatar"
              class="user-avatar"
            />
          } @else {
            <img
              [src]="profile().data.picture"
              (error)="onImageLoadError()"
              alt="User Avatar"
              class="user-avatar"
            />
          }
        } @else {
          <mat-icon
            [ngClass]="[
              'default-user-avatar',
              isProfileNotFound() ? 'not-found-avatar' : '',
              imageLoadError() ? 'error-avatar' : '',
            ]"
            [style.font-size]="getDefaultAvatarSize()"
            [style.height]="getDefaultAvatarSize()"
            [style.width]="getDefaultAvatarSize()"
          >
            {{ isProfileNotFound() ? 'no_accounts' : 'account_circle' }}
          </mat-icon>
        }
      </a>
    }
    <!-- Content section with conditional rendering based on view -->

    @if (
      view() !== 'large' &&
      view() !== 'medium' &&
      view() !== 'small' &&
      view() !== 'icon' &&
      view() !== 'tiny' &&
      view() !== 'name'
    ) {
      <div class="user-profile-content">
        <!-- Name section -->
        <app-profile-display-name [pubkey]="pubkey()"></app-profile-display-name>

        <!-- NPUB section - only shown in appropriate views -->
        @if (view() === 'list' || view() === 'details') {
          <div class="user-profile-npub">{{ aliasOrNpub() }}</div>
        }

        <!-- About section - only shown in details view -->
        @if (view() === 'details' && profile() && profile().data && profile().data.about) {
          <div class="user-profile-about">{{ profile().data.about }}</div>
        }

        @if (view() === 'details' && profile() && profile().data) {
          @if (profile().data.nip05) {
            <div class="user-profile-details">NIP-05: {{ profile().data.nip05 }}</div>
          }
          @if (profile().data.lud16) {
            <div class="user-profile-details">LUD16: {{ profile().data.lud16 }}</div>
          }
          @if (profile().data.website) {
            <div class="user-profile-details">Website: {{ profile().data.website }}</div>
          }
        }
      </div>
    }

    @if (view() === 'name') {
      <div class="user-profile-content name-view">
        <a [routerLink]="['/p', npubValue()]" class="user-profile-avatar">
          <div class="user-profile-avatar name-avatar">
            @if (isLoading()) {
              <mat-spinner [diameter]="24" color="primary"></mat-spinner>
            } @else if (profile()?.data?.picture && !imageLoadError()) {
              @if (settingsService.settings().imageCacheEnabled) {
                <img
                  [src]="
                    'https://proxy.eu.nostria.app/api/ImageOptimizeProxy?w=24&h=24&url=' +
                    profile().data.picture
                  "
                  (error)="onImageLoadError()"
                  alt="User Avatar"
                  class="user-avatar"
                />
              } @else {
                <img
                  [src]="profile().data.picture"
                  (error)="onImageLoadError()"
                  alt="User Avatar"
                  class="user-avatar"
                />
              }
            } @else {
              <mat-icon
                [ngClass]="[
                  'default-user-avatar',
                  isProfileNotFound() ? 'not-found-avatar' : '',
                  imageLoadError() ? 'error-avatar' : '',
                ]"
                [style.font-size]="'24px'"
                [style.height]="'24px'"
                [style.width]="'24px'"
              >
                {{ isProfileNotFound() ? 'no_accounts' : 'account_circle' }}
              </mat-icon>
            }
          </div>
          <span class="user-profile-name name-label">
            <app-profile-display-name [pubkey]="pubkey()"></app-profile-display-name>
          </span>
        </a>
      </div>
    }

    @if (view() === 'tiny') {
      <a [routerLink]="['/p', npubValue()]" class="user-profile-content tiny-view">
        <div class="user-profile-avatar name-avatar">
          @if (isLoading()) {
            <mat-spinner [diameter]="24" color="primary"></mat-spinner>
          } @else if (profile()?.data?.picture && !imageLoadError()) {
            @if (settingsService.settings().imageCacheEnabled) {
              <img
                [src]="
                  'https://proxy.eu.nostria.app/api/ImageOptimizeProxy?w=24&h=24&url=' +
                  profile().data.picture
                "
                (error)="onImageLoadError()"
                alt="User Avatar"
                class="user-avatar"
              />
            } @else {
              <img
                [src]="profile().data.picture"
                (error)="onImageLoadError()"
                alt="User Avatar"
                class="user-avatar"
              />
            }
          } @else {
            <mat-icon
              [ngClass]="[
                'default-user-avatar',
                isProfileNotFound() ? 'not-found-avatar' : '',
                imageLoadError() ? 'error-avatar' : '',
              ]"
              [style.font-size]="'24px'"
              [style.height]="'24px'"
              [style.width]="'24px'"
            >
              {{ isProfileNotFound() ? 'no_accounts' : 'account_circle' }}
            </mat-icon>
          }
        </div>
        <span class="user-profile-name name-label">
          <app-profile-display-name [pubkey]="pubkey()"></app-profile-display-name>
        </span>
      </a>
    }

    <!-- Named content projection for additional controls (like more options button) -->
    <div class="user-profile-custom-content">
      <ng-content></ng-content>
    </div>
  </div>
</div>
