@if (shouldShowReferences()) {
<div class="tagged-references-container">

  <!-- User Mentions -->
  @if (mentions().length > 0) {
  <div class="mentions-section">
    <div class="section-header">
      <mat-icon>person</mat-icon>
      <span class="section-title">Mentioned</span>
    </div>
    <div class="mentions-list">
      @for (mention of mentions(); track mention.pubkey) {
      <div class="mention-item" (click)="onMentionClick(mention)" (keydown.enter)="onMentionClick(mention)"
        (keydown.space)="onMentionClick(mention)" tabindex="0" role="button" [attr.aria-label]="'View profile'">
        <mat-icon class="mention-icon">person</mat-icon>
        <app-profile-display-name [pubkey]="mention.pubkey"></app-profile-display-name>
        @if (mention.marker) {
        <span class="mention-marker">{{ mention.marker }}</span>
        }
      </div>
      }
    </div>
  </div>
  }

  <!-- Article References -->
  @if (articles().length > 0) {
  <div class="articles-section">
    <div class="section-header">
      <mat-icon>article</mat-icon>
      <span class="section-title">Referenced</span>
    </div>
    <div class="articles-list">
      @for (article of articles(); track article.kind + ':' + article.pubkey + ':' + article.identifier) {
      <a class="article-preview-card" (click)="onArticleClick(article)" (keydown.enter)="onArticleClick(article)"
        (keydown.space)="onArticleClick(article)" tabindex="0" role="button"
        [attr.aria-label]="'Open ' + getKindDisplayName(article.kind) + ': ' + getArticleTitle(article)">
        <mat-card>
          <div class="preview-content">
            <div class="thumbnail-container">
              @if (getArticleImage(article)) {
              <img class="thumbnail" [src]="getArticleImage(article)!" alt="Article preview image"
                title="Article preview image" />
              } @else {
              <div class="thumbnail-placeholder">
                <mat-icon class="article-icon">{{ getArticleIcon(article.kind) }}</mat-icon>
              </div>
              }
            </div>

            <div class="text-content">
              <div class="preview-title">
                {{ getArticleTitle(article) }}
              </div>
              <div class="preview-description">
                {{ getArticleDescription(article) }}
              </div>
              <div class="preview-metadata">
                <span class="article-kind">{{ getKindDisplayName(article.kind) }}</span>
                <span class="separator">•</span>
                <span class="article-author">
                  by <app-profile-display-name [pubkey]="article.pubkey"></app-profile-display-name>
                </span>
                @if (article.marker) {
                <span class="separator">•</span>
                <span class="article-marker">{{ article.marker }}</span>
                }
              </div>
            </div>
          </div>
        </mat-card>
      </a>
      }
    </div>
  </div>
  }

</div>
}