<div class="tab-content">
  @if (isLoading()) {
  <div class="loading">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading connection data...</p>
  </div>
  } @else {
  <!-- Relationship Status -->
  <mat-card class="stats-card">
    <mat-card-content>
      <div class="relationship-status">
        <mat-icon [class]="'status-icon ' + (stats().isFollowing && stats().followsUs ? 'mutual' : '')">
          {{ getRelationshipIcon() }}
        </mat-icon>
        <div class="status-text">
          <h3>{{ getRelationshipStatus() }}</h3>
          @if (stats().firstInteraction) {
          <p class="first-interaction">
            First interaction was {{ stats().daysSinceFirstInteraction }}
            {{ stats().daysSinceFirstInteraction === 1 ? 'day' : 'days' }} ago
          </p>
          } @else {
          <p class="first-interaction">No interactions yet</p>
          }
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Statistics Grid -->
  <div class="stats-grid">
    <!-- Total Interactions -->
    <mat-card class="stat-card">
      <mat-card-content>
        <mat-icon>swap_horiz</mat-icon>
        <div class="stat-value">{{ stats().totalInteractions }}</div>
        <div class="stat-label">Total Interactions</div>
      </mat-card-content>
    </mat-card>

    <!-- Likes Given/Received -->
    <mat-card class="stat-card">
      <mat-card-content>
        <mat-icon>favorite</mat-icon>
        <div class="stat-breakdown">
          <div class="stat-item">
            <span class="stat-value">{{ stats().ourLikes }}</span>
            <span class="stat-sublabel">Given</span>
          </div>
          <mat-divider [vertical]="true"></mat-divider>
          <div class="stat-item">
            <span class="stat-value">{{ stats().theirLikes }}</span>
            <span class="stat-sublabel">Received</span>
          </div>
        </div>
        <div class="stat-label">Likes</div>
      </mat-card-content>
    </mat-card>

    <!-- Replies Given/Received -->
    <mat-card class="stat-card">
      <mat-card-content>
        <mat-icon>reply</mat-icon>
        <div class="stat-breakdown">
          <div class="stat-item">
            <span class="stat-value">{{ stats().ourReplies }}</span>
            <span class="stat-sublabel">Given</span>
          </div>
          <mat-divider [vertical]="true"></mat-divider>
          <div class="stat-item">
            <span class="stat-value">{{ stats().theirReplies }}</span>
            <span class="stat-sublabel">Received</span>
          </div>
        </div>
        <div class="stat-label">Replies</div>
      </mat-card-content>
    </mat-card>

    <!-- Reposts Given/Received -->
    <mat-card class="stat-card">
      <mat-card-content>
        <mat-icon>repeat</mat-icon>
        <div class="stat-breakdown">
          <div class="stat-item">
            <span class="stat-value">{{ stats().ourReposts }}</span>
            <span class="stat-sublabel">Given</span>
          </div>
          <mat-divider [vertical]="true"></mat-divider>
          <div class="stat-item">
            <span class="stat-value">{{ stats().theirReposts }}</span>
            <span class="stat-sublabel">Received</span>
          </div>
        </div>
        <div class="stat-label">Reposts</div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Connection Notes Section -->
  <!-- <mat-card class="notes-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>notes</mat-icon>
        Connection Notes
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <p class="placeholder-text">Notes feature coming soon...</p>
    </mat-card-content>
  </mat-card> -->

  <!-- Basic Contact Info (merged from Contact tab) -->
  <mat-card class="contact-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>contact_page</mat-icon>
        Contact Information
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-list>
        <!-- About -->
        @if (getAbout()) {
        <mat-list-item>
          <mat-icon matListItemIcon>info</mat-icon>
          <div matListItemTitle>About</div>
          <div matListItemLine class="about-text">{{ getAbout() }}</div>
        </mat-list-item>
        <mat-divider></mat-divider>
        }

        <!-- Public Key -->
        <mat-list-item>
          <mat-icon matListItemIcon>fingerprint</mat-icon>
          <div matListItemTitle>Public Key</div>
          <div matListItemLine class="monospace-text">{{ getNpub() }}</div>
          <div matListItemMeta>
            <button mat-icon-button (click)="copyToClipboard(getNpub(), 'Public key')" matTooltip="Copy to clipboard">
              <mat-icon>content_copy</mat-icon>
            </button>
          </div>
        </mat-list-item>
        <mat-divider></mat-divider>

        <!-- NIP-05 -->
        @if (getNip05()) {
        <mat-list-item>
          <mat-icon matListItemIcon>verified</mat-icon>
          <div matListItemTitle>NIP-05 Identifier</div>
          <div matListItemLine>{{ getNip05() }}</div>
          <div matListItemMeta>
            <button mat-icon-button (click)="copyToClipboard(getNip05()!, 'NIP-05 identifier')"
              matTooltip="Copy to clipboard">
              <mat-icon>content_copy</mat-icon>
            </button>
          </div>
        </mat-list-item>
        <mat-divider></mat-divider>
        }

        <!-- Website -->
        @if (getWebsite()) {
        <mat-list-item>
          <mat-icon matListItemIcon>link</mat-icon>
          <div matListItemTitle>Website</div>
          <div matListItemLine><a [href]="getWebsite()!" target="_blank" rel="noopener noreferrer">{{ getWebsite()
              }}</a></div>
        </mat-list-item>
        <mat-divider></mat-divider>
        }

        <!-- Lightning Address -->
        @if (getLud16()) {
        <mat-list-item>
          <mat-icon matListItemIcon>bolt</mat-icon>
          <div matListItemTitle>Lightning Address</div>
          <div matListItemLine>{{ getLud16() }}</div>
          <div matListItemMeta>
            <button mat-icon-button (click)="copyToClipboard(getLud16()!, 'Lightning address')"
              matTooltip="Copy to clipboard">
              <mat-icon>content_copy</mat-icon>
            </button>
          </div>
        </mat-list-item>
        }
      </mat-list>
    </mat-card-content>
  </mat-card>

  <!-- External Identities (NIP-39) -->
  @if (externalIdentities().length > 0) {
  <mat-card class="contact-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>public</mat-icon>
        External Identities
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-list>
        @for (identity of externalIdentities(); track identity.platform + identity.identity; let last = $last) {
        <mat-list-item>
          <mat-icon matListItemIcon>{{ identity.icon }}</mat-icon>
          <div matListItemTitle class="identity-title">
            <span>{{ identity.platform }}</span>
            @if (identity.verified) {
            <mat-icon class="verified-badge" matTooltip="Verified">verified</mat-icon>
            }
          </div>
          <div matListItemLine>
            @if (identity.profileUrl) {
            <a [href]="identity.profileUrl" target="_blank" rel="noopener noreferrer" class="profile-link">
              {{ identity.displayName }}
            </a>
            } @else {
            <span class="profile-text">{{ identity.displayName }}</span>
            }
          </div>
          @if (identity.proofUrl) {
          <div matListItemMeta>
            <a mat-stroked-button [href]="identity.proofUrl" target="_blank" rel="noopener noreferrer"
              class="proof-button">
              <mat-icon>fact_check</mat-icon>
              View Proof
            </a>
          </div>
          }
        </mat-list-item>
        @if (!last) {
        <mat-divider></mat-divider>
        }
        }
      </mat-list>
    </mat-card-content>
  </mat-card>
  }
  }
</div>