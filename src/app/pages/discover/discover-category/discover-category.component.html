<div class="category-container">
  <!-- Header -->
  <header class="category-header" [style.background]="category()?.gradient">
    <div class="header-content">
      <button mat-icon-button class="back-button" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div class="header-icon">
        <mat-icon>{{ category()?.icon }}</mat-icon>
      </div>
      <div class="header-text">
        <h1>{{ category()?.title }}</h1>
        <p>{{ category()?.description }}</p>
      </div>
    </div>
  </header>

  <!-- Loading State -->
  @if (loading()) {
  <div class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading curated content...</p>
  </div>
  }

  <!-- Error State -->
  @if (error()) {
  <div class="error-container">
    <mat-icon>error_outline</mat-icon>
    <p>{{ error() }}</p>
    <button mat-flat-button (click)="goBack()">Go Back</button>
  </div>
  }

  <!-- Content -->
  @if (!loading() && !error()) {
  <div class="category-content">
    <!-- Creators Section -->
    @if (creators().length > 0) {
    <section class="content-section">
      <h2 class="section-title">
        <mat-icon>person</mat-icon>
        {{ specialSectionTitle() }}
      </h2>
      <div class="creators-grid">
        @for (creator of creators(); track creator.pubkey) {
        <app-user-profile [pubkey]="creator.pubkey" [view]="'grid'"></app-user-profile>
        }
      </div>
    </section>
    }

    <!-- Articles Section -->
    @if (articles().length > 0) {
    <section class="content-section">
      <h2 class="section-title">
        <mat-icon>article</mat-icon>
        @if (isNewsCategory()) {
        Latest News
        } @else {
        Curated Articles
        }
      </h2>
      <div class="articles-grid">
        @for (article of articles(); track article.id) {
        <app-article [pubkey]="article.pubkey" [kind]="article.kind" [slug]="article.slug"
          [relayHints]="article.relayHints" mode="card" [showAuthor]="true" [showMetadata]="true">
        </app-article>
        }
      </div>
    </section>
    }

    <!-- News Events Section (with full event objects) -->
    @if (newsEvents().length > 0) {
    <section class="content-section">
      <h2 class="section-title">
        <mat-icon>feed</mat-icon>
        Latest Posts
      </h2>
      <div class="events-grid">
        @for (event of newsEvents(); track event.id) {
        <app-event [event]="event" [compact]="true" [hideComments]="true" [hideFooter]="true" appearance="card">
        </app-event>
        }
      </div>
    </section>
    }

    <!-- Curated Events Section (for non-news categories) -->
    @if (events().length > 0) {
    <section class="content-section">
      <h2 class="section-title">
        <mat-icon>event</mat-icon>
        Curated Events
      </h2>
      <div class="events-grid">
        @for (event of events(); track event.id) {
        <app-event [id]="event.id" type="e" [compact]="true" [hideComments]="true" [hideFooter]="true"
          appearance="card">
        </app-event>
        }
      </div>
    </section>
    }

    <!-- Videos/Media Section -->
    @if (videos().length > 0) {
    <section class="content-section">
      <h2 class="section-title">
        <mat-icon>video_library</mat-icon>
        Curated Videos
      </h2>
      <div class="videos-grid">
        @for (video of videos(); track video.id) {
        <app-event [id]="video.id" type="e" [compact]="true" [hideComments]="true" [hideFooter]="true"
          appearance="card">
        </app-event>
        }
      </div>
    </section>
    }

    <!-- Pictures Section -->
    @if (pictures().length > 0) {
    <section class="content-section">
      <h2 class="section-title">
        <mat-icon>photo_library</mat-icon>
        Curated Pictures
      </h2>
      <div class="pictures-grid">
        @for (picture of pictures(); track picture.id) {
        <app-event [id]="picture.id" type="e" [compact]="true" [hideComments]="true" [hideFooter]="true"
          appearance="card">
        </app-event>
        }
      </div>
    </section>
    }

    <!-- Vine Videos Section (only for videos category) -->
    @if (isVideosCategory()) {
    <section class="content-section">
      <h2 class="section-title">
        <mat-icon>local_florist</mat-icon>
        Vine
      </h2>
      @if (vineLoading()) {
      <div class="streams-loading">
        <mat-spinner diameter="32"></mat-spinner>
        <span>Loading videos from Divine relay...</span>
      </div>
      } @else if (vineVideos().length > 0) {
      <div class="videos-grid">
        @for (video of vineVideos(); track video.id) {
        <app-event [event]="video" [compact]="true" [hideComments]="true" [hideFooter]="true" appearance="card">
        </app-event>
        }
      </div>
      } @else {
      <div class="no-content">
        <mat-icon>videocam_off</mat-icon>
        <p>No videos available at the moment</p>
      </div>
      }
    </section>
    }

    <!-- Shorts Section from Featured Creators (only for videos category) -->
    @if (isVideosCategory()) {
    <section class="content-section">
      <h2 class="section-title">
        <mat-icon>video_call</mat-icon>
        Shorts from Featured Creators
      </h2>
      @if (shortsLoading()) {
      <div class="streams-loading">
        <mat-spinner diameter="32"></mat-spinner>
        <span>Loading short videos...</span>
      </div>
      } @else if (publicShorts().length > 0) {
      <div class="videos-grid">
        @for (short of publicShorts(); track short.id) {
        <app-event [event]="short" [compact]="true" [hideComments]="true" [hideFooter]="true" appearance="card">
        </app-event>
        }
      </div>
      } @else {
      <div class="no-content">
        <mat-icon>videocam_off</mat-icon>
        <p>No short videos available at the moment</p>
      </div>
      }
    </section>
    }

    <!-- Videos Section from Featured Creators (only for videos category) -->
    @if (isVideosCategory()) {
    <section class="content-section">
      <h2 class="section-title">
        <mat-icon>movie</mat-icon>
        Videos from Featured Creators
      </h2>
      @if (videosLoading()) {
      <div class="streams-loading">
        <mat-spinner diameter="32"></mat-spinner>
        <span>Loading videos...</span>
      </div>
      } @else if (publicVideos().length > 0) {
      <div class="videos-grid">
        @for (video of publicVideos(); track video.id) {
        <app-event [event]="video" [compact]="true" [hideComments]="true" [hideFooter]="true" appearance="card">
        </app-event>
        }
      </div>
      } @else {
      <div class="no-content">
        <mat-icon>videocam_off</mat-icon>
        <p>No videos available at the moment</p>
      </div>
      }
    </section>
    }

    <!-- Playlists Section (only for music category) -->
    @if (playlists().length > 0) {
    <section class="content-section">
      <h2 class="section-title">
        <mat-icon>queue_music</mat-icon>
        Curated Playlists
      </h2>
      <div class="playlists-grid">
        @for (playlist of playlists(); track playlist.id) {
        <div class="playlist-card">
          <div class="playlist-info">
            <div class="playlist-title">{{ playlist.title }}</div>
            <div class="playlist-meta">
              {{ playlist.tracks.length }} tracks
              @if (playlist.totalDuration) {
              <span class="separator">â€¢</span>
              {{ playlist.totalDuration }}
              }
            </div>
            @if (playlist.tags && playlist.tags.length > 0) {
            <div class="playlist-tags">
              @for (tag of playlist.tags.slice(0, 3); track tag) {
              <span class="tag">#{{ tag }}</span>
              }
            </div>
            }
          </div>
          <div class="playlist-actions">
            <button mat-flat-button (click)="playPlaylist(playlist)">
              <mat-icon>play_arrow</mat-icon>
              Play
            </button>
            <button mat-stroked-button (click)="addPlaylistToQueue(playlist)">
              <mat-icon>playlist_add</mat-icon>
              Add to Queue
            </button>
          </div>
        </div>
        }
      </div>
    </section>
    }

    <!-- Live Streams Section (only for live category) -->
    @if (isLiveCategory()) {
    <section class="content-section live-streams-section">
      <div class="section-header-with-action">
        <h2 class="section-title">
          <mat-icon>stream</mat-icon>
          Currently Live
        </h2>
        <button mat-button (click)="viewAllStreams()">
          View All Streams
          <mat-icon>arrow_forward</mat-icon>
        </button>
      </div>
      @if (streamsLoading()) {
      <div class="streams-loading">
        <mat-spinner diameter="32"></mat-spinner>
        <span>Loading live streams...</span>
      </div>
      } @else if (liveStreams().length > 0) {
      <div class="live-streams-grid">
        @for (stream of liveStreams(); track stream.id) {
        <app-live-event [event]="stream"></app-live-event>
        }
      </div>
      } @else {
      <div class="no-streams">
        <mat-icon>videocam_off</mat-icon>
        <p>No live streams at the moment</p>
        <button mat-stroked-button (click)="viewAllStreams()">
          Browse All Streams
        </button>
      </div>
      }
    </section>
    }

    <!-- Empty State -->
    @if (creators().length === 0 && articles().length === 0 && events().length === 0 && videos().length === 0 &&
    pictures().length === 0) {
    <div class="empty-state">
      <mat-icon>explore_off</mat-icon>
      <h3>No curated content yet</h3>
      <p>We're working on curating amazing content for this category. Check back soon!</p>
      <button mat-flat-button (click)="goBack()">Browse Other Categories</button>
    </div>
    }
  </div>
  }
</div>