@let article = event();

@if (isLoading()) {
<!-- Loading State -->
<div class="article-loading">
  <mat-card>
    <mat-card-content>
      <div class="loading-content">
        <mat-progress-spinner diameter="40" mode="indeterminate"></mat-progress-spinner>
        <h2>Loading Article...</h2>
        <p>Please wait while we fetch the content.</p>
      </div>
    </mat-card-content>
  </mat-card>
</div>
} @else if (error()) {
<!-- Error State -->
<div class="article-error">
  <mat-card>
    <mat-card-content>
      <div class="error-content">
        <mat-icon>error_outline</mat-icon>
        <h2>Unable to Load Article</h2>
        <p>{{ error() }}</p>
        <button mat-raised-button color="primary" (click)="retryLoad()">
          <mat-icon>refresh</mat-icon>
          Try Again
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
} @else if (article) {
<div class="article-container">
  <!-- Header Section -->
  <header class="article-header">
    @if (image()) {
    <div class="article-hero-image">
      <img [src]="image()" [alt]="title()" loading="lazy" />
    </div>
    }

    <div class="article-header-content">
      <h1 class="article-title">{{ title() || 'Untitled Article' }}</h1>

      @if (summary()) {
      <p class="article-summary">{{ summary() }}</p>
      }
      <div class="article-meta">
        <div class="publish-date">
          <mat-icon>schedule</mat-icon>
          <app-date-toggle [date]="publishedAtTimestamp()"></app-date-toggle>
        </div>

        @if (hashtags().length > 0) {
        <div class="article-hashtags">
          <mat-chip-set>
            @for (hashtag of hashtags(); track hashtag) {
            <mat-chip highlighted>
              <!-- <mat-icon matChipAvatar>tag</mat-icon> -->
              {{ hashtag }}
            </mat-chip>
            }
          </mat-chip-set>
        </div>
        }

        <!-- Text-to-Speech Controls (Header) -->
        <div class="article-tts-controls">
          @if (!isSpeaking()) {
          <button mat-icon-button color="primary" (click)="startSpeech()" title="Read article aloud">
            <mat-icon>volume_up</mat-icon>
          </button>
          } @else {
          @if (isPaused()) {
          <button mat-icon-button color="primary" (click)="resumeSpeech()" title="Resume reading">
            <mat-icon>play_arrow</mat-icon>
          </button>
          } @else {
          <button mat-icon-button color="primary" (click)="pauseSpeech()" title="Pause reading">
            <mat-icon>pause</mat-icon>
          </button>
          }
          <button mat-icon-button color="primary" (click)="stopSpeech()" title="Stop reading">
            <mat-icon>stop</mat-icon>
          </button>
          }
        </div>
      </div>
    </div>
  </header>

  <!-- Author Section -->
  <section class="article-author">
    <app-user-profile [pubkey]="authorPubkey()" mode="list"></app-user-profile>
  </section>

  <main class="article-content">
    @if (isJsonContent()) {
    <div class="json-content">
      @if (jsonData(); as data) {
      @if (getObjectKeys(data).length > 0) {
      <div class="json-object">
        @for (key of getObjectKeys(data); track key) {
        <div class="json-property">
          <span class="json-key">{{ key }}</span>
          <span class="json-separator">:</span>
          @if (isPrimitive(getObjectValue(data, key))) {
          <span class="json-value">{{ formatJsonValue(getObjectValue(data, key)) }}</span>
          } @else {
          <pre class="json-complex-value">{{ stringifyValue(getObjectValue(data, key)) }}</pre>
          }
        </div>
        }
      </div>
      } @else {
      <pre class="json-raw">{{ stringifyValue(data) }}</pre>
      }
      }
    </div>
    } @else {
    <div class="markdown-content" [innerHTML]="parsedContent()" appMentionHover></div>
    }
  </main>

  <!-- Footer Actions -->
  <footer class="article-footer">
    <div class="article-actions">
      <!-- @for(bookmark of bookmark.bookmarkArticles(); track bookmark.id) {
      <div><span>{{ bookmark | json }}</span></div>
      } -->

      @if (accountState.isCurrentUser(authorPubkey())) {
      <button mat-button color="primary" routerLink="/article/edit/{{ link }}" title="Edit Article">
        <mat-icon>edit</mat-icon>
        Edit
      </button>
      }

      @if (bookmark.isBookmarked(id(), 'a')) {
      <button mat-button color="primary" title="Remove bookmark" (click)="bookmarkArticle()">
        <mat-icon title="Remove bookmark">bookmark_remove</mat-icon>
        Bookmark
      </button>
      } @else {
      <button mat-button color="primary" title="Add bookmark" (click)="bookmarkArticle()">
        <mat-icon title="Add bookmark">bookmark_add</mat-icon>
        Bookmark
      </button>
      }

      <button mat-button color="primary" (click)="shareArticle()">
        <mat-icon>share</mat-icon>
        Share
      </button>

      <app-repost-button [event]="article" [view]="'full'"></app-repost-button>

      <!-- Text-to-Speech Controls -->
      @if (!isSpeaking()) {
      <button mat-button color="primary" (click)="startSpeech()" title="Read article aloud">
        <mat-icon>volume_up</mat-icon>
        Read Aloud
      </button>
      } @else {
      @if (isPaused()) {
      <button mat-button color="primary" (click)="resumeSpeech()" title="Resume reading">
        <mat-icon>play_arrow</mat-icon>
        Resume
      </button>
      } @else {
      <button mat-button color="primary" (click)="pauseSpeech()" title="Pause reading">
        <mat-icon>pause</mat-icon>
        Pause
      </button>
      }
      <button mat-button color="primary" (click)="stopSpeech()" title="Stop reading">
        <mat-icon>stop</mat-icon>
        Stop
      </button>
      }

      <app-event-menu [event]="article" [view]="'full'"></app-event-menu>
    </div>
  </footer>

  <!-- Comments Section -->
  <section class="article-comments">
    <app-comments-list [event]="article"></app-comments-list>
  </section>
</div>
} @else {
<!-- Loading or Empty State -->
<div class="article-empty-state">
  <mat-card>
    <mat-card-content>
      <div class="empty-state-content">
        <mat-icon>article</mat-icon>
        <h2>No Article Selected</h2>
        <p>Please select an article to view its content.</p>
      </div>
    </mat-card-content>
  </mat-card>
</div>
}