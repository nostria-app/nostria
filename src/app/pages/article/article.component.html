<!-- Panel Header - Fixed at top -->
<div class="panel-header">
  <button mat-icon-button class="back-button" (click)="goBack()" matTooltip="Go back">
    <mat-icon>arrow_back</mat-icon>
  </button>
  <h2 class="panel-title title-font">{{ title() || 'Article' }}</h2>
  <span class="panel-header-spacer"></span>

  @if (event()) {
  @if (accountState.isCurrentUser(authorPubkey())) {
  <button mat-icon-button (click)="layout.createArticle(link)" matTooltip="Edit Article">
    <mat-icon>edit</mat-icon>
  </button>
  }
  <button mat-icon-button (click)="bookmarkArticle()"
    [matTooltip]="bookmark.isBookmarkedInAnyList(id(), 'a') ? 'Manage bookmarks' : 'Add to bookmark list'">
    <mat-icon>{{ bookmark.getBookmarkIcon(id(), 'a') }}</mat-icon>
  </button>
  <button mat-icon-button (click)="shareArticle()" matTooltip="Share Article">
    <mat-icon>share</mat-icon>
  </button>
  <app-zap-button [event]="event()!"></app-zap-button>
  <app-event-menu [event]="event()!" [view]="'icon'"></app-event-menu>
  }
</div>

@let article = event();

@if (isLoading()) {
<!-- Loading State -->
<div class="article-loading">
  <mat-card>
    <mat-card-content>
      <div class="loading-content">
        <mat-progress-spinner diameter="40" mode="indeterminate"></mat-progress-spinner>
        <h2>Loading Article...</h2>
        <p>Please wait while we fetch the content.</p>
      </div>
    </mat-card-content>
  </mat-card>
</div>
} @else if (error()) {
<!-- Error State -->
<div class="article-error">
  <mat-card>
    <mat-card-content>
      <div class="error-content">
        <mat-icon>error_outline</mat-icon>
        <h2>Unable to Load Article</h2>
        <p>{{ error() }}</p>
        <button mat-raised-button color="primary" (click)="retryLoad()">
          <mat-icon>refresh</mat-icon>
          Try Again
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
} @else if (article) {
<div class="article-container">
  <!-- Use ArticleDisplayComponent for rendering -->
  <app-article-display [article]="articleData()" mode="full" [showTopActions]="false" [isSpeaking]="isSpeaking()"
    [isPaused]="isPaused()" [useAiVoice]="useAiVoice()" [isSynthesizing]="isSynthesizing()"
    [isTranslating]="isTranslating()" [availableVoices]="availableVoices()" [selectedVoice]="selectedVoice()"
    [playbackRate]="playbackRate()" (startSpeech)="startSpeech()" (pauseSpeech)="pauseSpeech()"
    (resumeSpeech)="resumeSpeech()" (stopSpeech)="stopSpeech()" (toggleAiVoice)="useAiVoice.set($event)"
    (voiceChange)="onVoiceChange($event)" (playbackRateChange)="onPlaybackRateChange($event)" (share)="shareArticle()"
    (translate)="onTranslate($event)" [reactions]="reactions()" [repostsInput]="reposts()" [quotesInput]="quotes()"
    [zapsInput]="zaps()" [replyCountInput]="replyCount()" (reactionChanged)="loadReactions(true)"
    (zapSent)="onZapSent($event)" (replyClick)="openReplyEditor($event)"
    (bookmarkClick)="onBookmarkClick($event)"></app-article-display>
</div>
} @else {
<!-- Loading or Empty State -->
<div class="article-empty-state">
  <mat-card>
    <mat-card-content>
      <div class="empty-state-content">
        <mat-icon>article</mat-icon>
        <h2>No Article Selected</h2>
        <p>Please select an article to view its content.</p>
      </div>
    </mat-card-content>
  </mat-card>
</div>
}