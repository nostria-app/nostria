<div class="editor-dialog">
  <h2 mat-dialog-title>
    <mat-icon>{{ listType.icon }}</mat-icon>
    {{ mode === 'create' ? 'Create' : 'Edit' }} {{ listType.name }}
  </h2>

  <mat-dialog-content>
    <!-- Metadata Section -->
    <div class="metadata-section">
      <h3>List Details</h3>

      @if (!listType.isReplaceable) {
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Identifier (required)</mat-label>
        <input matInput [(ngModel)]="identifier" placeholder="unique-identifier" required
          [disabled]="identifierDisabled()" />
        <mat-hint>
          @if (mode === 'edit') {
          Identifier cannot be changed (would create a duplicate set)
          } @else {
          Unique identifier for this set (cannot be changed after creation)
          }
        </mat-hint>
      </mat-form-field>
      }

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Title</mat-label>
        <input matInput [(ngModel)]="title" placeholder="My awesome list" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description</mat-label>
        <textarea matInput [(ngModel)]="description" rows="3" placeholder="What is this list about?"></textarea>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Image URL (optional)</mat-label>
        <input matInput [(ngModel)]="image" type="url" placeholder="https://..." />
      </mat-form-field>
    </div>

    <mat-divider></mat-divider>

    <!-- Add/Edit Items Section -->
    <div class="add-item-section">
      <h3>{{ isEditingItem() ? 'Edit Item' : 'Add Items' }}</h3>

      <div class="add-item-form">
        <mat-form-field appearance="outline" class="tag-field">
          <mat-label>Tag Type</mat-label>
          <mat-select [(ngModel)]="newItemTag">
            @for (tag of listType.expectedTags; track tag) {
            <mat-option [value]="tag">
              <mat-icon>{{ getTagIcon(tag) }}</mat-icon>
              {{ tag }}
            </mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="value-field">
          <mat-label>Value</mat-label>
          <input matInput [(ngModel)]="newItemValue" placeholder="Enter value" title="Enter value"
            (keyup.enter)="addItem()" />
          <mat-hint>
            @if (newItemTag() === 'p' && isStarterPackList()) {
            Public key (npub)
            } @else if (newItemTag() === 'p') {
            Public key (hex)
            } @else if (newItemTag() === 'e') {
            Event ID (hex)
            } @else if (newItemTag() === 'a') {
            Event coordinates (kind:pubkey:identifier)
            } @else if (newItemTag() === 't') {
            Hashtag (without #)
            } @else if (newItemTag() === 'r') {
            URL
            } @else if (newItemTag() === 'relay') {
            Relay URL (wss://...)
            } @else if (newItemTag() === 'word') {
            Word or phrase to mute
            } @else if (newItemTag() === 'emoji') {
            Emoji shortcode and URL
            } @else if (newItemTag() === 'group') {
            Group ID + relay URL
            } @else {
            Value for {{ newItemTag() }} tag
            }
          </mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline" class="relay-field">
          <mat-label>Relay (optional)</mat-label>
          <input matInput [(ngModel)]="newItemRelay" type="url" placeholder="wss://..." (keyup.enter)="addItem()" />
        </mat-form-field>

        @if (showPubkeyField()) {
        <mat-form-field appearance="outline" class="pubkey-field">
          <mat-label>Author Pubkey (optional)</mat-label>
          <input matInput [(ngModel)]="newItemPubkey" placeholder="hex pubkey" (keyup.enter)="addItem()" />
          <mat-hint>32-byte hex pubkey of the event author</mat-hint>
        </mat-form-field>
        }

        @if (!isEditingItem()) {
        <mat-slide-toggle [(ngModel)]="newItemIsPrivate" color="primary">
          Private
        </mat-slide-toggle>
        }

        <div class="action-buttons">
          @if (isEditingItem()) {
          <button mat-button (click)="cancelEdit()">
            Cancel
          </button>
          <button mat-flat-button (click)="addItem()" [disabled]="!newItemTag() || !newItemValue()">
            <mat-icon>check</mat-icon>
            Update
          </button>
          } @else {
          <button mat-flat-button (click)="addItem()" [disabled]="!newItemTag() || !newItemValue()">
            <mat-icon>add</mat-icon>
            Add
          </button>
          }
        </div>
      </div>

      <p class="item-count">Total items: {{ totalItems() }}</p>
    </div>

    <mat-divider></mat-divider>

    <!-- Items Lists -->
    <mat-tab-group>
      <!-- Public Items -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>public</mat-icon>
          Public Items ({{ publicItems().length }})
        </ng-template>

        <div class="items-list">
          @if (publicItems().length > 0) {
          <p class="drag-hint">
            <mat-icon>drag_indicator</mat-icon>
            Drag items to reorder
          </p>
          <div cdkDropList (cdkDropListDropped)="dropPublicItem($event)" class="items-drop-list">
            @for (item of publicItems(); track $index) {
            <div cdkDrag class="item-row" [class.editing]="editingIndex() === $index && !editingIsPrivate()">
              <mat-icon cdkDragHandle class="drag-handle">drag_indicator</mat-icon>
              <mat-icon class="item-icon">{{ getTagIcon(item.tag) }}</mat-icon>
              <div class="item-content">
                <span class="item-tag">[{{ item.tag }}]</span>
                <span class="item-value" [matTooltip]="getItemValueDisplay(item)">{{
                  getShortValue(getItemValueDisplay(item)) }}</span>
                @if (item.relay) {
                <span class="item-relay">@ {{ getShortValue(item.relay, 24) }}</span>
                }
                @if (item.tag === 'e' && item.pubkey) {
                <span class="item-pubkey">(by {{ item.pubkey.slice(0, 8) }}...)</span>
                }
              </div>
              <div class="item-actions">
                <button mat-icon-button matTooltip="Edit" (click)="editItem($index, false)">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button matTooltip="Move to private" (click)="moveToPrivate($index)">
                  <mat-icon>lock</mat-icon>
                </button>
                <button mat-icon-button matTooltip="Remove" (click)="removePublicItem($index)">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>
            }
          </div>
          } @else {
          <p class="no-items">No public items yet. Add items above.</p>
          }
        </div>
      </mat-tab>

      <!-- Private Items -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>lock</mat-icon>
          Private Items ({{ privateItems().length }})
        </ng-template>

        <div class="items-list">
          <div class="privacy-notice">
            <mat-icon>info</mat-icon>
            <p>
              Private items are encrypted using NIP-44 and only you can read them. They are useful
              for mute lists or personal bookmarks.
            </p>
          </div>

          @if (privateItems().length > 0) {
          <p class="drag-hint">
            <mat-icon>drag_indicator</mat-icon>
            Drag items to reorder
          </p>
          <div cdkDropList (cdkDropListDropped)="dropPrivateItem($event)" class="items-drop-list">
            @for (item of privateItems(); track $index) {
            <div cdkDrag class="item-row private" [class.editing]="editingIndex() === $index && editingIsPrivate()">
              <mat-icon cdkDragHandle class="drag-handle">drag_indicator</mat-icon>
              <mat-icon class="item-icon">{{ getTagIcon(item.tag) }}</mat-icon>
              <div class="item-content">
                <span class="item-tag">[{{ item.tag }}]</span>
                <span class="item-value" [matTooltip]="getItemValueDisplay(item)">{{
                  getShortValue(getItemValueDisplay(item)) }}</span>
                @if (item.relay) {
                <span class="item-relay">@ {{ getShortValue(item.relay, 24) }}</span>
                }
                @if (item.tag === 'e' && item.pubkey) {
                <span class="item-pubkey">(by {{ item.pubkey.slice(0, 8) }}...)</span>
                }
              </div>
              <div class="item-actions">
                <button mat-icon-button matTooltip="Edit" (click)="editItem($index, true)">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button matTooltip="Move to public" (click)="moveToPublic($index)">
                  <mat-icon>public</mat-icon>
                </button>
                <button mat-icon-button matTooltip="Remove" (click)="removePrivateItem($index)">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>
            }
          </div>
          } @else {
          <p class="no-items">No private items yet. Toggle "Private" when adding items.</p>
          }
        </div>
      </mat-tab>
    </mat-tab-group>
  </mat-dialog-content>

  <mat-dialog-actions>
    <div class="actions-left">
      <button mat-button (click)="triggerImport()" matTooltip="Import list from JSON file">
        <mat-icon>upload</mat-icon>
        Import
      </button>
      <button mat-button (click)="downloadList()" [disabled]="totalItems() === 0"
        matTooltip="Download list as JSON file">
        <mat-icon>download</mat-icon>
        Download
      </button>
    </div>

    <div class="actions-right">
      <button mat-button (click)="cancel()">Cancel</button>
      <button mat-flat-button (click)="save()" [disabled]="!isValid()">
        <mat-icon>save</mat-icon>
        {{ mode === 'create' ? 'Create List' : 'Save Changes' }}
      </button>
    </div>
  </mat-dialog-actions>
</div>