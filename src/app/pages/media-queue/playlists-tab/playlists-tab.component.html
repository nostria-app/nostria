<div class="playlists-tab-container">
  <header class="playlists-header">
    <div class="header-actions">
      <button mat-flat-button (click)="createNewPlaylist()">
        <mat-icon>add</mat-icon>
        New Playlist
      </button>
    </div>
  </header>

  <main class="playlists-content">
    <!-- Loading indicator (only show if no playlists and still loading) -->
    @if (isLoading() && playlists().length === 0 && drafts().length === 0) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading playlists...</p>
    </div>
    } @else {
    <!-- Drafts Section -->
    @if (drafts().length > 0) {
    <section class="drafts-section">
      <div class="section-header">
        <h3>Drafts</h3>
        @if (isLoading()) {
        <mat-spinner diameter="16"></mat-spinner>
        }
      </div>
      <div class="playlist-list">
        @for (draft of drafts(); track draft.id) {
        <div class="playlist-item draft-item" tabindex="0" (click)="loadDraft(draft.id!)"
          (keydown.enter)="loadDraft(draft.id!)" (keydown.space)="loadDraft(draft.id!)">
          <mat-icon class="playlist-icon">draft</mat-icon>

          <div class="playlist-info">
            <div class="playlist-title">{{ draft.title }}</div>
            <div class="playlist-meta">
              {{ draft.tracks.length }} tracks · Draft
            </div>
          </div>

          <div class="playlist-actions">
            <button mat-icon-button (click)="loadDraft(draft.id!); $event.stopPropagation()" matTooltip="Edit">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button [matMenuTriggerFor]="draftMenu" (click)="$event.stopPropagation()">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #draftMenu="matMenu">
              <button mat-menu-item (click)="loadDraft(draft.id!)">
                <mat-icon>edit</mat-icon>
                Continue Editing
              </button>
              <button mat-menu-item (click)="deleteDraft(draft.id!)">
                <mat-icon>delete</mat-icon>
                Delete Draft
              </button>
            </mat-menu>
          </div>
        </div>
        }
      </div>
    </section>
    }

    <!-- Playlists Section -->
    <section class="playlists-section">
      <div class="section-header">
        <h3>Playlists</h3>
        @if (isLoading() && playlists().length > 0) {
        <mat-spinner diameter="16"></mat-spinner>
        }
      </div>
      @if (playlists().length === 0 && !isLoading()) {
      <div class="empty-state">
        <mat-icon class="empty-icon">queue_music</mat-icon>
        <h4>No playlists yet</h4>
        <p>Create your first playlist to get started</p>
        <button mat-flat-button (click)="createNewPlaylist()">
          <mat-icon>add</mat-icon>
          Create Playlist
        </button>
      </div>
      } @else if (playlists().length > 0) {
      <div class="playlist-list">
        @for (playlist of playlists(); track playlist.id) {
        <div class="playlist-item" tabindex="0" (click)="playPlaylist(playlist)"
          (keydown.enter)="playPlaylist(playlist)" (keydown.space)="playPlaylist(playlist)">
          <button mat-icon-button class="play-button" (click)="playPlaylist(playlist); $event.stopPropagation()"
            matTooltip="Play playlist">
            <mat-icon>play_arrow</mat-icon>
          </button>

          <div class="playlist-info">
            <div class="playlist-title">{{ playlist.title }}</div>
            <div class="playlist-meta">
              {{ playlist.tracks.length }} tracks
              @if (playlist.totalDuration) {
              · {{ playlist.totalDuration }}
              }
              <span class="playlist-status" [class.is-local]="playlist.isLocal || !playlist.eventId">
                ·
                <mat-icon class="status-icon">{{ (playlist.isLocal || !playlist.eventId) ? 'cloud_off' : 'public'
                  }}</mat-icon>
                {{ (playlist.isLocal || !playlist.eventId) ? 'Local' : 'Public' }}
              </span>
            </div>
          </div>

          <div class="playlist-actions">
            <button mat-icon-button (click)="addPlaylistToQueue(playlist); $event.stopPropagation()"
              matTooltip="Add to queue">
              <mat-icon>playlist_add</mat-icon>
            </button>
            <button mat-icon-button [matMenuTriggerFor]="playlistMenu" (click)="$event.stopPropagation()">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #playlistMenu="matMenu">
              <button mat-menu-item (click)="playPlaylist(playlist)">
                <mat-icon>play_arrow</mat-icon>
                Play
              </button>
              <button mat-menu-item (click)="addPlaylistToQueue(playlist)">
                <mat-icon>playlist_add</mat-icon>
                Add to Queue
              </button>
              <button mat-menu-item [matMenuTriggerFor]="copyMenu">
                <mat-icon>content_copy</mat-icon>
                Copy
              </button>
              <button mat-menu-item (click)="renamePlaylist(playlist)">
                <mat-icon>drive_file_rename_outline</mat-icon>
                Rename
              </button>
              <button mat-menu-item (click)="editPlaylist(playlist)">
                <mat-icon>edit</mat-icon>
                Edit
              </button>
              <button mat-menu-item (click)="deletePlaylist(playlist)">
                <mat-icon>delete</mat-icon>
                Delete
              </button>
            </mat-menu>

            <!-- Copy submenu -->
            <mat-menu #copyMenu="matMenu">
              <button mat-menu-item (click)="copyNeventAddress(playlist)">
                <mat-icon>link</mat-icon>
                Copy Nevent Address
              </button>
              <button mat-menu-item (click)="copyEventData(playlist)">
                <mat-icon>code</mat-icon>
                Copy Event Data
              </button>
            </mat-menu>
          </div>
        </div>
        }
      </div>
      }
    </section>
    }
  </main>
</div>