<div class="notifications-page">
  <div class="page-header">
    <h1>Notifications</h1>
    <div class="header-actions">
      <button mat-icon-button [matMenuTriggerFor]="optionsMenu" aria-label="Options">
        <mat-icon>more_vert</mat-icon>
      </button>
      <mat-menu #optionsMenu="matMenu">
        <button mat-menu-item (click)="markAllAsRead()">
          <mat-icon>done_all</mat-icon>
          <span>Mark all as read</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item>
          <mat-icon>settings</mat-icon>
          <span>Notification settings</span>
        </button>
      </mat-menu>
    </div>
  </div>

  <!-- @if (isLoading()) {
    <div class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Loading notifications...</p>
    </div>
  } @else if (error()) {
    <div class="error-container">
      <mat-icon color="warn">error</mat-icon>
      <p>{{ error() }}</p>
      <button mat-flat-button color="primary" (click)="fetchNotifications()">
        <mat-icon>refresh</mat-icon> Try Again
      </button>
    </div>
  } @else if (notifications().length === 0) {
    <div class="empty-container">
      <mat-icon>notifications_off</mat-icon>
      <p>No notifications yet</p>
      <p class="empty-subtitle">When someone mentions, reacts, or follows you, you'll see it here.</p>
    </div>
  } @else { -->
    <div class="notifications-container">
      <div class="header">
        <h2>Notifications</h2>
        <button mat-button color="warn" (click)="clearNotifications()" [disabled]="!notifications().length">
          <mat-icon>delete_sweep</mat-icon>
          Clear All
        </button>
      </div>

      <div class="notifications-list">
        @if (notifications().length === 0) {
          <mat-card class="empty-state">
            <mat-card-content>
              <div class="empty-icon">
                <mat-icon>notifications_off</mat-icon>
              </div>
              <p>No notifications at this time</p>
            </mat-card-content>
          </mat-card>
        } @else {
          @for (notification of notifications(); track notification.id) {
            @if (isRelayPublishingNotification(notification)) {
              <app-relay-publish-status 
                [notification]="notification"
                (retry)="onRetryPublish($event)">
              </app-relay-publish-status>
            } @else {
              <mat-card class="notification-card" [ngClass]="{'read': notification.read}">
                <mat-card-header>
                  <div mat-card-avatar class="notification-icon">
                    @switch (notification.type) {
                      @case (notificationType.SUCCESS) {
                        <mat-icon color="primary">check_circle</mat-icon>
                      }
                      @case (notificationType.ERROR) {
                        <mat-icon color="warn">error</mat-icon>
                      }
                      @case (notificationType.WARNING) {
                        <mat-icon color="accent">warning</mat-icon>
                      }
                      @default {
                        <mat-icon>notifications</mat-icon>
                      }
                    }
                  </div>
                  <mat-card-title>{{ notification.title }}</mat-card-title>
                  <mat-card-subtitle>{{ notification.timestamp | date:'medium' }}</mat-card-subtitle>
                  
                  <button mat-icon-button class="dismiss-button" (click)="removeNotification(notification.id)">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-card-header>
                
                <mat-card-content *ngIf="notification.message">
                  <p>{{ notification.message }}</p>
                </mat-card-content>
                
                <mat-card-actions *ngIf="notification.type" align="end">
                  <button mat-button color="primary">
                    {{ notification.title }}
                  </button>
                  <button mat-button (click)="markAsRead(notification.id)" *ngIf="!notification.read">
                    Mark as read
                  </button>
                </mat-card-actions>
              </mat-card>
            }
          }
        }
      </div>
    </div>
  <!-- } -->
</div>
