<div class="drafts-container">
  <div class="drafts-header">
    <div class="header-content">
      <h1>
        <mat-icon>edit_document</mat-icon>
        My Drafts
      </h1>
      <div class="header-actions">
        <button mat-flat-button (click)="createNewDraft()">
          <mat-icon>article</mat-icon>
          Editor
        </button>
        <button mat-icon-button (click)="refreshDrafts()" matTooltip="Refresh drafts">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
    </div>

    @if (availableTags().length > 0) {
    <div class="tag-filters">
      <span class="filter-label">Filter by tags:</span>
      <mat-chip-listbox multiple (change)="onTagSelectionChange($any($event.value))">
        @for (tag of availableTags(); track $index) {
        <mat-chip-option [value]="tag" [selected]="selectedTags().includes(tag)" class="tag-chip">{{ tag
          }}</mat-chip-option>
        }
      </mat-chip-listbox>
    </div>
    }
  </div>

  @if (isLoading()) {
  <div class="loading-container">
    <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
    <p>Loading drafts...</p>
  </div>
  } @else if (error()) {
  <div class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error() }}</p>
    <button mat-raised-button (click)="refreshDrafts()">Try Again</button>
  </div>
  } @else if (filteredDrafts().length === 0) {
  <div class="empty-state">
    @if (selectedTags().length > 0) {
    <mat-icon>filter_list_off</mat-icon>
    <h2>No drafts found with selected tags</h2>
    <p>Try clearing the filter or selecting different tags.</p>
    <button mat-raised-button (click)="clearTagFilter()">Clear Filter</button>
    } @else {
    <mat-icon>draft</mat-icon>
    <h2>No drafts yet</h2>
    <p>Start writing your first article draft!</p>
    <button mat-raised-button color="primary" (click)="createNewDraft()">
      <mat-icon>add</mat-icon>
      Create Your First Draft
    </button>
    }
  </div>
  } @else {
  <div class="drafts-list">
    @for (draft of filteredDrafts(); track draft.id) {
    <mat-card class="draft-card" (click)="openDraft(draft)">
      <div class="draft-card-content">
        @if (draft.imageUrl) {
        <div class="draft-image">
          <img [src]="draft.imageUrl" alt="{{ draft.title }}" title="{{ draft.title }}" />
        </div>
        }

        <div class="draft-details">
          <div class="draft-header">
            <div class="draft-title-section">
              <h3 class="draft-title">{{ draft.title }}</h3>
              <p class="draft-meta">
                Last modified {{ draft.lastModified | ago }} â€¢ Created {{ draft.createdAt | ago }}
              </p>
            </div>
            <button mat-icon-button (click)="deleteDraft(draft, $event)" matTooltip="Delete draft"
              class="delete-button">
              <mat-icon>delete</mat-icon>
            </button>
          </div>

          <p class="draft-summary">{{ draft.summary }}</p>

          @if (draft.tags.length > 0) {
          <div class="draft-tags">
            <mat-chip-set>
              @for (tag of draft.tags; track $index) {
              <mat-chip class="tag-chip">{{ tag }}</mat-chip>
              }
            </mat-chip-set>
          </div>
          }

          <div class="draft-actions">
            <button mat-button (click)="openDraft(draft)">
              <mat-icon>edit</mat-icon>
              Continue Writing
            </button>
          </div>
        </div>
      </div>
    </mat-card>
    }
  </div>
  }
</div>