@if (!app.authenticated()) {
<div class="unauthenticated-state">
  <mat-icon>account_circle</mat-icon>
  <h2>Sign in to see your Summary</h2>
  <p>Get a quick overview of what's happening in your network.</p>
</div>
} @else {
<div class="summary-container">
  <!-- Header -->
  <div class="summary-header">
    <div class="header-content">
      <h1>
        <mat-icon>dashboard</mat-icon>
        Summary
      </h1>
      <p class="last-visit">Since {{ timeSinceLastCheck() }}</p>
    </div>
    <button mat-icon-button (click)="refresh()" matTooltip="Refresh" [disabled]="isLoading()">
      <mat-icon>refresh</mat-icon>
    </button>
  </div>

  <!-- Time Range Selector -->
  <div class="time-range-selector">
    <div class="time-presets">
      <button mat-stroked-button [class.active]="selectedPreset() === null && customDate() === null"
        (click)="resetToLastVisit()">
        Last visit
      </button>
      @for (preset of timePresets; track preset.hours) {
      <button mat-stroked-button [class.active]="selectedPreset() === preset.hours"
        (click)="selectPreset(preset.hours)">
        {{ preset.label }}
      </button>
      }
    </div>
    <div class="custom-date-picker">
      <mat-form-field appearance="outline" subscriptSizing="dynamic">
        <mat-label>Custom date</mat-label>
        <input matInput [matDatepicker]="picker" placeholder="Select date" [ngModel]="customDate()"
          (dateChange)="onCustomDateChange($event.value)" [max]="today">
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
    </div>
  </div>

  @if (isLoading()) {
  <div class="loading-state">
    <mat-spinner diameter="48"></mat-spinner>
    <p>Loading your summary...</p>
  </div>
  } @else {
  <div class="summary-content">
    <!-- Activity Stats Cards -->
    <section class="stats-section">
      <h2 class="section-title">
        <mat-icon>analytics</mat-icon>
        Activity Overview
      </h2>
      <div class="stats-grid">
        <div class="stat-card notes">
          <mat-icon>chat</mat-icon>
          <div class="stat-value">{{ formatNumber(activitySummary().notesCount) }}</div>
          <div class="stat-label">New Notes</div>
        </div>
        <div class="stat-card articles">
          <mat-icon>article</mat-icon>
          <div class="stat-value">{{ formatNumber(activitySummary().articlesCount) }}</div>
          <div class="stat-label">New Articles</div>
        </div>
        <div class="stat-card media">
          <mat-icon>perm_media</mat-icon>
          <div class="stat-value">{{ formatNumber(activitySummary().mediaCount) }}</div>
          <div class="stat-label">New Media</div>
        </div>
        <div class="stat-card profiles">
          <mat-icon>person</mat-icon>
          <div class="stat-value">{{ activitySummary().profileUpdatesCount }}</div>
          <div class="stat-label">Profile Updates</div>
        </div>
      </div>
    </section>

    <!-- Active Posters Section -->
    @if (activePosters().length > 0) {
    <mat-divider></mat-divider>

    <section class="active-posters-section">
      <h2 class="section-title">
        <mat-icon>group</mat-icon>
        Who Posted
      </h2>
      <p class="section-description">People who were active during this period</p>
      <div class="poster-list">
        @for (poster of activePosters(); track poster.pubkey) {
        <div class="poster-item">
          <app-user-profile [pubkey]="poster.pubkey" view="small"></app-user-profile>
          <div class="poster-stats">
            @if (poster.notesCount > 0) {
            <mat-chip>
              <mat-icon>chat</mat-icon>
              {{ poster.notesCount }}
            </mat-chip>
            }
            @if (poster.articlesCount > 0) {
            <mat-chip>
              <mat-icon>article</mat-icon>
              {{ poster.articlesCount }}
            </mat-chip>
            }
            @if (poster.mediaCount > 0) {
            <mat-chip>
              <mat-icon>perm_media</mat-icon>
              {{ poster.mediaCount }}
            </mat-chip>
            }
          </div>
        </div>
        }
      </div>
    </section>
    }

    <!-- Profile Updates Section -->
    @if (profileUpdates().length > 0) {
    <mat-divider></mat-divider>

    <section class="profile-updates-section">
      <h2 class="section-title">
        <mat-icon>badge</mat-icon>
        Profile Updates
      </h2>
      <p class="section-description">People who updated their profiles</p>
      <div class="user-grid">
        @for (pubkey of profileUpdates(); track pubkey) {
        <div class="user-card">
          <app-user-profile [pubkey]="pubkey" view="small"></app-user-profile>
        </div>
        }
      </div>
    </section>
    }

    <!-- Empty States -->
    @if (!hasFollowing()) {
    <section class="empty-state">
      <mat-icon>group_add</mat-icon>
      <h3>Start Following People</h3>
      <p>Follow people to see activity summaries here.</p>
      <a mat-flat-button routerLink="/people/discover">
        <mat-icon>explore</mat-icon>
        Discover People
      </a>
    </section>
    } @else if (!hasActivity()) {
    <section class="no-activity-state">
      <mat-icon>inbox</mat-icon>
      <h3>No New Activity</h3>
      <p>There's no new activity from the people you follow during this time period.</p>
    </section>
    }
  </div>
  }
</div>
}