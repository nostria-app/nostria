<div class="streams-container">
  <!-- Panel Header -->
  <div class="panel-header">
    <h2 class="panel-title title-font">{{ filterTitle() }}</h2>
    <span class="panel-header-spacer"></span>

    <!-- People List Selector -->
    @if (isAuthenticated()) {
    <button mat-icon-button [matMenuTriggerFor]="listFilterMenu"
      [matTooltip]="'Filter by: ' + filterTitle()">
      <mat-icon>{{ selectedFollowSet()?.isPrivate ? 'lock' : (selectedListFilter() === 'all' ? 'filter_list' : 'people') }}</mat-icon>
    </button>

    <mat-menu #listFilterMenu="matMenu">
      <button mat-menu-item (click)="selectListFilter('all')"
        [class.selected]="selectedListFilter() === 'all'">
        <mat-icon>public</mat-icon>
        <span>All Streams</span>
      </button>
      <button mat-menu-item (click)="selectListFilter('following')"
        [class.selected]="selectedListFilter() === 'following'">
        <mat-icon>people</mat-icon>
        <span>Following</span>
      </button>
      @if (allFollowSets().length > 0) {
      <mat-divider></mat-divider>
      @for (set of allFollowSets(); track set.id) {
      <button mat-menu-item (click)="selectListFilter(set)"
        [class.selected]="selectedListFilter() === set.dTag">
        <mat-icon>{{ set.isPrivate ? 'lock' : (set.dTag === 'nostria-favorites' ? 'star' : 'group') }}</mat-icon>
        <span>{{ set.title }}</span>
        <span class="set-count"> ({{ set.pubkeys.length }})</span>
      </button>
      }
      }
    </mat-menu>
    }

    <button mat-icon-button (click)="refresh()" [disabled]="loading()" matTooltip="Refresh streams">
      <mat-icon>refresh</mat-icon>
    </button>
    <button mat-icon-button [matMenuTriggerFor]="headerActionsMenu" matTooltip="More options">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #headerActionsMenu="matMenu">
      <button mat-menu-item (click)="openStreamingAppsDialog()">
        <mat-icon>videocam</mat-icon>
        <span i18n="@@streams.wantToStream">Want to stream?</span>
      </button>
      @if (isAuthenticated()) {
      <button mat-menu-item (click)="openSettings()">
        <mat-icon>settings</mat-icon>
        <span i18n="@@streams.settings.label">Settings</span>
      </button>
      }
    </mat-menu>
  </div>

  <mat-tab-group (selectedIndexChange)="onTabChange($event)" [selectedIndex]="selectedTabIndex()">
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon">radio_button_checked</mat-icon>
        <span i18n="@@streams.tabs.live">Live Now</span>
        @if (liveStreams().length > 0) {
        <span class="tab-count">{{ liveStreams().length }}</span>
        }
      </ng-template>
    </mat-tab>

    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon">schedule</mat-icon>
        <span i18n="@@streams.tabs.scheduled">Scheduled</span>
        @if (plannedStreams().length > 0) {
        <span class="tab-count">{{ plannedStreams().length }}</span>
        }
      </ng-template>
    </mat-tab>

    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon">stop_circle</mat-icon>
        <span i18n="@@streams.tabs.ended">Ended</span>
        @if (endedStreams().length > 0) {
        <span class="tab-count">{{ endedStreams().length }}</span>
        }
      </ng-template>
    </mat-tab>
  </mat-tab-group>

  <div class="streams-content">
    @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p i18n="@@streams.loading">Loading streams...</p>
    </div>
    } @else if (currentStreams().length === 0) {
    <div class="empty-state">
      <mat-icon>video_library</mat-icon>
      <h2 i18n="@@streams.empty.title">No streams found</h2>
      <p>
        @if (selectedTabIndex() === 0) {
        <span i18n="@@streams.empty.live">There are no live streams at the moment. Check back later or explore scheduled
          streams.</span>
        } @else if (selectedTabIndex() === 1) {
        <span i18n="@@streams.empty.scheduled">There are no scheduled streams. Check back later for upcoming
          events.</span>
        } @else {
        <span i18n="@@streams.empty.ended">There are no ended streams to display.</span>
        }
      </p>
      <button mat-flat-button (click)="refresh()">
        <mat-icon>refresh</mat-icon>
        <span i18n="@@streams.refresh">Refresh</span>
      </button>
    </div>
    } @else {
    <div class="streams-grid">
      @for (stream of currentStreams(); track stream.id) {
      <mat-card class="stream-card">
        <mat-card-content>
          <app-live-event [event]="stream"></app-live-event>
        </mat-card-content>
      </mat-card>
      }
    </div>
    }
  </div>
</div>

<!-- Settings Dialog -->
@if (showSettingsDialog()) {
<app-streams-settings-dialog (closed)="onSettingsDialogClosed($event)" />
}