<div class="articles-container">
  <div class="articles-header">
    <h1>
      <mat-icon>article</mat-icon>
      <span i18n="@@articles.title">Articles</span>
    </h1>
    <div class="header-actions">
      @if (isAuthenticated()) {
      <mat-button-toggle-group [value]="feedSource()" (change)="onSourceChange($event.value)" class="source-toggle">
        <mat-button-toggle value="following">
          <mat-icon>people</mat-icon>
          <span i18n="@@articles.toggle.following">Following</span>
          @if (followingCount() > 0) {
          <span class="toggle-count">{{ followingCount() }}</span>
          }
        </mat-button-toggle>
        <mat-button-toggle value="public">
          <mat-icon>public</mat-icon>
          <span i18n="@@articles.toggle.public">Public</span>
          @if (publicCount() > 0) {
          <span class="toggle-count">{{ publicCount() }}</span>
          }
        </mat-button-toggle>
      </mat-button-toggle-group>
      }
      <button mat-icon-button (click)="refresh()" [disabled]="loading()" i18n-aria-label="@@articles.refresh.aria"
        aria-label="Refresh articles">
        <mat-icon>refresh</mat-icon>
      </button>
    </div>
  </div>

  <div class="articles-content">
    @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p i18n="@@articles.loading">Loading articles...</p>
    </div>
    } @else if (currentArticles().length === 0) {
    <div class="empty-state">
      <mat-icon>menu_book</mat-icon>
      <h2 i18n="@@articles.empty.title">No articles found</h2>
      <p>
        @if (feedSource() === 'following' && isAuthenticated()) {
        <span i18n="@@articles.empty.following">People you follow haven't published any articles yet. Switch to Public
          to discover articles from the wider Nostr network.</span>
        } @else {
        <span i18n="@@articles.empty.public">No articles have been published yet. Articles will appear here when authors
          publish them.</span>
        }
      </p>
      <button mat-flat-button (click)="refresh()">
        <mat-icon>refresh</mat-icon>
        <span i18n="@@articles.refresh">Refresh</span>
      </button>
    </div>
    } @else {
    <div class="articles-grid">
      @for (article of currentArticles(); track article.id) {
      <mat-card class="article-card clickable" (click)="openArticle(article)" (keydown.enter)="openArticle(article)"
        (keydown.space)="openArticle(article)" tabindex="0" role="button">
        <mat-card-content>
          <div class="article-author-row">
            <app-user-profile [pubkey]="article.pubkey" view="compact" [showRank]="false"></app-user-profile>
            <span class="article-date">{{ article.created_at | ago }}</span>
          </div>
          <app-article-event [event]="article" [showAuthor]="false"></app-article-event>
        </mat-card-content>
      </mat-card>
      }
    </div>

    @if (hasMore()) {
    <div class="load-more-container">
      @if (loadingMore()) {
      <mat-spinner diameter="24"></mat-spinner>
      } @else {
      <button mat-button (click)="loadMore()">
        <mat-icon>expand_more</mat-icon>
        <span i18n="@@articles.loadMore">Load More</span>
      </button>
      }
    </div>
    }
    }
  </div>
</div>