<!-- Panel Header -->
<div class="panel-header">
  <h2 class="panel-title title-font">Articles</h2>
  <span class="panel-header-spacer"></span>
  @if (isAuthenticated()) {
  <!-- People List Selector -->
  <app-list-filter-menu storageKey="articles" [showPublicOption]="true" defaultFilter="following"
    (filterChanged)="onListFilterChanged($event)" />
  }
  @if (isAuthenticated()) {
  <a mat-icon-button routerLink="/articles/edit" matTooltip="My Articles">
    <mat-icon>edit_document</mat-icon>
  </a>
  }
  <button mat-icon-button (click)="refresh()" matTooltip="Refresh articles">
    <mat-icon>refresh</mat-icon>
  </button>
  @if (isAuthenticated()) {
  <button mat-icon-button (click)="openSettings()" matTooltip="Configure article relays">
    <mat-icon>settings</mat-icon>
  </button>
  }
</div>

<div class="articles-container">
  <div class="articles-content">
    @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p i18n="@@articles.loading">Loading articles...</p>
    </div>
    } @else if (currentArticles().length === 0) {
    <div class="empty-state">
      <mat-icon>menu_book</mat-icon>
      <h2 i18n="@@articles.empty.title">No articles found</h2>
      <p>
        @if (!showFollowing() && !showPublic()) {
        <span>No sources selected. Enable "Following" or "Public" in Display Options to see articles.</span>
        } @else if (showFollowing() && !showPublic() && isAuthenticated()) {
        <span i18n="@@articles.empty.following">People you follow haven't published any articles yet. Enable "Public"
          in Display Options to discover articles from the wider Nostr network.</span>
        } @else {
        <span i18n="@@articles.empty.public">No articles have been published yet. Articles will appear here when authors
          publish them.</span>
        }
      </p>
      <button mat-flat-button (click)="refresh()">
        <mat-icon>refresh</mat-icon>
        <span i18n="@@articles.refresh">Refresh</span>
      </button>
    </div>
    } @else {
    <div class="articles-grid">
      @for (article of currentArticles(); track article.id) {
      <mat-card class="article-card clickable" (click)="openArticle(article)" (keydown.enter)="openArticle(article)"
        (keydown.space)="openArticle(article)" tabindex="0" role="button">
        <mat-card-content>
          <div class="article-author-row">
            <app-user-profile [pubkey]="article.pubkey" view="compact" [showRank]="false"></app-user-profile>
            <span class="article-date">{{ article.created_at | ago }}</span>
          </div>
          <app-article-event [event]="article" [showAuthor]="false"></app-article-event>
        </mat-card-content>
      </mat-card>
      }
    </div>

    @if (hasMore()) {
    <div class="load-more-container">
      @if (loadingMore()) {
      <mat-spinner diameter="24"></mat-spinner>
      } @else {
      <button mat-button (click)="loadMore()">
        <mat-icon>expand_more</mat-icon>
        <span i18n="@@articles.loadMore">Load More</span>
      </button>
      }
    </div>
    }
    }
  </div>
</div>

@if (showSettingsDialog()) {
<app-articles-settings-dialog (closed)="onSettingsDialogClosed($event)" />
}