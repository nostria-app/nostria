<div class="tab-content">
  <div class="notes-container">
    <div class="notes-list-container">
      @if (profileState.isInitiallyLoading() && profileState.displayedTimeline().length === 0) {
      <div class="loading-state">
        <mat-spinner [diameter]="40"></mat-spinner>
        <p>Loading timeline...</p>
      </div>
      } @else if (error()) {
      <div class="error-state">
        <mat-icon>error</mat-icon>
        <p>{{ error() }}</p>
      </div>
      } @else {

      <!-- Pinned Notes Section - Show regardless of timeline content -->
      @if (pinnedNotes().length > 0) {
      <div class="pinned-notes-section">
        <div class="pinned-notes-header">
          <mat-icon class="pin-icon">push_pin</mat-icon>
          <h3>Pinned</h3>
        </div>
        <div class="pinned-notes-container">
          @for (note of pinnedNotes(); track note.event.id) {
          <div class="pinned-note-wrapper">
            <app-event [event]="note.event" appearance="plain" [compact]="true" [hideParentEvent]="true"></app-event>
          </div>
          }
        </div>
      </div>
      }

      @if (profileState.displayedTimeline().length === 0) {
        @if (profileState.hasHiddenRepliesButNoContent()) {
        <div class="hidden-replies-state">
          <mat-icon>chat_bubble_outline</mat-icon>
          <h3>No original posts found</h3>
          <p>This user has {{ profileState.hiddenRepliesCount() }} {{ profileState.hiddenRepliesCount() === 1 ? 'reply' : 'replies' }} that {{ profileState.hiddenRepliesCount() === 1 ? 'is' : 'are' }} currently hidden by your display options.</p>
          <div class="hidden-replies-actions">
            <button mat-flat-button (click)="showReplies()">
              <mat-icon>visibility</mat-icon>
              Show replies
            </button>
            <button mat-stroked-button (click)="loadMoreToFindPosts()" [disabled]="isSearchingForPosts() || !profileState.hasMoreNotes()">
              @if (isSearchingForPosts()) {
                <mat-spinner diameter="18"></mat-spinner>
              } @else {
                <mat-icon>search</mat-icon>
              }
              Search for more posts
            </button>
          </div>
          @if (!profileState.hasMoreNotes()) {
          <p class="no-more-hint">No more events available from relays</p>
          }
        </div>
        } @else {
        <div class="empty-state">
          <mat-icon>timeline</mat-icon>
          <p>No timeline content to display yet</p>
        </div>
        }
      } @else {

      <div class="notes-list">
        @for (item of profileState.displayedTimeline(); track item.event.id) {
        <app-event [event]="item.event" appearance="plain"></app-event>
        }

        <!-- Loading more indicator -->
        @if (profileState.isLoadingMoreNotes()) {
        <div class="loading-more-indicator">
          <mat-spinner diameter="24"></mat-spinner>
          <p>Loading more content...</p>
        </div>
        }

        <!-- No more notes indicator - with hidden replies hint if applicable -->
        @if (!profileState.hasMoreNotes() && !profileState.hasMoreToDisplay() && profileState.displayedTimeline().length > 0) {
        <div class="no-more-indicator">
          <mat-icon>inbox</mat-icon>
          @if (profileState.hiddenRepliesCount() > 0 && !profileState.timelineFilter().showReplies) {
          <p>You've reached the end. {{ profileState.hiddenRepliesCount() }} {{ profileState.hiddenRepliesCount() === 1 ? 'reply is' : 'replies are' }} hidden. <button class="show-replies-link" (click)="showReplies()">Show replies</button></p>
          } @else {
          <p>You've reached the end</p>
          }
        </div>
        }
      </div>
      }

      }
    </div>
  </div>
</div>