<div class="tab-content">
  <div class="notes-container">
    <div class="notes-list-container">
      @if (profileState.isInitiallyLoading() && profileState.sortedTimeline().length === 0) {
      <div class="loading-state">
        <mat-spinner [diameter]="40"></mat-spinner>
        <p>Loading timeline...</p>
      </div>
      } @else if (error()) {
      <div class="error-state">
        <mat-icon>error</mat-icon>
        <p>{{ error() }}</p>
      </div>
      } @else {

      <!-- Pinned Notes Section - Show regardless of timeline content -->
      @if (pinnedNotes().length > 0) {
      <div class="pinned-notes-section">
        <div class="pinned-notes-header">
          <mat-icon class="pin-icon">push_pin</mat-icon>
          <h3>Pinned</h3>
        </div>
        <div class="pinned-notes-container">
          @for (note of pinnedNotes(); track note.event.id) {
          <div class="pinned-note-wrapper">
            <app-event [event]="note.event" appearance="plain" [compact]="true" [hideParentEvent]="true"></app-event>
          </div>
          }
        </div>
      </div>
      }

      @if (profileState.sortedTimeline().length === 0) {
      <div class="empty-state">
        <mat-icon>timeline</mat-icon>
        <p>No timeline content to display yet</p>
      </div>
      } @else {

      <div class="notes-list">
        @for (item of profileState.sortedTimeline(); track item.event.id || $index) {
        <app-event [event]="item.event" appearance="plain"></app-event>
        }

        <!-- Loading more indicator -->
        @if (profileState.isLoadingMoreNotes()) {
        <div class="loading-more-indicator">
          <mat-spinner diameter="24"></mat-spinner>
          <p>Loading more content...</p>
        </div>
        }

        <!-- No more notes indicator -->
        @if (!profileState.hasMoreNotes() && profileState.sortedTimeline().length > 0) {
        <div class="no-more-indicator">
          <mat-icon>inbox</mat-icon>
          <p>You've reached the end</p>
        </div>
        }
      </div>
      }

      }
    </div>

    <div class="options-section">
      <!-- Mobile collapsible version -->
      <mat-expansion-panel class="mobile-only" hideToggle>
        <mat-expansion-panel-header>
          <mat-panel-title>
            <mat-icon>tune</mat-icon>
            <span>Display Options</span>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="option-controls">
          <div class="filter-option">
            <mat-slide-toggle [checked]="timelineFilter.showNotes" (change)="updateFilter('showNotes', $event.checked)"
              color="primary">
              <mat-icon>description</mat-icon>
              <span>Notes</span>
            </mat-slide-toggle>
            <span class="option-description">Short text posts</span>
          </div>

          <div class="filter-option">
            <mat-slide-toggle [checked]="timelineFilter.showReposts"
              (change)="updateFilter('showReposts', $event.checked)" color="primary">
              <mat-icon>repeat</mat-icon>
              <span>Reposts</span>
            </mat-slide-toggle>
            <span class="option-description">Shared content from others</span>
          </div>

          <div class="filter-option">
            <mat-slide-toggle [checked]="timelineFilter.showReplies"
              (change)="updateFilter('showReplies', $event.checked)" color="primary">
              <mat-icon>reply</mat-icon>
              <span>Replies</span>
            </mat-slide-toggle>
            <span class="option-description">Comments on other posts</span>
          </div>

          <div class="filter-option">
            <mat-slide-toggle [checked]="timelineFilter.showAudio" (change)="updateFilter('showAudio', $event.checked)"
              color="primary">
              <mat-icon>audiotrack</mat-icon>
              <span>Audio Clips</span>
            </mat-slide-toggle>
            <span class="option-description">Audio posts and music</span>
          </div>

          <div class="filter-option">
            <mat-slide-toggle [checked]="timelineFilter.showVideo" (change)="updateFilter('showVideo', $event.checked)"
              color="primary">
              <mat-icon>movie</mat-icon>
              <span>Video Clips</span>
            </mat-slide-toggle>
            <span class="option-description">Video posts and clips</span>
          </div>

          <div class="filter-divider"></div>

          <div class="filter-option advanced-option">
            <mat-slide-toggle [checked]="timelineFilter.showReactions"
              (change)="updateFilter('showReactions', $event.checked)" color="accent"
              matTooltip="Show reaction events (experimental)">
              <mat-icon>favorite</mat-icon>
              <span>Reactions</span>
            </mat-slide-toggle>
            <span class="option-description">Like and emoji reactions</span>
          </div>
        </div>
      </mat-expansion-panel>

      <!-- Desktop always-visible version -->
      <div class="desktop-only">
        <h3 class="options-title">Display Options</h3>
        <div class="option-controls">
          <div class="filter-option">
            <mat-slide-toggle [checked]="timelineFilter.showNotes" (change)="updateFilter('showNotes', $event.checked)"
              color="primary">
              <mat-icon>description</mat-icon>
              <span>Notes</span>
            </mat-slide-toggle>
            <span class="option-description">Short text posts</span>
          </div>

          <div class="filter-option">
            <mat-slide-toggle [checked]="timelineFilter.showReposts"
              (change)="updateFilter('showReposts', $event.checked)" color="primary">
              <mat-icon>repeat</mat-icon>
              <span>Reposts</span>
            </mat-slide-toggle>
            <span class="option-description">Shared content from others</span>
          </div>

          <div class="filter-option">
            <mat-slide-toggle [checked]="timelineFilter.showReplies"
              (change)="updateFilter('showReplies', $event.checked)" color="primary">
              <mat-icon>reply</mat-icon>
              <span>Replies</span>
            </mat-slide-toggle>
            <span class="option-description">Comments on other posts</span>
          </div>

          <div class="filter-option">
            <mat-slide-toggle [checked]="timelineFilter.showAudio" (change)="updateFilter('showAudio', $event.checked)"
              color="primary">
              <mat-icon>audiotrack</mat-icon>
              <span>Audio Clips</span>
            </mat-slide-toggle>
            <span class="option-description">Audio posts and music</span>
          </div>

          <div class="filter-option">
            <mat-slide-toggle [checked]="timelineFilter.showVideo" (change)="updateFilter('showVideo', $event.checked)"
              color="primary">
              <mat-icon>movie</mat-icon>
              <span>Video Clips</span>
            </mat-slide-toggle>
            <span class="option-description">Video posts and clips</span>
          </div>

          <div class="filter-divider"></div>

          <div class="filter-option advanced-option">
            <mat-slide-toggle [checked]="timelineFilter.showReactions"
              (change)="updateFilter('showReactions', $event.checked)" color="accent"
              matTooltip="Show reaction events (experimental)">
              <mat-icon>favorite</mat-icon>
              <span>Reactions</span>
            </mat-slide-toggle>
            <span class="option-description">Like and emoji reactions</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>