<div class="panel-header">
  <button mat-icon-button (click)="goBack()" matTooltip="Back to Music">
    <mat-icon>arrow_back</mat-icon>
  </button>
  <h2 class="panel-title title-font" i18n="@@music.artists.title">Artists</h2>
  <span class="panel-header-spacer"></span>
  <button mat-icon-button (click)="toggleSearch()" [matTooltip]="showSearch() ? 'Close search' : 'Search artists'" class="hide-small">
    <mat-icon>{{ showSearch() ? 'search_off' : 'search' }}</mat-icon>
  </button>
  <mat-select [(value)]="sortBy" class="sort-select hide-small" aria-label="Sort artists">
    <mat-option value="name-asc" i18n="@@music.artists.sort.nameAsc">Name (A-Z)</mat-option>
    <mat-option value="name-desc" i18n="@@music.artists.sort.nameDesc">Name (Z-A)</mat-option>
    <mat-option value="tracks-desc" i18n="@@music.artists.sort.tracksDesc">Tracks (Most)</mat-option>
    <mat-option value="tracks-asc" i18n="@@music.artists.sort.tracksAsc">Tracks (Least)</mat-option>
  </mat-select>
  <button mat-icon-button [matMenuTriggerFor]="moreOptionsMenu" matTooltip="More options" class="show-small">
    <mat-icon>more_vert</mat-icon>
  </button>
  <mat-menu #moreOptionsMenu="matMenu">
    <button mat-menu-item (click)="toggleSearch()">
      <mat-icon>{{ showSearch() ? 'search_off' : 'search' }}</mat-icon>
      <span>{{ showSearch() ? 'Close Search' : 'Search' }}</span>
    </button>
    <button mat-menu-item [matMenuTriggerFor]="sortMenu">
      <mat-icon>sort</mat-icon>
      <span>Sort</span>
    </button>
  </mat-menu>
  <mat-menu #sortMenu="matMenu">
    <button mat-menu-item (click)="sortBy.set('name-asc')">
      <mat-icon>{{ sortBy() === 'name-asc' ? 'check' : '' }}</mat-icon>
      <span>Name (A-Z)</span>
    </button>
    <button mat-menu-item (click)="sortBy.set('name-desc')">
      <mat-icon>{{ sortBy() === 'name-desc' ? 'check' : '' }}</mat-icon>
      <span>Name (Z-A)</span>
    </button>
    <button mat-menu-item (click)="sortBy.set('tracks-desc')">
      <mat-icon>{{ sortBy() === 'tracks-desc' ? 'check' : '' }}</mat-icon>
      <span>Tracks (Most)</span>
    </button>
    <button mat-menu-item (click)="sortBy.set('tracks-asc')">
      <mat-icon>{{ sortBy() === 'tracks-asc' ? 'check' : '' }}</mat-icon>
      <span>Tracks (Least)</span>
    </button>
  </mat-menu>
</div>

<div class="artists-container">
    <div class="search-bar" [class.hidden]="!showSearch()">
      <mat-icon class="search-icon">search</mat-icon>
      <input #searchInput type="text" class="search-input" placeholder="Search artists..."
        [value]="searchQuery()" (input)="onSearchInput($any($event))" />
      <button mat-icon-button class="clear-search-btn" [class.invisible]="!searchQuery()" (click)="clearSearch()"
        aria-label="Clear search">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    @if (showSearch() && searchQuery()) {
      <div class="search-results-info">
        @if (filteredArtists().length > 0) {
          <span>Found {{ filteredArtists().length }} result{{ filteredArtists().length === 1 ? '' : 's' }} for "{{ searchQuery() }}"</span>
        } @else {
          <span>No results found for "{{ searchQuery() }}"</span>
        }
      </div>
    }

    @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p i18n="@@music.artists.loading">Loading artists...</p>
    </div>
    } @else {
    @if (filteredArtists().length > 0) {
    <div class="artists-count">
      <span i18n="@@music.artists.count">{{ filteredArtists().length }} artist{{ filteredArtists().length === 1 ? '' : 's' }}</span>
    </div>
    <div class="artists-grid">
      @for (artist of filteredArtists(); track artist.name) {
      <div class="artist-card" (click)="goToArtist(artist.pubkey)" (keydown.enter)="goToArtist(artist.pubkey)"
        tabindex="0" role="button">
        <div class="artist-avatar">
          @if (getArtistPicture(artist.pubkey)) {
          <img [src]="getArtistPicture(artist.pubkey)" alt="{{ artist.name }}" />
          } @else {
          <mat-icon>person</mat-icon>
          }
        </div>
        <div class="artist-info">
          <span class="artist-name">{{ artist.name }}</span>
          <span class="artist-track-count">{{ artist.trackCount }} track{{ artist.trackCount === 1 ? '' : 's' }}</span>
        </div>
        <button mat-icon-button [matMenuTriggerFor]="artistMenu" class="artist-menu-btn" 
          (click)="$event.stopPropagation()" aria-label="Artist options">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #artistMenu="matMenu">
          <button mat-menu-item (click)="zapArtist($event, artist)">
            <mat-icon>bolt</mat-icon>
            <span>Zap Artist</span>
          </button>
          <button mat-menu-item (click)="goToArtist(artist.pubkey)">
            <mat-icon>person</mat-icon>
            <span>View Artist</span>
          </button>
        </mat-menu>
      </div>
      }
    </div>
    } @else {
    <div class="empty-state">
      <mat-icon>person_off</mat-icon>
      <h2 i18n="@@music.artists.empty.title">No artists found</h2>
      <p i18n="@@music.artists.empty.message">No music tracks with artist information were found.</p>
      <button mat-flat-button (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        <span i18n="@@music.artists.goBack">Go back to Music</span>
      </button>
    </div>
    }
    }
</div>