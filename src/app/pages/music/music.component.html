<div class="music-container">
  <div class="music-header">
    <h1>
      <mat-icon>music_note</mat-icon>
      <span i18n="@@music.title">Music</span>
    </h1>
    <div class="header-actions">
      @if (isAuthenticated()) {
      <mat-button-toggle-group [value]="feedSource()" (change)="onSourceChange($event.value)" class="source-toggle">
        <mat-button-toggle value="following">
          <mat-icon>people</mat-icon>
          <span i18n="@@music.toggle.following">Following</span>
          @if (followingCount() > 0) {
          <span class="toggle-count">{{ followingCount() }}</span>
          }
        </mat-button-toggle>
        <mat-button-toggle value="public">
          <mat-icon>public</mat-icon>
          <span i18n="@@music.toggle.public">Public</span>
          @if (publicCount() > 0) {
          <span class="toggle-count">{{ publicCount() }}</span>
          }
        </mat-button-toggle>
      </mat-button-toggle-group>
      }
      <button mat-icon-button (click)="refresh()" [disabled]="loading()" i18n-aria-label="@@music.refresh.aria"
        aria-label="Refresh music">
        <mat-icon>refresh</mat-icon>
      </button>
    </div>
  </div>

  <div class="music-content">
    @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p i18n="@@music.loading">Loading music...</p>
    </div>
    } @else if (currentTracks().length === 0) {
    <div class="empty-state">
      <mat-icon>library_music</mat-icon>
      <h2 i18n="@@music.empty.title">No music found</h2>
      <p>
        @if (feedSource() === 'following' && isAuthenticated()) {
        <span i18n="@@music.empty.following">People you follow haven't shared any music yet. Switch to Public to
          discover music from the wider Nostr network.</span>
        } @else {
        <span i18n="@@music.empty.public">No music tracks have been shared yet. Music tracks will appear here when
          creators publish them.</span>
        }
      </p>
      <button mat-flat-button (click)="refresh()">
        <mat-icon>refresh</mat-icon>
        <span i18n="@@music.refresh">Refresh</span>
      </button>
    </div>
    } @else {
    <div class="music-grid">
      @for (track of currentTracks(); track track.id) {
      <app-music-event [event]="track"></app-music-event>
      }
    </div>

    @if (hasMore()) {
    <div class="load-more-container">
      @if (loadingMore()) {
      <mat-spinner diameter="24"></mat-spinner>
      } @else {
      <button mat-button (click)="loadMore()">
        <mat-icon>expand_more</mat-icon>
        <span i18n="@@music.loadMore">Load More</span>
      </button>
      }
    </div>
    }
    }
  </div>
</div>