<div class="music-container">
  <div class="music-header">
    <h1>
      <mat-icon>music_note</mat-icon>
      <span i18n="@@music.title">Music</span>
    </h1>
    <div class="header-actions">
      @if (isAuthenticated()) {
      <button mat-icon-button [matMenuTriggerFor]="addMenu" aria-label="Add content">
        <mat-icon>add</mat-icon>
      </button>
      <mat-menu #addMenu="matMenu">
        <button mat-menu-item (click)="openUploadTrack()">
          <mat-icon>upload</mat-icon>
          <span i18n="@@music.menu.uploadTrack">Upload Track</span>
        </button>
        <button mat-menu-item (click)="openCreatePlaylist()">
          <mat-icon>playlist_add</mat-icon>
          <span i18n="@@music.menu.createPlaylist">Create Playlist</span>
        </button>
        <button mat-menu-item (click)="openImportFromRss()">
          <mat-icon>rss_feed</mat-icon>
          <span i18n="@@music.menu.importRss">Import from RSS</span>
        </button>
      </mat-menu>
      }
      <button mat-icon-button (click)="refresh()" [disabled]="loading()" i18n-aria-label="@@music.refresh.aria"
        aria-label="Refresh music">
        <mat-icon>refresh</mat-icon>
      </button>
    </div>
  </div>

  <div class="music-content">
    @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p i18n="@@music.loading">Loading music...</p>
    </div>
    } @else {
    <!-- YOURS SECTION (Only for authenticated users) -->
    @if (isAuthenticated()) {
    <section class="music-section">
      <div class="section-header">
        <h2 i18n="@@music.section.yours">Yours</h2>
      </div>
      <div class="playlists-grid">
        <!-- Liked Songs Card -->
        <div class="liked-songs-card">
          <div class="liked-songs-clickable" (click)="goToLikedSongs()" (keydown.enter)="goToLikedSongs()" tabindex="0"
            role="button">
            <div class="liked-songs-cover">
              <mat-icon>favorite</mat-icon>
            </div>
            <div class="liked-songs-info">
              <span class="liked-songs-title" i18n="@@music.likedSongs">Liked Songs</span>
              <span class="liked-songs-meta" i18n="@@music.likedSongs.subtitle">Your favorite tracks</span>
            </div>
          </div>
          <button mat-icon-button class="liked-songs-play-btn" (click)="playLikedSongs($event)"
            [disabled]="isLoadingLikedSongs()" i18n-aria-label="@@music.playLikedSongs.aria"
            aria-label="Play liked songs">
            @if (isLoadingLikedSongs()) {
            <mat-spinner diameter="24"></mat-spinner>
            } @else {
            <mat-icon>play_arrow</mat-icon>
            }
          </button>
        </div>

        <!-- Liked Playlists Card -->
        <div class="liked-playlists-card" (click)="goToLikedPlaylists()" (keydown.enter)="goToLikedPlaylists()"
          tabindex="0" role="button">
          <div class="liked-playlists-cover">
            <mat-icon>playlist_play</mat-icon>
          </div>
          <div class="liked-playlists-info">
            <span class="liked-playlists-title">Liked Playlists</span>
            <span class="liked-playlists-meta">Your favorite collections</span>
          </div>
        </div>

        <!-- Your Records Card -->
        <div class="your-records-card" (click)="goToYourRecords()" (keydown.enter)="goToYourRecords()" tabindex="0"
          role="button">
          <div class="your-records-cover">
            <mat-icon>album</mat-icon>
          </div>
          <div class="your-records-info">
            <span class="your-records-title" i18n="@@music.yourRecords">Your Records</span>
            <span class="your-records-meta" i18n="@@music.yourRecords.subtitle">Tracks you've published</span>
          </div>
        </div>

        <!-- User's playlists -->
        @for (playlist of myPlaylistsPreview(); track playlist.id) {
        <app-music-playlist-card [event]="playlist"></app-music-playlist-card>
        }
      </div>
    </section>
    }

    <!-- PLAYLISTS (FOLLOWING) SECTION -->
    @if (followingPlaylistsPreview().length > 0) {
    <section class="music-section">
      <div class="section-header">
        <h2>
          <span i18n="@@music.section.playlistsFollowing">Playlists (Following)</span>
          @if (followingPlaylistsCount() > 0) {
          <span class="section-count">{{ followingPlaylistsCount() }}</span>
          }
        </h2>
        @if (hasMoreFollowingPlaylists()) {
        <button mat-button (click)="goToAllFollowingPlaylists()" class="show-all-btn">
          <span i18n="@@music.showAll">Show all</span>
          <mat-icon>arrow_forward</mat-icon>
        </button>
        }
      </div>
      <div class="playlists-grid">
        @for (playlist of followingPlaylistsPreview(); track playlist.id) {
        <app-music-playlist-card [event]="playlist"></app-music-playlist-card>
        }
      </div>
    </section>
    }

    <!-- SONGS (FOLLOWING) SECTION -->
    @if (followingTracksPreview().length > 0) {
    <section class="music-section">
      <div class="section-header">
        <h2>
          <span i18n="@@music.section.songsFollowing">Songs (Following)</span>
          @if (followingTracksCount() > 0) {
          <span class="section-count">{{ followingTracksCount() }}</span>
          }
        </h2>
        @if (hasMoreFollowingTracks()) {
        <button mat-button (click)="goToAllFollowingTracks()" class="show-all-btn">
          <span i18n="@@music.showAll">Show all</span>
          <mat-icon>arrow_forward</mat-icon>
        </button>
        }
      </div>
      <div class="music-grid">
        @for (track of followingTracksPreview(); track track.id) {
        <app-music-event [event]="track" mode="card"></app-music-event>
        }
      </div>
    </section>
    }

    <!-- PLAYLISTS (PUBLIC) SECTION -->
    @if (publicPlaylistsPreview().length > 0) {
    <section class="music-section">
      <div class="section-header">
        <h2>
          <span i18n="@@music.section.playlistsPublic">Playlists (Public)</span>
          @if (publicPlaylistsCount() > 0) {
          <span class="section-count">{{ publicPlaylistsCount() }}</span>
          }
        </h2>
        @if (hasMorePublicPlaylists()) {
        <button mat-button (click)="goToAllPublicPlaylists()" class="show-all-btn">
          <span i18n="@@music.showAll">Show all</span>
          <mat-icon>arrow_forward</mat-icon>
        </button>
        }
      </div>
      <div class="playlists-grid">
        @for (playlist of publicPlaylistsPreview(); track playlist.id) {
        <app-music-playlist-card [event]="playlist"></app-music-playlist-card>
        }
      </div>
    </section>
    }

    <!-- SONGS (PUBLIC) SECTION -->
    @if (publicTracksPreview().length > 0) {
    <section class="music-section">
      <div class="section-header">
        <h2>
          <span i18n="@@music.section.songsPublic">Songs (Public)</span>
          @if (publicTracksCount() > 0) {
          <span class="section-count">{{ publicTracksCount() }}</span>
          }
        </h2>
        @if (hasMorePublicTracks()) {
        <button mat-button (click)="goToAllPublicTracks()" class="show-all-btn">
          <span i18n="@@music.showAll">Show all</span>
          <mat-icon>arrow_forward</mat-icon>
        </button>
        }
      </div>
      <div class="music-grid">
        @for (track of publicTracksPreview(); track track.id) {
        <app-music-event [event]="track" mode="card"></app-music-event>
        }
      </div>
    </section>
    }

    <!-- EMPTY STATE -->
    @if (followingTracksPreview().length === 0 && publicTracksPreview().length === 0 &&
    followingPlaylistsPreview().length === 0 && publicPlaylistsPreview().length === 0) {
    <div class="empty-state">
      <mat-icon>library_music</mat-icon>
      <h2 i18n="@@music.empty.title">No music found</h2>
      <p i18n="@@music.empty.message">Music tracks and playlists will appear here when creators publish them.</p>
      <button mat-flat-button (click)="refresh()">
        <mat-icon>refresh</mat-icon>
        <span i18n="@@music.refresh">Refresh</span>
      </button>
    </div>
    }
    }
  </div>
</div>

<!-- Dialogs -->
@if (showUploadDialog()) {
<app-music-track-dialog (closed)="onUploadDialogClosed($event)" />
}

@if (showCreatePlaylistDialog()) {
<app-create-music-playlist-dialog (closed)="onCreatePlaylistDialogClosed($event)" />
}

@if (showImportRssDialog()) {
<app-import-rss-dialog (closed)="onImportRssDialogClosed($event)" />
}