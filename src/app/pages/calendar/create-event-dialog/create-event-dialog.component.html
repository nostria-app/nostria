<div class="create-event-dialog">
  <div class="dialog-header">
    <h2 mat-dialog-title>Create New Event</h2>
    <button
      mat-icon-button
      mat-dialog-close
      class="close-button"
      matTooltip="Close"
    >
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div mat-dialog-content class="dialog-content">
    <form [formGroup]="eventForm" class="event-form">
      <!-- Title -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Event Title</mat-label>
        <input
          matInput
          formControlName="title"
          placeholder="Enter event title"
          maxlength="200"
        />
        <mat-hint
          >{{ eventForm.get('title')?.value?.length || 0 }}/200</mat-hint
        >
        <mat-error>Event title is required</mat-error>
      </mat-form-field>

      <!-- Summary -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Summary (Optional)</mat-label>
        <input
          matInput
          formControlName="summary"
          placeholder="Brief description of the event"
          maxlength="500"
        />
        <mat-hint
          >{{ eventForm.get('summary')?.value?.length || 0 }}/500</mat-hint
        >
      </mat-form-field>

      <!-- All Day Toggle -->
      <div class="all-day-section">
        <mat-slide-toggle formControlName="isAllDay" class="all-day-toggle">
          <span class="toggle-label">All Day Event</span>
        </mat-slide-toggle>
      </div>

      <!-- Date and Time Section -->
      <div class="datetime-section">
        <div class="datetime-row">
          <!-- Start Date -->
          <mat-form-field appearance="outline" class="date-field">
            <mat-label>Start Date</mat-label>
            <input
              matInput
              [matDatepicker]="startDatePicker"
              formControlName="startDate"
              placeholder="Select start date"
              title="Event start date"
            />
            <mat-datepicker-toggle
              matIconSuffix
              [for]="startDatePicker"
            ></mat-datepicker-toggle>
            <mat-datepicker #startDatePicker></mat-datepicker>
            <mat-error>Start date is required</mat-error>
          </mat-form-field>

          <!-- Start Time (if not all day) -->
          @if (!isAllDay()) {
            <mat-form-field appearance="outline" class="time-field">
              <mat-label>Start Time</mat-label>
              <input
                matInput
                type="time"
                formControlName="startTime"
                placeholder="00:00"
              />
            </mat-form-field>
          }
        </div>

        <div class="datetime-row">
          <!-- End Date -->
          <mat-form-field appearance="outline" class="date-field">
            <mat-label>End Date (Optional)</mat-label>
            <input
              matInput
              [matDatepicker]="endDatePicker"
              formControlName="endDate"
              placeholder="Select end date"
              title="Event end date"
            />
            <mat-datepicker-toggle
              matIconSuffix
              [for]="endDatePicker"
            ></mat-datepicker-toggle>
            <mat-datepicker #endDatePicker></mat-datepicker>
          </mat-form-field>

          <!-- End Time (if not all day) -->
          @if (!isAllDay()) {
            <mat-form-field appearance="outline" class="time-field">
              <mat-label>End Time</mat-label>
              <input
                matInput
                type="time"
                formControlName="endTime"
                placeholder="00:00"
              />
            </mat-form-field>
          }
        </div>
      </div>

      <!-- Location -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Location (Optional)</mat-label>
        <input
          matInput
          formControlName="location"
          placeholder="Event location or meeting link"
          maxlength="300"
        />
        <mat-icon matPrefix>location_on</mat-icon>
        <mat-hint
          >{{ eventForm.get('location')?.value?.length || 0 }}/300</mat-hint
        >
      </mat-form-field>

      <!-- Description -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description (Optional)</mat-label>
        <textarea
          matInput
          formControlName="content"
          placeholder="Detailed description of the event"
          rows="4"
          maxlength="2000"
        ></textarea>
        <mat-hint
          >{{ eventForm.get('content')?.value?.length || 0 }}/2000</mat-hint
        >
      </mat-form-field>

      <!-- Hashtags -->
      <div class="hashtags-section">
        <mat-form-field appearance="outline" class="hashtag-input">
          <mat-label>Add Hashtags</mat-label>
          <input
            matInput
            formControlName="hashtag"
            placeholder="Enter hashtag and press Enter"
            (keydown)="onHashtagKeyPress($event)"
          />
          <mat-icon matPrefix>tag</mat-icon>
          <button
            mat-icon-button
            matSuffix
            type="button"
            (click)="addHashtag()"
            matTooltip="Add hashtag"
          >
            <mat-icon>add</mat-icon>
          </button>
        </mat-form-field>

        <!-- Display hashtags -->
        @if (hashtags().length > 0) {
          <div class="hashtags-display">
            @for (hashtag of hashtags(); track hashtag) {
              <mat-chip removable (removed)="removeHashtag(hashtag)">
                #{{ hashtag }}
                <mat-icon matChipRemove>cancel</mat-icon>
              </mat-chip>
            }
          </div>
        }
      </div>
    </form>
  </div>

  <div mat-dialog-actions class="dialog-actions">
    <button mat-button (click)="cancel()" [disabled]="isLoading()">
      Cancel
    </button>

    <button
      mat-raised-button
      color="primary"
      (click)="create()"
      [disabled]="!eventForm.valid || isLoading()"
      class="create-button"
    >
      @if (isLoading()) {
        <ng-container>
          <mat-icon class="spinning">sync</mat-icon>
          Creating...
        </ng-container>
      } @else {
        <ng-container>
          <mat-icon>event</mat-icon>
          Create Event
        </ng-container>
      }
    </button>
  </div>
</div>
