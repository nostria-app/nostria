<div class="clip-card">
  @if (videoUrl()) {
  <app-inline-video-player class="clip-player" [src]="videoUrl()" [poster]="posterUrl()" [autoplay]="active()"
    [muted]="false" [ignoreGlobalMutePreference]="true" [loop]="true" [objectFit]="objectFitMode()"
    [fillContainer]="true" [controlsConfig]="{
      showQuality: false,
      showPlaybackRate: false,
      showCast: false,
      showPiP: false,
      showFullscreen: false,
      showVolumeControl: false,
      showTimeDisplay: false,
      showControlsRow: false,
      progressPosition: 'bottom',
      isLiveStream: false,
      autoHide: false,
      showPlayPauseButton: false,
      showCenterPlayButton: false
    }">
  </app-inline-video-player>
  } @else {
  <div class="video-fallback">
    <mat-icon>movie</mat-icon>
    <span>Video unavailable</span>
  </div>
  }

  <div class="top-gradient"></div>
  <div class="bottom-gradient"></div>

  <div class="clip-metadata">
    <button class="author author-button" (click)="openAuthorProfile($event)">{{ authorLabel() }}</button>
    <div class="timestamp">{{ event().created_at | ago }}</div>
    <div class="title">{{ title() }}</div>
    @if (description()) {
    <div class="description">{{ description() }}</div>
    }
  </div>

  <div class="clip-actions">
    <div class="action-item author-avatar-action">
      <button class="author-avatar-button" (click)="openAuthorProfile($event)" aria-label="Open author profile">
        @if (authorAvatar()) {
        <img [src]="authorAvatar()" alt="Author avatar" class="author-avatar-image" />
        } @else {
        <mat-icon>account_circle</mat-icon>
        }
      </button>
      @if (canQuickFollow()) {
      <button class="quick-follow-button" (click)="quickFollow($event)" aria-label="Follow author">
        <mat-icon>add</mat-icon>
      </button>
      }
    </div>

    <div class="action-item like-action">
      <app-reaction-button [event]="event()" view="icon" (reactionChanged)="onReactionChanged()"></app-reaction-button>
      <span class="action-count" [class.hidden]="likesCount() <= 0">{{ likesCount() > 0 ? likesCount() : '0' }}</span>
    </div>

    <button mat-icon-button class="action-item" (click)="onComments($event)" matTooltip="Comments">
      <mat-icon>mode_comment</mat-icon>
      <span class="action-count" [class.hidden]="commentsCount() <= 0">{{ commentsCount() > 0 ? commentsCount() : '0'
        }}</span>
    </button>

    <button mat-icon-button class="action-item" (click)="onShare($event)" matTooltip="Share">
      <mat-icon>share</mat-icon>
      <span class="action-count" [class.hidden]="sharesCount() <= 0">{{ sharesCount() > 0 ? sharesCount() : '0'
        }}</span>
    </button>

    <div class="action-item zap-action" matTooltip="Zap">
      <app-zap-button [event]="event()" [recipientPubkey]="event().pubkey"></app-zap-button>
    </div>

    <button mat-icon-button class="action-item bookmark-action" (click)="toggleBookmark($event)"
      [matTooltip]="bookmark.getBookmarkTooltip(event().id)">
      <mat-icon>{{ bookmark.getBookmarkIcon(event().id) }}</mat-icon>
    </button>
  </div>
</div>