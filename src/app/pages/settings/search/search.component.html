<div class="content-medium">
  <h2 i18n="@@settings.search.title">Search Settings</h2>

  <h3 i18n="@@settings.search.add-new">Add New Search Relay</h3>

  <div class="flex-container add-relay-container">
    <mat-form-field appearance="outline" class="relay-input" subscriptSizing="dynamic">
      <mat-label i18n="@@settings.search.add-url">Relay URL (wss://...)</mat-label>
      <input matInput placeholder="wss://relay.nostr.band" [value]="newSearchRelayUrl()"
        (input)="newSearchRelayUrl.set($any($event.target).value)" (keyup.enter)="addSearchRelay()" />
    </mat-form-field>
    <button mat-flat-button class="add-button" (click)="addSearchRelay()"
      [disabled]="isPublishing()"
      i18n="@@settings.search.add-button">
      Add Search Relay
    </button>
  </div>

  <mat-card class="search-relays-card">
    <app-info-tooltip [content]="searchRelaysInfoContent"
      ariaLabel="Learn how search relays work"></app-info-tooltip>
    <mat-card-header>
      <mat-card-title i18n="@@settings.search.relays-title">Search Relays</mat-card-title>
      <mat-card-subtitle i18n="@@settings.search.subtitle">These relays are used when performing search queries (NIP-50)</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      @if (searchRelays().length === 0) {
      <div class="text-center py-8 text-gray-500">
        <mat-icon class="large-icon">search_off</mat-icon>
        <p i18n="@@settings.search.empty.title">You don't have any search relays configured.</p>
        <p i18n="@@settings.search.empty.description">Add a search relay using the input above to enable search functionality.</p>
      </div>
      } @else {
      <mat-list>
        @for (relay of searchRelays(); track relay.url) {
        <mat-list-item>
          <div class="relay-item-container">
            <div class="relay-status-icon">
              <mat-icon class="status-icon status-ok">check_circle</mat-icon>
            </div>
            <div class="relay-url">
              {{ formatRelayUrl(relay.url) }}
            </div>
            <div class="action-buttons">
              <button mat-icon-button (click)="viewRelayInfo(relay.url)"
                aria-label="View relay info">
                <mat-icon>info</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="removeSearchRelay(relay.url)"
                [disabled]="isPublishing()"
                aria-label="Remove search relay">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        </mat-list-item>
        @if (!$last) {
        <mat-divider></mat-divider>
        }
        }
      </mat-list>
      }
    </mat-card-content>
  </mat-card>

  <ng-template #searchRelaysInfoContent>
    <p i18n="@@settings.search.tooltip.p1">
      Search relays support NIP-50 (Search Capability) and are used to perform text-based searches across Nostr content.
    </p>
    <p i18n="@@settings.search.tooltip.p2">
      Your search relay list is stored as a kind 10007 event and synced across your Nostr clients.
    </p>
    <p i18n="@@settings.search.tooltip.p3">
      The default search relay is <strong>relay.nostr.band</strong>, which indexes a large portion of the Nostr network.
    </p>
  </ng-template>
</div>
