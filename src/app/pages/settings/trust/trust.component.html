<div class="panel-header">
  <button mat-icon-button (click)="goBack()" matTooltip="Back" i18n-matTooltip="@@common.back">
    <mat-icon>arrow_back</mat-icon>
  </button>
  <h2 class="panel-title title-font" i18n="@@settings.sections.trust">Trust</h2>
  <span class="panel-header-spacer"></span>
</div>

<div class="content-medium">
  <div class="setting-item">
    <span i18n="@@settings.trust.enable">Web of Trust</span>
    <mat-slide-toggle [checked]="localSettings.trustEnabled()" (change)="toggleTrustEnabled()">
    </mat-slide-toggle>
  </div>
  <p class="setting-description" i18n="@@settings.trust.description">
    Help filter out spam and bots by using reputation scores from trusted services.
  </p>

  @if (localSettings.trustEnabled()) {

  <!-- Scoring Services -->
  <section class="section">
    <h2 i18n="@@settings.trust.services.title">Scoring Services</h2>
    <p class="setting-description" i18n="@@settings.trust.services.description">
      These services analyze the Nostr network and calculate reputation scores for accounts.
    </p>

    <div class="service-list">
      @for (provider of knownProviders; track provider.pubkey) {
      <div class="service-card" [class.enabled]="isProviderConfigured(provider)">
        <div class="service-info">
          <div class="service-header">
            <span class="service-name">{{ provider.name }}</span>
            @if (isProviderConfigured(provider)) {
            <mat-icon class="service-active-icon">check_circle</mat-icon>
            }
          </div>
          <p class="service-description">{{ provider.description }}</p>
        </div>
        <div class="service-actions">
          @if (!isProviderConfigured(provider)) {
          <button mat-flat-button (click)="enableProvider(provider)" [disabled]="publishStatus() === 'publishing'">
            @if (publishStatus() === 'publishing') {
            <mat-spinner diameter="18"></mat-spinner>
            } @else {
            <span i18n="@@settings.trust.services.enable">Enable</span>
            }
          </button>
          } @else {
          <button mat-button (click)="disableProvider(provider)" [disabled]="publishStatus() === 'publishing'">
            <span i18n="@@settings.trust.services.disable">Disable</span>
          </button>
          }
        </div>
      </div>
      }

      @if (publishStatus() === 'error') {
      <p class="error-text">{{ publishError() }}</p>
      }
    </div>
  </section>

  <!-- Personalized Scoring -->
  <section class="section">
    <h2 i18n="@@settings.trust.personalized.title">Personalized Scoring</h2>
    <div class="callout-card">
      <mat-icon class="callout-icon">psychology</mat-icon>
      <div class="callout-content">
        <p i18n="@@settings.trust.personalized.description">
          Get scores tailored to your social graph. Activate your account on Brainstorm
          to receive personalized rankings based on who you follow and interact with.
        </p>
        <button mat-button (click)="openBrainstorm()" class="callout-action">
          <mat-icon>open_in_new</mat-icon>
          <span i18n="@@settings.trust.personalized.activate">Set up on Brainstorm</span>
        </button>
      </div>
    </div>
  </section>

  <!-- Update Scores -->
  <section class="section">
    <h2 i18n="@@settings.trust.refresh.title">Update Scores</h2>
    <p class="setting-description" i18n="@@settings.trust.refresh.description">
      Download the latest reputation scores for accounts you follow.
    </p>
    <div class="refresh-section">
      <button mat-stroked-button (click)="refreshTrustRanks()" [disabled]="refreshStatus() === 'refreshing'"
        class="refresh-button">
        @if (refreshStatus() === 'refreshing') {
        <mat-spinner diameter="18"></mat-spinner>
        <span i18n="@@settings.trust.refresh.refreshing">Updating...</span>
        } @else if (refreshStatus() === 'done') {
        <mat-icon>check</mat-icon>
        <span i18n="@@settings.trust.refresh.done">Done!</span>
        } @else {
        <mat-icon>refresh</mat-icon>
        <span i18n="@@settings.trust.refresh.button">Update Scores</span>
        }
      </button>
      @if (refreshStatus() === 'refreshing') {
      <div class="refresh-progress">
        <mat-progress-bar mode="determinate" [value]="refreshProgress()"></mat-progress-bar>
        <span class="refresh-progress-label">
          {{ refreshCompleted() }} / {{ refreshTotal() }}
        </span>
      </div>
      }
    </div>
  </section>

  }
</div>