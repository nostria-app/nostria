<div class="content-medium">
  <h2>Privacy and Safety Settings</h2>

  <section class="sharing-section">
    <h3>URL Privacy</h3>
    <div class="settings-option">
      <mat-checkbox [checked]="localSettingsService.removeTrackingParameters()" (change)="toggleRemoveTrackingParameters()">
        Remove tracking parameters from pasted URLs
      </mat-checkbox>
      <app-info-tooltip [content]="trackingRemovalInfoContent"
        ariaLabel="Learn about URL tracking parameter removal"></app-info-tooltip>
    </div>
  </section>

  <mat-divider></mat-divider>

  <section class="sharing-section">
    <h3>Image Cache Service</h3>
    <div class="settings-option">
      <mat-checkbox [checked]="settingsService.settings().imageCacheEnabled" (change)="toggleImageCache()">
        Enable image cache
      </mat-checkbox>
      <app-info-tooltip [content]="imageCacheInfoContent"
        ariaLabel="Learn about image cache service"></app-info-tooltip>
    </div>

    @if (settingsService.settings().imageCacheEnabled) {
    <div class="cache-actions">
      <button mat-raised-button color="warn" (click)="clearImageCache()">
        <mat-icon>delete</mat-icon>
        Clear Cache
      </button>
    </div>
    }
  </section>

  <section class="sharing-section">
    <h3>Social Sharing Options</h3>
    <div class="settings-option">
      <mat-checkbox [checked]="settingsService.settings().socialSharingPreview" (change)="toggleSocialSharingPreview()">
        Enable social sharing preview
      </mat-checkbox>
      <app-info-tooltip [content]="socialSharingInfoContent"
        ariaLabel="Learn about social sharing preview"></app-info-tooltip>
    </div>
  </section>

  <mat-divider></mat-divider>

  <section class="report-settings-section">
    <h3>Reported Content Settings</h3>
    <p class="section-description">
      Choose which types of reported content to automatically hide. When content is hidden, you can
      still choose to reveal it.
    </p>

    @for (reportType of reportTypes; track reportType.key) {
    <div class="settings-option">
      <mat-checkbox [checked]="isReportTypeHidden(reportType.key)"
        (change)="toggleReportTypeVisibility(reportType.key)">
        <div class="report-type-option">
          <mat-icon [fontIcon]="reportType.icon"></mat-icon>
          <span>Hide {{ reportType.label }}</span>
        </div>
      </mat-checkbox>
    </div>
    }
  </section>

  <mat-divider></mat-divider>

  <section class="mute-section">
    <h3>Blocked Accounts</h3>
    <div class="muted-section">
      @if (mutedAccounts().length > 0) {
      <mat-list>
        @for (pubkey of mutedAccounts(); track pubkey) {
        <mat-list-item>
          <span matListItemTitle>
            <app-user-profile [pubkey]="pubkey"> </app-user-profile>
          </span>
          <button mat-icon-button color="warn" (click)="removeMutedItem('account', pubkey)" matListItemMeta>
            <mat-icon>clear</mat-icon>
          </button>
        </mat-list-item>

        <!-- <mat-list-item>
          <span matListItemTitle>{{ pubkey }}</span>
          <button mat-icon-button color="warn" (click)="removeMutedItem('account', pubkey)" matListItemMeta>
            <mat-icon>clear</mat-icon>
          </button>
        </mat-list-item> -->
        <!-- <mat-divider>
        </mat-divider> -->
        }
      </mat-list>
      } @else {
      <p class="empty-state">No blocked accounts.</p>
      }
    </div>
  </section>

  <section class="mute-section">
    <h3>Muted Words</h3>
    <div class="muted-section">
      @if (mutedWords().length > 0) {
      <mat-list>
        @for (word of mutedWords(); track $index) {
        <mat-list-item>
          <span matListItemTitle>{{ word }}</span>
          <button mat-icon-button color="warn" (click)="removeMutedItem('word', word)" matListItemMeta>
            <mat-icon>clear</mat-icon>
          </button>
        </mat-list-item>
        <mat-divider></mat-divider>
        }
      </mat-list>
      } @else {
      <p class="empty-state">No muted words.</p>
      }
    </div>
  </section>

  <section class="mute-section">
    <h3>Muted Tags</h3>
    <div class="muted-section">
      @if (mutedTags().length > 0) {
      <mat-list>
        @for (tag of mutedTags(); track $index) {
        <mat-list-item>
          <span matListItemTitle>#{{ tag }}</span>
          <button mat-icon-button color="warn" (click)="removeMutedItem('tag', tag)" matListItemMeta>
            <mat-icon>clear</mat-icon>
          </button>
        </mat-list-item>
        <mat-divider></mat-divider>
        }
      </mat-list>
      } @else {
      <p class="empty-state">No muted tags.</p>
      }
    </div>
  </section>

  <section class="mute-section">
    <h3>Muted Threads</h3>
    <div class="muted-section">
      @if (mutedThreads().length > 0) {
      <mat-list>
        @for (thread of mutedThreads(); track $index) {
        <mat-list-item>
          <span matListItemTitle>{{ thread }}</span>
          <button mat-icon-button color="warn" (click)="removeMutedItem('thread', thread)" matListItemMeta>
            <mat-icon>clear</mat-icon>
          </button>
        </mat-list-item>
        <mat-divider></mat-divider>
        }
      </mat-list>
      } @else {
      <p class="empty-state">No muted threads.</p>
      }
    </div>
  </section>

  <mat-divider></mat-divider>

  <section class="delete-section">
    <h3>Event Management</h3>
    <p class="section-description">
      Manage and delete events you've published on Nostr.
    </p>
    <div class="delete-actions">
      <button mat-raised-button color="primary" (click)="navigateToDeleteEventPage()">
        <mat-icon>delete_outline</mat-icon>
        Delete Specific Event
      </button>
      <button mat-raised-button color="warn" (click)="navigateToDeleteAccountPage()">
        <mat-icon>delete_forever</mat-icon>
        Delete All Account Data
      </button>
    </div>
  </section>

  <!-- Template definitions for tooltip content -->
  <ng-template #trackingRemovalInfoContent>
    <mat-card-header>
      <mat-card-title>
        <div class="info-title">
          <mat-icon class="info-icon">link_off</mat-icon>
          URL Tracking Parameter Removal
        </div>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <p>
        When enabled, tracking parameters are automatically removed from URLs you paste.
      </p>
      <p>
        This removes parameters like utm_*, fbclid, gclid, and other tracking codes used by
        YouTube, Twitter/X, Facebook, and other platforms to track your activity across the web.
      </p>
      <p>
        Disable if you need to preserve all URL parameters, though this may reduce your privacy.
      </p>
    </mat-card-content>
  </ng-template>

  <ng-template #imageCacheInfoContent>
    <mat-card-header>
      <mat-card-title>
        <div class="info-title">
          <mat-icon class="info-icon">cached</mat-icon>
          Image Cache Service
        </div>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <p>
        When enabled, profile images and other images are optimized and cached using Angular Service
        Worker for improved loading times and offline availability.
      </p>
      <p>
        Images are cached for up to 7 days and automatically managed. This reduces bandwidth usage
        and improves performance, especially on slower connections.
      </p>
      <p>
        Disable if you want to ensure images are always loaded directly from the source, which will
        increase bandwidth usage and loading times.
      </p>
    </mat-card-content>
  </ng-template>

  <ng-template #socialSharingInfoContent>
    <mat-card-header>
      <mat-card-title>
        <div class="info-title">
          <mat-icon class="info-icon">share</mat-icon>
          Social Sharing Preview
        </div>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <p>When enabled, content previews will be shown for external links shared in posts.</p>
    </mat-card-content>
  </ng-template>
</div>