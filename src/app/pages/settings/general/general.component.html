<div class="content-medium">
  <h2 i18n="@@settings.general.title">General</h2>

  <div class="setting-item">
    <span i18n="@@settings.dark-mode">Dark Mode</span>
    <mat-slide-toggle [checked]="themeService.darkMode()" (change)="toggleDarkMode()">
    </mat-slide-toggle>
  </div>

  <div>
    <h2 i18n="@@settings.language">Language</h2>
    <p i18n="@@settings.language.description">Select your preferred language</p>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label i18n="@@settings.language.label">Language</mat-label>
      <mat-select [ngModel]="localSettings.locale()" (selectionChange)="setLanguage($event.value)">
        @for (language of languages; track language.code) {
        <mat-option [value]="language.code">{{ language.name }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <div>
    <h2 i18n="@@settings.max-relays.title">Max relays per user</h2>
    <p i18n="@@settings.max-relays.description">Number of relays to use per user</p>

    <div class="setting-item">
      <span>{{ localSettings.maxRelaysPerUser() }} <ng-container
          i18n="@@settings.max-relays.unit">relays</ng-container></span>
      <mat-slider min="1" max="14" step="1" discrete>
        <input matSliderThumb [value]="localSettings.maxRelaysPerUser()"
          (valueChange)="setMaxRelaysPerUser({ value: $event })" aria-label="Max relays per user" />
      </mat-slider>
    </div>
  </div>

  <div>
    <h2 i18n="@@settings.auto-relay-auth.title">Relay Authentication</h2>

    <div class="setting-item">
      <span i18n="@@settings.auto-relay-auth.toggle">Automatic Relay Authentication</span>
      <mat-slide-toggle [checked]="localSettings.autoRelayAuth()" (change)="toggleAutoRelayAuth()">
      </mat-slide-toggle>
    </div>
    <p class="setting-description" i18n="@@settings.auto-relay-auth.description">Automatically authenticate with relays
      that require authentication. When disabled, relays that require authentication will not be used.</p>
  </div>

  <div>
    <h2 i18n="@@settings.client-tags.title">Client Tags</h2>

    <div class="setting-item">
      <span i18n="@@settings.client-tags.add">Add Client Tag</span>
      <mat-slide-toggle [checked]="localSettings.addClientTag()" (change)="toggleAddClientTag()">
      </mat-slide-toggle>
    </div>
    <p class="setting-description" i18n="@@settings.client-tags.add.description">Add the Nostria client tag to events
      you publish</p>

    <div class="setting-item">
      <span i18n="@@settings.client-tags.show">Show Client Tag</span>
      <mat-slide-toggle [checked]="localSettings.showClientTag()" (change)="toggleShowClientTag()">
      </mat-slide-toggle>
    </div>
    <p class="setting-description" i18n="@@settings.client-tags.show.description">Show what client that authors are
      using</p>
  </div>

  <div>
    <h2 i18n="@@settings.media.title">Media</h2>
    <p class="setting-description" i18n="@@settings.media.description">Control how media content is displayed based on
      your following status</p>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label i18n="@@settings.media.display-mode">Media Display Mode</mat-label>
      <mat-select [ngModel]="settings.settings()?.mediaPrivacy || 'show-always'"
        (selectionChange)="setMediaPrivacy($event.value)">
        <mat-option value="show-always" i18n="@@settings.media.show-always">Always Show Media</mat-option>
        <mat-option value="blur-non-following" i18n="@@settings.media.blur-non-following">Blur Media from
          Non-Following</mat-option>
        <mat-option value="blur-always" i18n="@@settings.media.blur-always">Always Blur Media</mat-option>
      </mat-select>
    </mat-form-field>
    <!-- <p>
      @switch (settings.settings()?.mediaPrivacy || 'show-always') {
      @case ('show-always') {
      <ng-container i18n="@@settings.media.show-always.description">All media content will be displayed immediately
        without blurring.</ng-container>
      }
      @case ('blur-non-following') {
      <ng-container i18n="@@settings.media.blur-non-following.description">Media from accounts you don't follow will be
        blurred. Click to reveal.</ng-container>
      }
      @case ('blur-always') {
      <ng-container i18n="@@settings.media.blur-always.description">All media will be blurred by default. Click to
        reveal individual items.</ng-container>
      }
      }
    </p> -->

    <mat-form-field appearance="outline" class="full-width">
      <mat-label i18n="@@settings.media.placeholder-algorithm">Placeholder Algorithm</mat-label>
      <mat-select [ngModel]="settings.settings()?.placeholderAlgorithm || 'blurhash'"
        (selectionChange)="setPlaceholderAlgorithm($event.value)">
        <mat-option value="blurhash" i18n="@@settings.media.placeholder.blurhash">Blurhash (Legacy)</mat-option>
        <mat-option value="thumbhash" i18n="@@settings.media.placeholder.thumbhash">Thumbhash</mat-option>
        <mat-option value="both" i18n="@@settings.media.placeholder.both">Both</mat-option>
      </mat-select>
    </mat-form-field>
    <!-- <p>
      @switch (settings.settings()?.placeholderAlgorithm || 'blurhash') {
      @case ('blurhash') {
      <ng-container i18n="@@settings.media.placeholder.blurhash.description">Use Blurhash for image placeholders. This
        is the most widely supported format.</ng-container>
      }
      @case ('thumbhash') {
      <ng-container i18n="@@settings.media.placeholder.thumbhash.description">Use Thumbhash for image placeholders.
        Thumbhash provides better visual quality and preserves aspect ratio.</ng-container>
      }
      @case ('both') {
      <ng-container i18n="@@settings.media.placeholder.both.description">Generate both Blurhash and Thumbhash when
        creating new content. Prefer Thumbhash when viewing content.</ng-container>
      }
      }
    </p> -->

    <div class="setting-item">
      <span i18n="@@settings.media.auto-play">Auto-Play Short Form Videos</span>
      <mat-slide-toggle [checked]="settings.settings().autoPlayShortForm ?? true" (change)="toggleAutoPlayShortForm()">
      </mat-slide-toggle>
    </div>

    <div class="setting-item">
      <span i18n="@@settings.media.repeat">Repeat Short Form Videos</span>
      <mat-slide-toggle [checked]="settings.settings().repeatShortForm ?? true" (change)="toggleRepeatShortForm()">
      </mat-slide-toggle>
    </div>
  </div>

  <div>
    <h2 i18n="@@settings.navigation.title">Navigation</h2>

    <div class="setting-item">
      <span i18n="@@settings.navigation.start-last-page">Start on Last Page</span>
      <mat-slide-toggle [checked]="localSettings.startOnLastRoute()" (change)="toggleStartOnLastRoute()">
      </mat-slide-toggle>
    </div>
    <p class="setting-description" i18n="@@settings.navigation.start-last-page.description">When opening the app,
      restore the last page you were viewing.</p>

    <div class="setting-item">
      <span i18n="@@settings.navigation.start-feeds-last-event">Start Feeds on Last Event</span>
      <mat-slide-toggle [checked]="localSettings.startFeedsOnLastEvent()" (change)="toggleStartFeedsOnLastEvent()">
      </mat-slide-toggle>
    </div>
    <p class="setting-description" i18n="@@settings.navigation.start-feeds-last-event.description">Show previously
      loaded events first when opening feeds, with new posts appearing via
      a button. Prevents the feed from jumping to the latest events on reload.</p>

    <div class="setting-item">
      <span i18n="@@settings.navigation.show-thread-lines">Show Thread Lines</span>
      <mat-slide-toggle [checked]="localSettings.showThreadLines()" (change)="toggleShowThreadLines()">
      </mat-slide-toggle>
    </div>
    <p class="setting-description" i18n="@@settings.navigation.show-thread-lines.description">Display vertical lines on
      the left side of threaded replies to indicate nesting depth.</p>

    <div class="setting-item">
      <span i18n="@@settings.navigation.open-threads-expanded">Open Threads Expanded</span>
      <mat-slide-toggle [checked]="localSettings.openThreadsExpanded()" (change)="toggleOpenThreadsExpanded()">
      </mat-slide-toggle>
    </div>
    <p class="setting-description" i18n="@@settings.navigation.open-threads-expanded.description">When viewing a thread,
      show all replies expanded by default. Disable for a cleaner initial view with collapsed replies.</p>
  </div>

  <div>
    <h2 i18n="@@settings.calendar.title">Calendar System</h2>
    <p i18n="@@settings.calendar.description">Choose your preferred calendar system for displaying dates</p>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label i18n="@@settings.calendar.label">Calendar</mat-label>
      <mat-select [ngModel]="localSettings.calendarType()" (selectionChange)="setCalendarType($event.value)">
        <mat-option value="gregorian" i18n="@@settings.calendar.gregorian">Gregorian Calendar</mat-option>
        <mat-option value="chronia" i18n="@@settings.calendar.chronia">Chronia Calendar</mat-option>
        <mat-option value="ethiopian" i18n="@@settings.calendar.ethiopian">Ethiopian Calendar</mat-option>
      </mat-select>
    </mat-form-field>
    <p>
      @switch (localSettings.calendarType()) {
      @case ('gregorian') {
      <ng-container i18n="@@settings.calendar.gregorian.description">The standard civil calendar used worldwide with 12
        months of varying lengths.</ng-container>
      }
      @case ('chronia') {
      <ng-container i18n="@@settings.calendar.chronia.description">A modern simplified calendar with 13 months of 28
        days each, plus Solstice Day. Year 0 begins December 22, 2015.</ng-container>
      }
      @case ('ethiopian') {
      <ng-container i18n="@@settings.calendar.ethiopian.description">The traditional Ethiopian calendar with 13 months:
        12 months of 30 days and Pagume (5-6 days). Approximately 7-8 years behind Gregorian.</ng-container>
      }
      }
    </p>
  </div>

  @if (accountState.hasActiveSubscription()) {
  <div>
    <h2 i18n="@@settings.release-channel">
      Release Channel <mat-icon class="minor-icon">diamond</mat-icon>
    </h2>
    <p i18n="@@settings.release-channel.description">
      Get early access to new features (Premium)
    </p>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label i18n="@@settings.feature-level">Feature Level</mat-label>
      <mat-select [ngModel]="currentFeatureLevel()" (selectionChange)="setFeatureLevel($event.value)">
        <mat-option value="stable" i18n="@@settings.feature-level.stable">Stable</mat-option>
        <mat-option value="beta" i18n="@@settings.feature-level.beta">Beta</mat-option>
        <mat-option value="preview" i18n="@@settings.feature-level.preview">Preview</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  }

  <div>
    <h2 i18n="@@settings.logging">Logging</h2>
    <p i18n="@@settings.logging.description">Configure application logging levels</p>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label i18n="@@settings.logging.log-level">Log Level</mat-label>
      <mat-select [ngModel]="logger.logLevel" (selectionChange)="setLogLevel($event.value)">
        <mat-option value="debug" i18n="@@settings.logging.debug">Debug</mat-option>
        <mat-option value="info" i18n="@@settings.logging.info">Info</mat-option>
        <mat-option value="warn" i18n="@@settings.logging.warn">Warning</mat-option>
        <mat-option value="error" i18n="@@settings.logging.error">Error</mat-option>
        <mat-option value="none" i18n="@@settings.logging.none">None</mat-option>
      </mat-select>
    </mat-form-field>
    <p>
      @switch (logger.logLevel) {
      @case ('debug') {
      <ng-container i18n="@@settings.logging.debug.description">Shows all log messages including detailed debug
        information.</ng-container>
      }
      @case ('info') {
      <ng-container i18n="@@settings.logging.info.description">Shows informational messages, warnings and
        errors.</ng-container>
      }
      @case ('warn') {
      <ng-container i18n="@@settings.logging.warn.description">Shows only warnings and errors.</ng-container>
      }
      @case ('error') {
      <ng-container i18n="@@settings.logging.error.description">Shows only error messages.</ng-container>
      }
      @case ('none') {
      <ng-container i18n="@@settings.logging.none.description">Disables all logging output.</ng-container>
      }
      }
    </p>
  </div>

  <div>
    <h2 i18n="@@settings.external-links.title">External Links</h2>
    <p i18n="@@settings.external-links.description">Configure which external domains should open within the app instead
      of a new browser tab</p>

    <div class="external-domains-list">
      @for (domain of configuredDomains(); track domain) {
      <div class="domain-item">
        <span class="domain-name">{{ domain }}</span>
        <button mat-icon-button (click)="removeDomain(domain)" [attr.aria-label]="'Remove ' + domain">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      }
    </div>

    <div class="add-domain-container">
      <mat-form-field appearance="outline" class="domain-input">
        <mat-label i18n="@@settings.external-links.add-domain">Add Domain</mat-label>
        <input matInput [(ngModel)]="newDomain" placeholder="example.com" (keyup.enter)="addNewDomain()"
          i18n-placeholder="@@settings.external-links.domain-placeholder">
      </mat-form-field>
      <button mat-flat-button (click)="addNewDomain()" [disabled]="!newDomain"
        i18n="@@settings.external-links.add-button">
        Add
      </button>
    </div>

    <button mat-stroked-button (click)="resetDomainsToDefault()" i18n="@@settings.external-links.reset-button">
      Reset to Defaults
    </button>
  </div>

  <!-- Storage Stats Component -->
  <div class="setting-item">
    <app-storage-stats class="mb-4"></app-storage-stats>
  </div>

  <div class="setting-item danger-zone">
    <div>
      <h2 i18n="@@settings.danger-zone.title">Danger Zone</h2>

      <div class="danger-action">
        <div>
          <h3 i18n="@@settings.danger-zone.wipe-data">Wipe All Data</h3>
          <p i18n="@@settings.danger-zone.wipe-data.description">This will delete all your local app data and reload the
            application.</p>
        </div>
        <button mat-flat-button class="wipe-data-button" (click)="wipeData()"
          i18n="@@settings.danger-zone.wipe-data.button">Wipe Data</button>
      </div>
    </div>
  </div>
</div>