<div class="content-medium">
  <h2>General</h2>

  <div class="setting-item">
    <span i18n="@@settings.dark-mode">Dark Mode</span>
    <mat-slide-toggle [checked]="themeService.darkMode()" (change)="toggleDarkMode()">
    </mat-slide-toggle>
  </div>

  <div>
    <h2 i18n="@@settings.language">Language</h2>
    <p i18n="@@settings.language.description">Select your preferred language</p>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label i18n="@@settings.language.label">Language</mat-label>
      <mat-select [ngModel]="localSettings.locale()" (selectionChange)="setLanguage($event.value)">
        @for (language of languages; track language.code) {
        <mat-option [value]="language.code">{{ language.name }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <div>
    <h2>Max relays per user</h2>
    <p>Number of relays to use per user</p>

    <div class="setting-item">
      <span>{{ localSettings.maxRelaysPerUser() }} relays</span>
      <mat-slider min="1" max="14" step="1" discrete>
        <input matSliderThumb [value]="localSettings.maxRelaysPerUser()"
          (valueChange)="setMaxRelaysPerUser({ value: $event })" aria-label="Max relays per user" />
      </mat-slider>
    </div>
  </div>

  <div>
    <h2>Client Tags</h2>

    <div class="setting-item">
      <span>Add Client Tag</span>
      <mat-slide-toggle [checked]="localSettings.addClientTag()" (change)="toggleAddClientTag()">
      </mat-slide-toggle>
    </div>
    <p class="setting-description">Add the Nostria client tag to events you publish</p>

    <div class="setting-item">
      <span>Show Client Tag</span>
      <mat-slide-toggle [checked]="localSettings.showClientTag()" (change)="toggleShowClientTag()">
      </mat-slide-toggle>
    </div>
    <p class="setting-description">Show what client that authors are using</p>
  </div>

  <div>
    <h2>Media</h2>
    <p class="setting-description">Control how media content is displayed based on your following status</p>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Media Display Mode</mat-label>
      <mat-select [ngModel]="settings.settings()?.mediaPrivacy || 'show-always'"
        (selectionChange)="setMediaPrivacy($event.value)">
        <mat-option value="show-always">Always Show Media</mat-option>
        <mat-option value="blur-non-following">Blur Media from Non-Following</mat-option>
        <mat-option value="blur-always">Always Blur Media</mat-option>
      </mat-select>
    </mat-form-field>
    <p>
      @switch (settings.settings()?.mediaPrivacy || 'show-always') {
      @case ('show-always') {
      All media content will be displayed immediately without blurring.
      }
      @case ('blur-non-following') {
      Media from accounts you don't follow will be blurred. Click to reveal.
      }
      @case ('blur-always') {
      All media will be blurred by default. Click to reveal individual items.
      }
      }
    </p>

    <div class="setting-item">
      <span>Auto-Play Short Form Videos</span>
      <mat-slide-toggle [checked]="settings.settings().autoPlayShortForm ?? true" (change)="toggleAutoPlayShortForm()">
      </mat-slide-toggle>
    </div>

    <div class="setting-item">
      <span>Repeat Short Form Videos</span>
      <mat-slide-toggle [checked]="settings.settings().repeatShortForm ?? true" (change)="toggleRepeatShortForm()">
      </mat-slide-toggle>
    </div>
  </div>

  <div>
    <h2>Navigation</h2>

    <div class="setting-item">
      <span>Start on Last Page</span>
      <mat-slide-toggle [checked]="localSettings.startOnLastRoute()" (change)="toggleStartOnLastRoute()">
      </mat-slide-toggle>
    </div>
    <p class="setting-description">When opening the app, restore the last page you were viewing.</p>

    <div class="setting-item">
      <span>Start Feeds on Last Event</span>
      <mat-slide-toggle [checked]="localSettings.startFeedsOnLastEvent()" (change)="toggleStartFeedsOnLastEvent()">
      </mat-slide-toggle>
    </div>
    <p class="setting-description">Show previously loaded events first when opening feeds, with new posts appearing via
      a button. Prevents the feed from jumping to the latest events on reload.</p>
  </div>

  @if (accountState.hasActiveSubscription()) {
  <div>
    <h2 i18n="@@settings.release-channel">
      Release Channel <mat-icon class="minor-icon">diamond</mat-icon>
    </h2>
    <p i18n="@@settings.release-channel.description">
      Get early access to new features (Premium)
    </p>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label i18n="@@settings.feature-level">Feature Level</mat-label>
      <mat-select [ngModel]="currentFeatureLevel()" (selectionChange)="setFeatureLevel($event.value)">
        <mat-option value="stable" i18n="@@settings.feature-level.stable">Stable</mat-option>
        <mat-option value="beta" i18n="@@settings.feature-level.beta">Beta</mat-option>
        <mat-option value="preview" i18n="@@settings.feature-level.preview">Preview</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  }

  <div>
    <h2 i18n="@@settings.logging">Logging</h2>
    <p i18n="@@settings.logging.description">Configure application logging levels</p>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Log Level</mat-label>
      <mat-select [ngModel]="logger.logLevel" (selectionChange)="setLogLevel($event.value)">
        <mat-option value="debug">Debug</mat-option>
        <mat-option value="info">Info</mat-option>
        <mat-option value="warn">Warning</mat-option>
        <mat-option value="error">Error</mat-option>
        <mat-option value="none">None</mat-option>
      </mat-select>
    </mat-form-field>
    <p>
      @switch (logger.logLevel) {
      @case ('debug') {
      Shows all log messages including detailed debug information.
      }
      @case ('info') {
      Shows informational messages, warnings and errors.
      }
      @case ('warn') {
      Shows only warnings and errors.
      }
      @case ('error') {
      Shows only error messages.
      }
      @case ('none') {
      Disables all logging output.
      }
      }
    </p>
  </div>

  <!-- Storage Stats Component -->
  <div class="setting-item">
    <app-storage-stats class="mb-4"></app-storage-stats>
  </div>

  <div class="setting-item danger-zone">
    <div>
      <h2>Danger Zone</h2>

      <div class="danger-action">
        <div>
          <h3>Reset Notifications Cache</h3>
          <p>This will delete all cached notifications from local storage. Your notifications will be refetched from
            relays.</p>
        </div>
        <button mat-flat-button class="danger-button" (click)="resetNotificationsCache()">Reset Notifications</button>
      </div>

      <div class="danger-action">
        <div>
          <h3>Wipe All Data</h3>
          <p>This will delete all your local app data and reload the application.</p>
        </div>
        <button mat-flat-button class="wipe-data-button" (click)="wipeData()">Wipe Data</button>
      </div>
    </div>
  </div>
</div>