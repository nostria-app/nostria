<!-- Panel Header -->
<div class="panel-header">
  <h2 class="panel-title title-font" i18n="@@interest-sets.title">Interests</h2>
  <span class="panel-header-spacer"></span>
  <button mat-icon-button (click)="startCreatingNew()" matTooltip="Create new interest list">
    <mat-icon>add</mat-icon>
  </button>
</div>

<div class="interest-sets-container">
  @if (isLoading()) {
  <div class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
  </div>
  }

  <!-- Create New List Form -->
  @if (isCreatingNew()) {
  <mat-card class="section-card new-list-card">
    <div class="section-header">
      <div class="section-title">
        <mat-icon>add_circle</mat-icon>
        <h2>Create New Interest List</h2>
      </div>
    </div>

    <mat-divider></mat-divider>

    <div class="section-content">
      <div class="edit-form">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>List Title</mat-label>
          <input matInput [(ngModel)]="newListTitle" placeholder="e.g., Tech Topics, Nature, Music">
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Hashtags</mat-label>
          <textarea matInput [(ngModel)]="newListHashtags" rows="4"
            placeholder="bitcoin&#10;nostr&#10;programming"></textarea>
          <mat-hint>One hashtag per line or comma-separated</mat-hint>
        </mat-form-field>

        <div class="form-actions">
          <button mat-button (click)="cancelCreatingNew()">Cancel</button>
          <button mat-flat-button (click)="saveNewList()" [disabled]="isLoading()">
            Create List
          </button>
        </div>
      </div>
    </div>
  </mat-card>
  }

  <!-- Interest Lists -->
  @for (set of interestSets(); track set.identifier) {
  <mat-card class="section-card interest-list-card">
    <div class="section-header">
      <div class="section-title">
        <mat-icon>tag</mat-icon>
        <h2>{{ set.title }}</h2>
      </div>
      <div class="section-actions">
        @if (editingListId() !== set.identifier) {
        <!-- View as Feed button -->
        <button mat-button (click)="openListFeed(set)" matTooltip="View all hashtags as feed">
          <mat-icon>dynamic_feed</mat-icon>
          View as Feed
        </button>

        <!-- Menu for edit/delete -->
        <button mat-icon-button [matMenuTriggerFor]="listMenu" matTooltip="List options">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #listMenu="matMenu">
          <button mat-menu-item (click)="startEditing(set)">
            <mat-icon>edit</mat-icon>
            <span>Edit</span>
          </button>
          @if (set.identifier === 'interests') {
          <button mat-menu-item (click)="resetToDefaults()">
            <mat-icon>restore</mat-icon>
            <span>Reset to Defaults</span>
          </button>
          }
          <button mat-menu-item (click)="deleteList(set)" class="delete-menu-item">
            <mat-icon>delete</mat-icon>
            <span>Delete</span>
          </button>
        </mat-menu>
        }
      </div>
    </div>

    <mat-divider></mat-divider>

    <div class="section-content">
      @if (editingListId() === set.identifier) {
      <!-- Editing mode -->
      <div class="edit-form">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>List Title</mat-label>
          <input matInput [(ngModel)]="editingTitle" placeholder="List title">
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Hashtags</mat-label>
          <textarea matInput [(ngModel)]="editingHashtags" rows="4"></textarea>
          <mat-hint>One hashtag per line or comma-separated</mat-hint>
        </mat-form-field>

        <div class="form-actions">
          <button mat-button (click)="cancelEditing()">Cancel</button>
          <button mat-flat-button (click)="saveEdit()" [disabled]="isLoading()">
            Save
          </button>
        </div>
      </div>
      } @else {
      <!-- Display mode -->
      @if (set.hashtags.length === 0) {
      <p class="empty-state">
        No hashtags in this list. Click the menu to edit.
      </p>
      } @else {
      <div class="hashtags-container">
        <mat-chip-set aria-label="Hashtags">
          @for (hashtag of set.hashtags; track hashtag) {
          <mat-chip class="hashtag-chip" (click)="openHashtagFeed(hashtag)">
            <span class="hashtag-text">#{{ hashtag }}</span>
          </mat-chip>
          }
        </mat-chip-set>
      </div>
      }
      }
    </div>
  </mat-card>
  }

  <!-- Empty state if no lists -->
  @if (interestSets().length === 0 && !isLoading()) {
  <div class="empty-state-container">
    <mat-icon class="empty-icon">tag</mat-icon>
    <h3>No Interest Lists</h3>
    <p>Create your first interest list to start tracking hashtags you care about.</p>
  </div>
  }
</div>
